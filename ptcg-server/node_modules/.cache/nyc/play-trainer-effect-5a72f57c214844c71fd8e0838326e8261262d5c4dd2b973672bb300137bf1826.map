{"version":3,"file":"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/effect-reducers/play-trainer-effect.ts","sources":["/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/effect-reducers/play-trainer-effect.ts"],"names":[],"mappings":"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","sourcesContent":["import { AttachPokemonToolEffect, TrainerEffect, PlaySupporterEffect,\n  PlayItemEffect, PlayStadiumEffect } from '../effects/play-card-effects';\nimport { GameError } from '../../game-error';\nimport { GameMessage, GameLog } from '../../game-message';\nimport { Effect } from '../effects/effect';\nimport { State } from '../state/state';\nimport { StoreLike } from '../store-like';\nimport { StateUtils } from '../state-utils';\nimport { TrainerType } from '../card/card-types';\n\n\nexport function playTrainerReducer(store: StoreLike, state: State, effect: Effect): State {\n\n  /* Play supporter card */\n  if (effect instanceof PlaySupporterEffect) {\n    const playTrainer = new TrainerEffect(effect.player, effect.trainerCard, effect.target);\n    state = store.reduceEffect(state, playTrainer);\n    store.log(state, GameLog.LOG_PLAYER_PLAYS_SUPPORTER, {\n      name: effect.player.name,\n      card: effect.trainerCard.name\n    });\n    return state;\n  }\n\n  /* Play stadium card */\n  if (effect instanceof PlayStadiumEffect) {\n    const player = effect.player;\n    const opponent = StateUtils.getOpponent(state, player);\n    if (player.stadium.cards.length > 0) {\n      player.stadium.moveTo(player.discard);\n    }\n    if (opponent.stadium.cards.length > 0) {\n      opponent.stadium.moveTo(opponent.discard);\n    }\n    store.log(state, GameLog.LOG_PLAYER_PLAYS_STADIUM, {\n      name: effect.player.name,\n      card: effect.trainerCard.name\n    });\n    player.stadiumUsedTurn = 0;\n    player.hand.moveCardTo(effect.trainerCard, player.stadium);\n    return state;\n  }\n\n  // Play Pokemon Tool card\n  if (effect instanceof AttachPokemonToolEffect) {\n    const pokemonCard = effect.target.getPokemonCard();\n    if (pokemonCard === undefined) {\n      throw new GameError(GameMessage.INVALID_TARGET);\n    }\n    if (effect.target.tool !== undefined) {\n      throw new GameError(GameMessage.POKEMON_TOOL_ALREADY_ATTACHED);\n    }\n\n    store.log(state, GameLog.LOG_PLAYER_PLAYS_TOOL, {\n      name: effect.player.name,\n      card: effect.trainerCard.name,\n      pokemon: pokemonCard.name\n    });\n    effect.player.hand.moveCardTo(effect.trainerCard, effect.target);\n    effect.target.tool = effect.trainerCard;\n\n    const playTrainer = new TrainerEffect(effect.player, effect.trainerCard, effect.target);\n    state = store.reduceEffect(state, playTrainer);\n\n    return state;\n  }\n\n  // Play item card\n  if (effect instanceof PlayItemEffect) {\n    const playTrainer = new TrainerEffect(effect.player, effect.trainerCard, effect.target);\n    state = store.reduceEffect(state, playTrainer);\n    store.log(state, GameLog.LOG_PLAYER_PLAYS_ITEM, {\n      name: effect.player.name,\n      card: effect.trainerCard.name\n    });\n    return state;\n  }\n\n  // Process trainer effect\n  if (effect instanceof TrainerEffect) {\n    if (effect.player.hand.cards.includes(effect.trainerCard)) {\n      const isSupporter = effect.trainerCard.trainerType === TrainerType.SUPPORTER;\n      const target = isSupporter ? effect.player.supporter : effect.player.discard;\n      effect.player.hand.moveCardTo(effect.trainerCard, target);\n    }\n    return state;\n  }\n\n  return state;\n}\n"]}