"use strict";function cov_sj1c0ol4e(){var path="/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/effect-reducers/game-effect.ts";var hash="0b07e3560944a6ab46d63167478b6b6a7d5a3b54";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/effect-reducers/game-effect.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:0},end:{line:3,column:29}},"2":{start:{line:4,column:21},end:{line:4,column:48}},"3":{start:{line:5,column:23},end:{line:5,column:52}},"4":{start:{line:6,column:29},end:{line:6,column:69}},"5":{start:{line:7,column:16},end:{line:7,column:41}},"6":{start:{line:8,column:22},end:{line:8,column:47}},"7":{start:{line:9,column:24},end:{line:9,column:59}},"8":{start:{line:10,column:21},end:{line:10,column:50}},"9":{start:{line:11,column:23},end:{line:11,column:57}},"10":{start:{line:12,column:27},end:{line:12,column:65}},"11":{start:{line:13,column:25},end:{line:13,column:61}},"12":{start:{line:15,column:19},end:{line:15,column:20}},"13":{start:{line:16,column:19},end:{line:16,column:20}},"14":{start:{line:17,column:4},end:{line:26,column:5}},"15":{start:{line:18,column:8},end:{line:25,column:9}},"16":{start:{line:19,column:12},end:{line:24,column:13}},"17":{start:{line:20,column:16},end:{line:20,column:30}},"18":{start:{line:23,column:16},end:{line:23,column:39}},"19":{start:{line:27,column:4},end:{line:31,column:5}},"20":{start:{line:28,column:8},end:{line:30,column:9}},"21":{start:{line:29,column:12},end:{line:29,column:35}},"22":{start:{line:32,column:4},end:{line:32,column:42}},"23":{start:{line:35,column:19},end:{line:35,column:32}},"24":{start:{line:36,column:21},end:{line:36,column:72}},"25":{start:{line:37,column:15},end:{line:37,column:46}},"26":{start:{line:38,column:4},end:{line:40,column:5}},"27":{start:{line:39,column:8},end:{line:39,column:98}},"28":{start:{line:41,column:19},end:{line:41,column:32}},"29":{start:{line:42,column:28},end:{line:42,column:85}},"30":{start:{line:43,column:4},end:{line:43,column:55}},"31":{start:{line:44,column:32},end:{line:44,column:85}},"32":{start:{line:45,column:4},end:{line:45,column:59}},"33":{start:{line:46,column:4},end:{line:48,column:5}},"34":{start:{line:47,column:8},end:{line:47,column:87}},"35":{start:{line:49,column:4},end:{line:62,column:5}},"36":{start:{line:50,column:19},end:{line:50,column:24}},"37":{start:{line:51,column:8},end:{line:51,column:91}},"38":{start:{line:52,column:8},end:{line:55,column:11}},"39":{start:{line:53,column:12},end:{line:53,column:26}},"40":{start:{line:54,column:12},end:{line:54,column:19}},"41":{start:{line:56,column:8},end:{line:61,column:9}},"42":{start:{line:57,column:12},end:{line:57,column:70}},"43":{start:{line:58,column:12},end:{line:58,column:39}},"44":{start:{line:59,column:12},end:{line:59,column:94}},"45":{start:{line:60,column:12},end:{line:60,column:25}},"46":{start:{line:63,column:4},end:{line:63,column:112}},"47":{start:{line:64,column:4},end:{line:64,column:43}},"48":{start:{line:65,column:25},end:{line:65,column:82}},"49":{start:{line:66,column:4},end:{line:66,column:52}},"50":{start:{line:67,column:4},end:{line:69,column:5}},"51":{start:{line:68,column:8},end:{line:68,column:52}},"52":{start:{line:68,column:44},end:{line:68,column:50}},"53":{start:{line:70,column:4},end:{line:73,column:5}},"54":{start:{line:71,column:27},end:{line:71,column:99}},"55":{start:{line:72,column:8},end:{line:72,column:54}},"56":{start:{line:74,column:4},end:{line:76,column:5}},"57":{start:{line:75,column:8},end:{line:75,column:52}},"58":{start:{line:75,column:44},end:{line:75,column:50}},"59":{start:{line:77,column:4},end:{line:77,column:85}},"60":{start:{line:80,column:4},end:{line:91,column:5}},"61":{start:{line:81,column:21},end:{line:81,column:51}},"62":{start:{line:82,column:8},end:{line:90,column:9}},"63":{start:{line:84,column:12},end:{line:86,column:13}},"64":{start:{line:85,column:16},end:{line:85,column:39}},"65":{start:{line:87,column:12},end:{line:87,column:89}},"66":{start:{line:88,column:12},end:{line:88,column:56}},"67":{start:{line:89,column:12},end:{line:89,column:41}},"68":{start:{line:92,column:4},end:{line:102,column:5}},"69":{start:{line:93,column:33},end:{line:93,column:90}},"70":{start:{line:94,column:8},end:{line:94,column:60}},"71":{start:{line:95,column:34},end:{line:95,column:92}},"72":{start:{line:96,column:8},end:{line:96,column:61}},"73":{start:{line:97,column:25},end:{line:97,column:51}},"74":{start:{line:98,column:25},end:{line:98,column:80}},"75":{start:{line:99,column:27},end:{line:99,column:86}},"76":{start:{line:100,column:8},end:{line:100,column:98}},"77":{start:{line:101,column:8},end:{line:101,column:21}},"78":{start:{line:103,column:4},end:{line:106,column:5}},"79":{start:{line:104,column:26},end:{line:104,column:81}},"80":{start:{line:104,column:42},end:{line:104,column:58}},"81":{start:{line:105,column:8},end:{line:105,column:38}},"82":{start:{line:107,column:4},end:{line:114,column:5}},"83":{start:{line:108,column:23},end:{line:108,column:36}},"84":{start:{line:109,column:22},end:{line:109,column:34}},"85":{start:{line:110,column:21},end:{line:110,column:32}},"86":{start:{line:111,column:8},end:{line:111,column:117}},"87":{start:{line:112,column:8},end:{line:112,column:95}},"88":{start:{line:113,column:8},end:{line:113,column:21}},"89":{start:{line:115,column:4},end:{line:119,column:5}},"90":{start:{line:116,column:23},end:{line:116,column:36}},"91":{start:{line:117,column:8},end:{line:117,column:126}},"92":{start:{line:118,column:8},end:{line:118,column:44}},"93":{start:{line:120,column:4},end:{line:123,column:5}},"94":{start:{line:121,column:8},end:{line:121,column:81}},"95":{start:{line:122,column:8},end:{line:122,column:21}},"96":{start:{line:124,column:4},end:{line:137,column:5}},"97":{start:{line:125,column:28},end:{line:125,column:58}},"98":{start:{line:126,column:8},end:{line:128,column:9}},"99":{start:{line:127,column:12},end:{line:127,column:88}},"100":{start:{line:129,column:8},end:{line:133,column:11}},"101":{start:{line:134,column:8},end:{line:134,column:73}},"102":{start:{line:135,column:8},end:{line:135,column:53}},"103":{start:{line:136,column:8},end:{line:136,column:37}},"104":{start:{line:138,column:4},end:{line:138,column:17}},"105":{start:{line:140,column:0},end:{line:140,column:34}}},fnMap:{"0":{name:"applyWeaknessAndResistance",decl:{start:{line:14,column:9},end:{line:14,column:35}},loc:{start:{line:14,column:77},end:{line:33,column:1}},line:14},"1":{name:"useAttack",decl:{start:{line:34,column:10},end:{line:34,column:19}},loc:{start:{line:34,column:48},end:{line:78,column:1}},line:34},"2":{name:"(anonymous_2)",decl:{start:{line:52,column:127},end:{line:52,column:128}},loc:{start:{line:52,column:137},end:{line:55,column:9}},line:52},"3":{name:"(anonymous_3)",decl:{start:{line:68,column:38},end:{line:68,column:39}},loc:{start:{line:68,column:44},end:{line:68,column:50}},line:68},"4":{name:"(anonymous_4)",decl:{start:{line:75,column:38},end:{line:75,column:39}},loc:{start:{line:75,column:44},end:{line:75,column:50}},line:75},"5":{name:"gameReducer",decl:{start:{line:79,column:9},end:{line:79,column:20}},loc:{start:{line:79,column:43},end:{line:139,column:1}},line:79},"6":{name:"(anonymous_6)",decl:{start:{line:104,column:36},end:{line:104,column:37}},loc:{start:{line:104,column:42},end:{line:104,column:58}},line:104}},branchMap:{"0":{loc:{start:{line:18,column:8},end:{line:25,column:9}},type:"if",locations:[{start:{line:18,column:8},end:{line:25,column:9}},{start:{line:18,column:8},end:{line:25,column:9}}],line:18},"1":{loc:{start:{line:19,column:12},end:{line:24,column:13}},type:"if",locations:[{start:{line:19,column:12},end:{line:24,column:13}},{start:{line:19,column:12},end:{line:24,column:13}}],line:19},"2":{loc:{start:{line:28,column:8},end:{line:30,column:9}},type:"if",locations:[{start:{line:28,column:8},end:{line:30,column:9}},{start:{line:28,column:8},end:{line:30,column:9}}],line:28},"3":{loc:{start:{line:38,column:4},end:{line:40,column:5}},type:"if",locations:[{start:{line:38,column:4},end:{line:40,column:5}},{start:{line:38,column:4},end:{line:40,column:5}}],line:38},"4":{loc:{start:{line:38,column:8},end:{line:38,column:113}},type:"binary-expr",locations:[{start:{line:38,column:8},end:{line:38,column:60}},{start:{line:38,column:64},end:{line:38,column:113}}],line:38},"5":{loc:{start:{line:46,column:4},end:{line:48,column:5}},type:"if",locations:[{start:{line:46,column:4},end:{line:48,column:5}},{start:{line:46,column:4},end:{line:48,column:5}}],line:46},"6":{loc:{start:{line:49,column:4},end:{line:62,column:5}},type:"if",locations:[{start:{line:49,column:4},end:{line:62,column:5}},{start:{line:49,column:4},end:{line:62,column:5}}],line:49},"7":{loc:{start:{line:56,column:8},end:{line:61,column:9}},type:"if",locations:[{start:{line:56,column:8},end:{line:61,column:9}},{start:{line:56,column:8},end:{line:61,column:9}}],line:56},"8":{loc:{start:{line:67,column:4},end:{line:69,column:5}},type:"if",locations:[{start:{line:67,column:4},end:{line:69,column:5}},{start:{line:67,column:4},end:{line:69,column:5}}],line:67},"9":{loc:{start:{line:70,column:4},end:{line:73,column:5}},type:"if",locations:[{start:{line:70,column:4},end:{line:73,column:5}},{start:{line:70,column:4},end:{line:73,column:5}}],line:70},"10":{loc:{start:{line:74,column:4},end:{line:76,column:5}},type:"if",locations:[{start:{line:74,column:4},end:{line:76,column:5}},{start:{line:74,column:4},end:{line:76,column:5}}],line:74},"11":{loc:{start:{line:80,column:4},end:{line:91,column:5}},type:"if",locations:[{start:{line:80,column:4},end:{line:91,column:5}},{start:{line:80,column:4},end:{line:91,column:5}}],line:80},"12":{loc:{start:{line:82,column:8},end:{line:90,column:9}},type:"if",locations:[{start:{line:82,column:8},end:{line:90,column:9}},{start:{line:82,column:8},end:{line:90,column:9}}],line:82},"13":{loc:{start:{line:84,column:12},end:{line:86,column:13}},type:"if",locations:[{start:{line:84,column:12},end:{line:86,column:13}},{start:{line:84,column:12},end:{line:86,column:13}}],line:84},"14":{loc:{start:{line:92,column:4},end:{line:102,column:5}},type:"if",locations:[{start:{line:92,column:4},end:{line:102,column:5}},{start:{line:92,column:4},end:{line:102,column:5}}],line:92},"15":{loc:{start:{line:98,column:25},end:{line:98,column:80}},type:"cond-expr",locations:[{start:{line:98,column:49},end:{line:98,column:51}},{start:{line:98,column:54},end:{line:98,column:80}}],line:98},"16":{loc:{start:{line:99,column:27},end:{line:99,column:86}},type:"cond-expr",locations:[{start:{line:99,column:53},end:{line:99,column:55}},{start:{line:99,column:58},end:{line:99,column:86}}],line:99},"17":{loc:{start:{line:103,column:4},end:{line:106,column:5}},type:"if",locations:[{start:{line:103,column:4},end:{line:106,column:5}},{start:{line:103,column:4},end:{line:106,column:5}}],line:103},"18":{loc:{start:{line:107,column:4},end:{line:114,column:5}},type:"if",locations:[{start:{line:107,column:4},end:{line:114,column:5}},{start:{line:107,column:4},end:{line:114,column:5}}],line:107},"19":{loc:{start:{line:115,column:4},end:{line:119,column:5}},type:"if",locations:[{start:{line:115,column:4},end:{line:119,column:5}},{start:{line:115,column:4},end:{line:119,column:5}}],line:115},"20":{loc:{start:{line:120,column:4},end:{line:123,column:5}},type:"if",locations:[{start:{line:120,column:4},end:{line:123,column:5}},{start:{line:120,column:4},end:{line:123,column:5}}],line:120},"21":{loc:{start:{line:124,column:4},end:{line:137,column:5}},type:"if",locations:[{start:{line:124,column:4},end:{line:137,column:5}},{start:{line:124,column:4},end:{line:137,column:5}}],line:124},"22":{loc:{start:{line:126,column:8},end:{line:128,column:9}},type:"if",locations:[{start:{line:126,column:8},end:{line:128,column:9}},{start:{line:126,column:8},end:{line:128,column:9}}],line:126}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0]},inputSourceMap:{version:3,file:"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/effect-reducers/game-effect.ts",sources:["/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/effect-reducers/game-effect.ts"],names:[],mappings:"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",sourcesContent:["import { GameError } from '../../game-error';\nimport { GameMessage, GameLog } from '../../game-message';\nimport { EndTurnEffect } from '../effects/game-phase-effects';\nimport { Effect } from '../effects/effect';\nimport { State, GamePhase } from '../state/state';\nimport { StoreLike } from '../store-like';\nimport { StateUtils } from '../state-utils';\nimport { CheckPokemonTypeEffect, CheckPokemonStatsEffect,\n  CheckProvidedEnergyEffect, CheckAttackCostEffect } from '../effects/check-effects';\nimport { Weakness, Resistance } from '../card/pokemon-types';\nimport { CardType, SpecialCondition, CardTag } from '../card/card-types';\nimport { AttackEffect, UseAttackEffect, HealEffect, KnockOutEffect,\n  UsePowerEffect, PowerEffect, UseStadiumEffect, EvolveEffect } from '../effects/game-effects';\nimport { CoinFlipPrompt } from '../prompts/coin-flip-prompt';\nimport { DealDamageEffect, ApplyWeaknessEffect } from '../effects/attack-effects';\n\nfunction applyWeaknessAndResistance(\n  damage: number,\n  cardTypes: CardType[],\n  weakness: Weakness[],\n  resistance: Resistance[]\n): number {\n  let multiply = 1;\n  let modifier = 0;\n\n  for (const item of weakness) {\n    if (cardTypes.includes(item.type)) {\n      if (item.value === undefined) {\n        multiply *= 2;\n      } else {\n        modifier += item.value;\n      }\n    }\n  }\n\n  for (const item of resistance) {\n    if (cardTypes.includes(item.type)) {\n      modifier += item.value;\n    }\n  }\n\n  return (damage * multiply) + modifier;\n}\n\nfunction* useAttack(next: Function, store: StoreLike, state: State, effect: UseAttackEffect): IterableIterator<State> {\n  const player = effect.player;\n  const opponent = StateUtils.getOpponent(state, player);\n\n  const sp = player.active.specialConditions;\n  if (sp.includes(SpecialCondition.PARALYZED) || sp.includes(SpecialCondition.ASLEEP)) {\n    throw new GameError(GameMessage.BLOCKED_BY_SPECIAL_CONDITION);\n  }\n\n  const attack = effect.attack;\n  const checkAttackCost = new CheckAttackCostEffect(player, attack);\n  state = store.reduceEffect(state, checkAttackCost);\n\n  const checkProvidedEnergy = new CheckProvidedEnergyEffect(player);\n  state = store.reduceEffect(state, checkProvidedEnergy);\n\n  if (StateUtils.checkEnoughEnergy(checkProvidedEnergy.energyMap, checkAttackCost.cost) === false) {\n    throw new GameError(GameMessage.NOT_ENOUGH_ENERGY);\n  }\n\n  if (sp.includes(SpecialCondition.CONFUSED)) {\n    let flip = false;\n\n    store.log(state, GameLog.LOG_FLIP_CONFUSION, { name: player.name });\n    yield store.prompt(state, new CoinFlipPrompt(\n      player.id,\n      GameMessage.FLIP_CONFUSION),\n    result => {\n      flip = result;\n      next();\n    });\n\n    if (flip === false) {\n      store.log(state, GameLog.LOG_HURTS_ITSELF);\n      player.active.damage += 30;\n      state = store.reduceEffect(state, new EndTurnEffect(player));\n      return state;\n    }\n  }\n\n  store.log(state, GameLog.LOG_PLAYER_USES_ATTACK, { name: player.name, attack: attack.name });\n  state.phase = GamePhase.ATTACK;\n  const attackEffect = new AttackEffect(player, opponent, attack);\n  state = store.reduceEffect(state, attackEffect);\n\n  if (store.hasPrompts()) {\n    yield store.waitPrompt(state, () => next());\n  }\n\n  if (attackEffect.damage > 0) {\n    const dealDamage = new DealDamageEffect(attackEffect, attackEffect.damage);\n    state = store.reduceEffect(state, dealDamage);\n  }\n\n  if (store.hasPrompts()) {\n    yield store.waitPrompt(state, () => next());\n  }\n\n  return store.reduceEffect(state, new EndTurnEffect(player));\n}\n\nexport function gameReducer(store: StoreLike, state: State, effect: Effect): State {\n\n  if (effect instanceof KnockOutEffect) {\n    const card = effect.target.getPokemonCard();\n    if (card !== undefined) {\n\n      // Pokemon ex rule\n      if (card.tags.includes(CardTag.POKEMON_EX)) {\n        effect.prizeCount += 1;\n      }\n\n      store.log(state, GameLog.LOG_POKEMON_KO, { name: card.name });\n      effect.target.moveTo(effect.player.discard);\n      effect.target.clearEffects();\n    }\n  }\n\n  if (effect instanceof ApplyWeaknessEffect) {\n    const checkPokemonType = new CheckPokemonTypeEffect(effect.source);\n    state = store.reduceEffect(state, checkPokemonType);\n    const checkPokemonStats = new CheckPokemonStatsEffect(effect.target);\n    state = store.reduceEffect(state, checkPokemonStats);\n\n    const cardType = checkPokemonType.cardTypes;\n    const weakness = effect.ignoreWeakness ? [] : checkPokemonStats.weakness;\n    const resistance = effect.ignoreResistance ? [] : checkPokemonStats.resistance;\n    effect.damage = applyWeaknessAndResistance(effect.damage, cardType, weakness, resistance);\n    return state;\n  }\n\n  if (effect instanceof UseAttackEffect) {\n    const generator = useAttack(() => generator.next(), store, state, effect);\n    return generator.next().value;\n  }\n\n  if (effect instanceof UsePowerEffect) {\n    const player = effect.player;\n    const power = effect.power;\n    const card = effect.card;\n\n    store.log(state, GameLog.LOG_PLAYER_USES_ABILITY, { name: player.name, ability: power.name });\n    state = store.reduceEffect(state, new PowerEffect(player, power, card));\n    return state;\n  }\n\n  if (effect instanceof UseStadiumEffect) {\n    const player = effect.player;\n    store.log(state, GameLog.LOG_PLAYER_USES_STADIUM, { name: player.name, stadium: effect.stadium.name });\n    player.stadiumUsedTurn = state.turn;\n  }\n\n  if (effect instanceof HealEffect) {\n    effect.target.damage = Math.max(0, effect.target.damage - effect.damage);\n    return state;\n  }\n\n  if (effect instanceof EvolveEffect) {\n    const pokemonCard = effect.target.getPokemonCard();\n    if (pokemonCard === undefined) {\n      throw new GameError(GameMessage.INVALID_TARGET);\n    }\n    store.log(state, GameLog.LOG_PLAYER_EVOLVES_POKEMON, {\n      name: effect.player.name,\n      pokemon: pokemonCard.name,\n      card: effect.pokemonCard.name\n    });\n    effect.player.hand.moveCardTo(effect.pokemonCard, effect.target);\n    effect.target.pokemonPlayedTurn = state.turn;\n    effect.target.clearEffects();\n  }\n\n  return state;\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"0b07e3560944a6ab46d63167478b6b6a7d5a3b54"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_sj1c0ol4e=function(){return actualCoverage;};}return actualCoverage;}cov_sj1c0ol4e();cov_sj1c0ol4e().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_sj1c0ol4e().s[1]++;exports.gameReducer=void 0;const game_error_1=(cov_sj1c0ol4e().s[2]++,require("../../game-error"));const game_message_1=(cov_sj1c0ol4e().s[3]++,require("../../game-message"));const game_phase_effects_1=(cov_sj1c0ol4e().s[4]++,require("../effects/game-phase-effects"));const state_1=(cov_sj1c0ol4e().s[5]++,require("../state/state"));const state_utils_1=(cov_sj1c0ol4e().s[6]++,require("../state-utils"));const check_effects_1=(cov_sj1c0ol4e().s[7]++,require("../effects/check-effects"));const card_types_1=(cov_sj1c0ol4e().s[8]++,require("../card/card-types"));const game_effects_1=(cov_sj1c0ol4e().s[9]++,require("../effects/game-effects"));const coin_flip_prompt_1=(cov_sj1c0ol4e().s[10]++,require("../prompts/coin-flip-prompt"));const attack_effects_1=(cov_sj1c0ol4e().s[11]++,require("../effects/attack-effects"));function applyWeaknessAndResistance(damage,cardTypes,weakness,resistance){cov_sj1c0ol4e().f[0]++;let multiply=(cov_sj1c0ol4e().s[12]++,1);let modifier=(cov_sj1c0ol4e().s[13]++,0);cov_sj1c0ol4e().s[14]++;for(const item of weakness){cov_sj1c0ol4e().s[15]++;if(cardTypes.includes(item.type)){cov_sj1c0ol4e().b[0][0]++;cov_sj1c0ol4e().s[16]++;if(item.value===undefined){cov_sj1c0ol4e().b[1][0]++;cov_sj1c0ol4e().s[17]++;multiply*=2;}else{cov_sj1c0ol4e().b[1][1]++;cov_sj1c0ol4e().s[18]++;modifier+=item.value;}}else{cov_sj1c0ol4e().b[0][1]++;}}cov_sj1c0ol4e().s[19]++;for(const item of resistance){cov_sj1c0ol4e().s[20]++;if(cardTypes.includes(item.type)){cov_sj1c0ol4e().b[2][0]++;cov_sj1c0ol4e().s[21]++;modifier+=item.value;}else{cov_sj1c0ol4e().b[2][1]++;}}cov_sj1c0ol4e().s[22]++;return damage*multiply+modifier;}function*useAttack(next,store,state,effect){cov_sj1c0ol4e().f[1]++;const player=(cov_sj1c0ol4e().s[23]++,effect.player);const opponent=(cov_sj1c0ol4e().s[24]++,state_utils_1.StateUtils.getOpponent(state,player));const sp=(cov_sj1c0ol4e().s[25]++,player.active.specialConditions);cov_sj1c0ol4e().s[26]++;if((cov_sj1c0ol4e().b[4][0]++,sp.includes(card_types_1.SpecialCondition.PARALYZED))||(cov_sj1c0ol4e().b[4][1]++,sp.includes(card_types_1.SpecialCondition.ASLEEP))){cov_sj1c0ol4e().b[3][0]++;cov_sj1c0ol4e().s[27]++;throw new game_error_1.GameError(game_message_1.GameMessage.BLOCKED_BY_SPECIAL_CONDITION);}else{cov_sj1c0ol4e().b[3][1]++;}const attack=(cov_sj1c0ol4e().s[28]++,effect.attack);const checkAttackCost=(cov_sj1c0ol4e().s[29]++,new check_effects_1.CheckAttackCostEffect(player,attack));cov_sj1c0ol4e().s[30]++;state=store.reduceEffect(state,checkAttackCost);const checkProvidedEnergy=(cov_sj1c0ol4e().s[31]++,new check_effects_1.CheckProvidedEnergyEffect(player));cov_sj1c0ol4e().s[32]++;state=store.reduceEffect(state,checkProvidedEnergy);cov_sj1c0ol4e().s[33]++;if(state_utils_1.StateUtils.checkEnoughEnergy(checkProvidedEnergy.energyMap,checkAttackCost.cost)===false){cov_sj1c0ol4e().b[5][0]++;cov_sj1c0ol4e().s[34]++;throw new game_error_1.GameError(game_message_1.GameMessage.NOT_ENOUGH_ENERGY);}else{cov_sj1c0ol4e().b[5][1]++;}cov_sj1c0ol4e().s[35]++;if(sp.includes(card_types_1.SpecialCondition.CONFUSED)){cov_sj1c0ol4e().b[6][0]++;let flip=(cov_sj1c0ol4e().s[36]++,false);cov_sj1c0ol4e().s[37]++;store.log(state,game_message_1.GameLog.LOG_FLIP_CONFUSION,{name:player.name});cov_sj1c0ol4e().s[38]++;yield store.prompt(state,new coin_flip_prompt_1.CoinFlipPrompt(player.id,game_message_1.GameMessage.FLIP_CONFUSION),result=>{cov_sj1c0ol4e().f[2]++;cov_sj1c0ol4e().s[39]++;flip=result;cov_sj1c0ol4e().s[40]++;next();});cov_sj1c0ol4e().s[41]++;if(flip===false){cov_sj1c0ol4e().b[7][0]++;cov_sj1c0ol4e().s[42]++;store.log(state,game_message_1.GameLog.LOG_HURTS_ITSELF);cov_sj1c0ol4e().s[43]++;player.active.damage+=30;cov_sj1c0ol4e().s[44]++;state=store.reduceEffect(state,new game_phase_effects_1.EndTurnEffect(player));cov_sj1c0ol4e().s[45]++;return state;}else{cov_sj1c0ol4e().b[7][1]++;}}else{cov_sj1c0ol4e().b[6][1]++;}cov_sj1c0ol4e().s[46]++;store.log(state,game_message_1.GameLog.LOG_PLAYER_USES_ATTACK,{name:player.name,attack:attack.name});cov_sj1c0ol4e().s[47]++;state.phase=state_1.GamePhase.ATTACK;const attackEffect=(cov_sj1c0ol4e().s[48]++,new game_effects_1.AttackEffect(player,opponent,attack));cov_sj1c0ol4e().s[49]++;state=store.reduceEffect(state,attackEffect);cov_sj1c0ol4e().s[50]++;if(store.hasPrompts()){cov_sj1c0ol4e().b[8][0]++;cov_sj1c0ol4e().s[51]++;yield store.waitPrompt(state,()=>{cov_sj1c0ol4e().f[3]++;cov_sj1c0ol4e().s[52]++;return next();});}else{cov_sj1c0ol4e().b[8][1]++;}cov_sj1c0ol4e().s[53]++;if(attackEffect.damage>0){cov_sj1c0ol4e().b[9][0]++;const dealDamage=(cov_sj1c0ol4e().s[54]++,new attack_effects_1.DealDamageEffect(attackEffect,attackEffect.damage));cov_sj1c0ol4e().s[55]++;state=store.reduceEffect(state,dealDamage);}else{cov_sj1c0ol4e().b[9][1]++;}cov_sj1c0ol4e().s[56]++;if(store.hasPrompts()){cov_sj1c0ol4e().b[10][0]++;cov_sj1c0ol4e().s[57]++;yield store.waitPrompt(state,()=>{cov_sj1c0ol4e().f[4]++;cov_sj1c0ol4e().s[58]++;return next();});}else{cov_sj1c0ol4e().b[10][1]++;}cov_sj1c0ol4e().s[59]++;return store.reduceEffect(state,new game_phase_effects_1.EndTurnEffect(player));}function gameReducer(store,state,effect){cov_sj1c0ol4e().f[5]++;cov_sj1c0ol4e().s[60]++;if(effect instanceof game_effects_1.KnockOutEffect){cov_sj1c0ol4e().b[11][0]++;const card=(cov_sj1c0ol4e().s[61]++,effect.target.getPokemonCard());cov_sj1c0ol4e().s[62]++;if(card!==undefined){cov_sj1c0ol4e().b[12][0]++;cov_sj1c0ol4e().s[63]++;// Pokemon ex rule
if(card.tags.includes(card_types_1.CardTag.POKEMON_EX)){cov_sj1c0ol4e().b[13][0]++;cov_sj1c0ol4e().s[64]++;effect.prizeCount+=1;}else{cov_sj1c0ol4e().b[13][1]++;}cov_sj1c0ol4e().s[65]++;store.log(state,game_message_1.GameLog.LOG_POKEMON_KO,{name:card.name});cov_sj1c0ol4e().s[66]++;effect.target.moveTo(effect.player.discard);cov_sj1c0ol4e().s[67]++;effect.target.clearEffects();}else{cov_sj1c0ol4e().b[12][1]++;}}else{cov_sj1c0ol4e().b[11][1]++;}cov_sj1c0ol4e().s[68]++;if(effect instanceof attack_effects_1.ApplyWeaknessEffect){cov_sj1c0ol4e().b[14][0]++;const checkPokemonType=(cov_sj1c0ol4e().s[69]++,new check_effects_1.CheckPokemonTypeEffect(effect.source));cov_sj1c0ol4e().s[70]++;state=store.reduceEffect(state,checkPokemonType);const checkPokemonStats=(cov_sj1c0ol4e().s[71]++,new check_effects_1.CheckPokemonStatsEffect(effect.target));cov_sj1c0ol4e().s[72]++;state=store.reduceEffect(state,checkPokemonStats);const cardType=(cov_sj1c0ol4e().s[73]++,checkPokemonType.cardTypes);const weakness=(cov_sj1c0ol4e().s[74]++,effect.ignoreWeakness?(cov_sj1c0ol4e().b[15][0]++,[]):(cov_sj1c0ol4e().b[15][1]++,checkPokemonStats.weakness));const resistance=(cov_sj1c0ol4e().s[75]++,effect.ignoreResistance?(cov_sj1c0ol4e().b[16][0]++,[]):(cov_sj1c0ol4e().b[16][1]++,checkPokemonStats.resistance));cov_sj1c0ol4e().s[76]++;effect.damage=applyWeaknessAndResistance(effect.damage,cardType,weakness,resistance);cov_sj1c0ol4e().s[77]++;return state;}else{cov_sj1c0ol4e().b[14][1]++;}cov_sj1c0ol4e().s[78]++;if(effect instanceof game_effects_1.UseAttackEffect){cov_sj1c0ol4e().b[17][0]++;const generator=(cov_sj1c0ol4e().s[79]++,useAttack(()=>{cov_sj1c0ol4e().f[6]++;cov_sj1c0ol4e().s[80]++;return generator.next();},store,state,effect));cov_sj1c0ol4e().s[81]++;return generator.next().value;}else{cov_sj1c0ol4e().b[17][1]++;}cov_sj1c0ol4e().s[82]++;if(effect instanceof game_effects_1.UsePowerEffect){cov_sj1c0ol4e().b[18][0]++;const player=(cov_sj1c0ol4e().s[83]++,effect.player);const power=(cov_sj1c0ol4e().s[84]++,effect.power);const card=(cov_sj1c0ol4e().s[85]++,effect.card);cov_sj1c0ol4e().s[86]++;store.log(state,game_message_1.GameLog.LOG_PLAYER_USES_ABILITY,{name:player.name,ability:power.name});cov_sj1c0ol4e().s[87]++;state=store.reduceEffect(state,new game_effects_1.PowerEffect(player,power,card));cov_sj1c0ol4e().s[88]++;return state;}else{cov_sj1c0ol4e().b[18][1]++;}cov_sj1c0ol4e().s[89]++;if(effect instanceof game_effects_1.UseStadiumEffect){cov_sj1c0ol4e().b[19][0]++;const player=(cov_sj1c0ol4e().s[90]++,effect.player);cov_sj1c0ol4e().s[91]++;store.log(state,game_message_1.GameLog.LOG_PLAYER_USES_STADIUM,{name:player.name,stadium:effect.stadium.name});cov_sj1c0ol4e().s[92]++;player.stadiumUsedTurn=state.turn;}else{cov_sj1c0ol4e().b[19][1]++;}cov_sj1c0ol4e().s[93]++;if(effect instanceof game_effects_1.HealEffect){cov_sj1c0ol4e().b[20][0]++;cov_sj1c0ol4e().s[94]++;effect.target.damage=Math.max(0,effect.target.damage-effect.damage);cov_sj1c0ol4e().s[95]++;return state;}else{cov_sj1c0ol4e().b[20][1]++;}cov_sj1c0ol4e().s[96]++;if(effect instanceof game_effects_1.EvolveEffect){cov_sj1c0ol4e().b[21][0]++;const pokemonCard=(cov_sj1c0ol4e().s[97]++,effect.target.getPokemonCard());cov_sj1c0ol4e().s[98]++;if(pokemonCard===undefined){cov_sj1c0ol4e().b[22][0]++;cov_sj1c0ol4e().s[99]++;throw new game_error_1.GameError(game_message_1.GameMessage.INVALID_TARGET);}else{cov_sj1c0ol4e().b[22][1]++;}cov_sj1c0ol4e().s[100]++;store.log(state,game_message_1.GameLog.LOG_PLAYER_EVOLVES_POKEMON,{name:effect.player.name,pokemon:pokemonCard.name,card:effect.pokemonCard.name});cov_sj1c0ol4e().s[101]++;effect.player.hand.moveCardTo(effect.pokemonCard,effect.target);cov_sj1c0ol4e().s[102]++;effect.target.pokemonPlayedTurn=state.turn;cov_sj1c0ol4e().s[103]++;effect.target.clearEffects();}else{cov_sj1c0ol4e().b[21][1]++;}cov_sj1c0ol4e().s[104]++;return state;}cov_sj1c0ol4e().s[105]++;exports.gameReducer=gameReducer;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2pvZW15ZXJzY291Z2gvRG9jdW1lbnRzL0dpdEh1Yi9wdGNnLWVwc2QvcHRjZy1zZXJ2ZXIvc3JjL2dhbWUvc3RvcmUvZWZmZWN0LXJlZHVjZXJzL2dhbWUtZWZmZWN0LnRzIiwic291cmNlcyI6WyIvVXNlcnMvam9lbXllcnNjb3VnaC9Eb2N1bWVudHMvR2l0SHViL3B0Y2ctZXBzZC9wdGNnLXNlcnZlci9zcmMvZ2FtZS9zdG9yZS9lZmZlY3QtcmVkdWNlcnMvZ2FtZS1lZmZlY3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsaURBQTZDO0FBQzdDLHFEQUEwRDtBQUMxRCxzRUFBOEQ7QUFFOUQsMENBQWtEO0FBRWxELGdEQUE0QztBQUM1Qyw0REFDcUY7QUFFckYsbURBQXlFO0FBQ3pFLDBEQUMrRjtBQUMvRixrRUFBNkQ7QUFDN0QsOERBQWtGO0FBRWxGLFNBQVMsMEJBQTBCLENBQ2pDLE1BQWMsRUFDZCxTQUFxQixFQUNyQixRQUFvQixFQUNwQixVQUF3QjtJQUV4QixJQUFJLFFBQVEsR0FBRyxDQUFDLENBQUM7SUFDakIsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO0lBRWpCLEtBQUssTUFBTSxJQUFJLElBQUksUUFBUSxFQUFFO1FBQzNCLElBQUksU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDakMsSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLFNBQVMsRUFBRTtnQkFDNUIsUUFBUSxJQUFJLENBQUMsQ0FBQzthQUNmO2lCQUFNO2dCQUNMLFFBQVEsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDO2FBQ3hCO1NBQ0Y7S0FDRjtJQUVELEtBQUssTUFBTSxJQUFJLElBQUksVUFBVSxFQUFFO1FBQzdCLElBQUksU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDakMsUUFBUSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUM7U0FDeEI7S0FDRjtJQUVELE9BQU8s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O1FBQ3pFLE9BQU8sS0FBSyxDQUFDO0tBQ2Q7SUFFRCxJQUFJLE1BQU0sWUFBWSwyQkFBWSxFQUFFO1FBQ2xDLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDbkQsSUFBSSxXQUFXLEtBQUssU0FBUyxFQUFFO1lBQzdCLE1BQU0sSUFBSSxzQkFBUyxDQUFDLDBCQUFXLENBQUMsY0FBYyxDQUFDLENBQUM7U0FDakQ7UUFDRCxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxzQkFBTyxDQUFDLDBCQUEwQixFQUFFO1lBQ25ELElBQUksRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUk7WUFDeEIsT0FBTyxFQUFFLFdBQVcsQ0FBQyxJQUFJO1lBQ3pCLElBQUksRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUk7U0FDOUIsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pFLE1BQU0sQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQztRQUM3QyxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFDO0tBQzlCO0lBRUQsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBeEVELGtDQXdFQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdhbWVFcnJvciB9IGZyb20gJy4uLy4uL2dhbWUtZXJyb3InO1xuaW1wb3J0IHsgR2FtZU1lc3NhZ2UsIEdhbWVMb2cgfSBmcm9tICcuLi8uLi9nYW1lLW1lc3NhZ2UnO1xuaW1wb3J0IHsgRW5kVHVybkVmZmVjdCB9IGZyb20gJy4uL2VmZmVjdHMvZ2FtZS1waGFzZS1lZmZlY3RzJztcbmltcG9ydCB7IEVmZmVjdCB9IGZyb20gJy4uL2VmZmVjdHMvZWZmZWN0JztcbmltcG9ydCB7IFN0YXRlLCBHYW1lUGhhc2UgfSBmcm9tICcuLi9zdGF0ZS9zdGF0ZSc7XG5pbXBvcnQgeyBTdG9yZUxpa2UgfSBmcm9tICcuLi9zdG9yZS1saWtlJztcbmltcG9ydCB7IFN0YXRlVXRpbHMgfSBmcm9tICcuLi9zdGF0ZS11dGlscyc7XG5pbXBvcnQgeyBDaGVja1Bva2Vtb25UeXBlRWZmZWN0LCBDaGVja1Bva2Vtb25TdGF0c0VmZmVjdCxcbiAgQ2hlY2tQcm92aWRlZEVuZXJneUVmZmVjdCwgQ2hlY2tBdHRhY2tDb3N0RWZmZWN0IH0gZnJvbSAnLi4vZWZmZWN0cy9jaGVjay1lZmZlY3RzJztcbmltcG9ydCB7IFdlYWtuZXNzLCBSZXNpc3RhbmNlIH0gZnJvbSAnLi4vY2FyZC9wb2tlbW9uLXR5cGVzJztcbmltcG9ydCB7IENhcmRUeXBlLCBTcGVjaWFsQ29uZGl0aW9uLCBDYXJkVGFnIH0gZnJvbSAnLi4vY2FyZC9jYXJkLXR5cGVzJztcbmltcG9ydCB7IEF0dGFja0VmZmVjdCwgVXNlQXR0YWNrRWZmZWN0LCBIZWFsRWZmZWN0LCBLbm9ja091dEVmZmVjdCxcbiAgVXNlUG93ZXJFZmZlY3QsIFBvd2VyRWZmZWN0LCBVc2VTdGFkaXVtRWZmZWN0LCBFdm9sdmVFZmZlY3QgfSBmcm9tICcuLi9lZmZlY3RzL2dhbWUtZWZmZWN0cyc7XG5pbXBvcnQgeyBDb2luRmxpcFByb21wdCB9IGZyb20gJy4uL3Byb21wdHMvY29pbi1mbGlwLXByb21wdCc7XG5pbXBvcnQgeyBEZWFsRGFtYWdlRWZmZWN0LCBBcHBseVdlYWtuZXNzRWZmZWN0IH0gZnJvbSAnLi4vZWZmZWN0cy9hdHRhY2stZWZmZWN0cyc7XG5cbmZ1bmN0aW9uIGFwcGx5V2Vha25lc3NBbmRSZXNpc3RhbmNlKFxuICBkYW1hZ2U6IG51bWJlcixcbiAgY2FyZFR5cGVzOiBDYXJkVHlwZVtdLFxuICB3ZWFrbmVzczogV2Vha25lc3NbXSxcbiAgcmVzaXN0YW5jZTogUmVzaXN0YW5jZVtdXG4pOiBudW1iZXIge1xuICBsZXQgbXVsdGlwbHkgPSAxO1xuICBsZXQgbW9kaWZpZXIgPSAwO1xuXG4gIGZvciAoY29uc3QgaXRlbSBvZiB3ZWFrbmVzcykge1xuICAgIGlmIChjYXJkVHlwZXMuaW5jbHVkZXMoaXRlbS50eXBlKSkge1xuICAgICAgaWYgKGl0ZW0udmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBtdWx0aXBseSAqPSAyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbW9kaWZpZXIgKz0gaXRlbS52YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmb3IgKGNvbnN0IGl0ZW0gb2YgcmVzaXN0YW5jZSkge1xuICAgIGlmIChjYXJkVHlwZXMuaW5jbHVkZXMoaXRlbS50eXBlKSkge1xuICAgICAgbW9kaWZpZXIgKz0gaXRlbS52YWx1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gKGRhbWFnZSAqIG11bHRpcGx5KSArIG1vZGlmaWVyO1xufVxuXG5mdW5jdGlvbiogdXNlQXR0YWNrKG5leHQ6IEZ1bmN0aW9uLCBzdG9yZTogU3RvcmVMaWtlLCBzdGF0ZTogU3RhdGUsIGVmZmVjdDogVXNlQXR0YWNrRWZmZWN0KTogSXRlcmFibGVJdGVyYXRvcjxTdGF0ZT4ge1xuICBjb25zdCBwbGF5ZXIgPSBlZmZlY3QucGxheWVyO1xuICBjb25zdCBvcHBvbmVudCA9IFN0YXRlVXRpbHMuZ2V0T3Bwb25lbnQoc3RhdGUsIHBsYXllcik7XG5cbiAgY29uc3Qgc3AgPSBwbGF5ZXIuYWN0aXZlLnNwZWNpYWxDb25kaXRpb25zO1xuICBpZiAoc3AuaW5jbHVkZXMoU3BlY2lhbENvbmRpdGlvbi5QQVJBTFlaRUQpIHx8IHNwLmluY2x1ZGVzKFNwZWNpYWxDb25kaXRpb24uQVNMRUVQKSkge1xuICAgIHRocm93IG5ldyBHYW1lRXJyb3IoR2FtZU1lc3NhZ2UuQkxPQ0tFRF9CWV9TUEVDSUFMX0NPTkRJVElPTik7XG4gIH1cblxuICBjb25zdCBhdHRhY2sgPSBlZmZlY3QuYXR0YWNrO1xuICBjb25zdCBjaGVja0F0dGFja0Nvc3QgPSBuZXcgQ2hlY2tBdHRhY2tDb3N0RWZmZWN0KHBsYXllciwgYXR0YWNrKTtcbiAgc3RhdGUgPSBzdG9yZS5yZWR1Y2VFZmZlY3Qoc3RhdGUsIGNoZWNrQXR0YWNrQ29zdCk7XG5cbiAgY29uc3QgY2hlY2tQcm92aWRlZEVuZXJneSA9IG5ldyBDaGVja1Byb3ZpZGVkRW5lcmd5RWZmZWN0KHBsYXllcik7XG4gIHN0YXRlID0gc3RvcmUucmVkdWNlRWZmZWN0KHN0YXRlLCBjaGVja1Byb3ZpZGVkRW5lcmd5KTtcblxuICBpZiAoU3RhdGVVdGlscy5jaGVja0Vub3VnaEVuZXJneShjaGVja1Byb3ZpZGVkRW5lcmd5LmVuZXJneU1hcCwgY2hlY2tBdHRhY2tDb3N0LmNvc3QpID09PSBmYWxzZSkge1xuICAgIHRocm93IG5ldyBHYW1lRXJyb3IoR2FtZU1lc3NhZ2UuTk9UX0VOT1VHSF9FTkVSR1kpO1xuICB9XG5cbiAgaWYgKHNwLmluY2x1ZGVzKFNwZWNpYWxDb25kaXRpb24uQ09ORlVTRUQpKSB7XG4gICAgbGV0IGZsaXAgPSBmYWxzZTtcblxuICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfRkxJUF9DT05GVVNJT04sIHsgbmFtZTogcGxheWVyLm5hbWUgfSk7XG4gICAgeWllbGQgc3RvcmUucHJvbXB0KHN0YXRlLCBuZXcgQ29pbkZsaXBQcm9tcHQoXG4gICAgICBwbGF5ZXIuaWQsXG4gICAgICBHYW1lTWVzc2FnZS5GTElQX0NPTkZVU0lPTiksXG4gICAgcmVzdWx0ID0+IHtcbiAgICAgIGZsaXAgPSByZXN1bHQ7XG4gICAgICBuZXh0KCk7XG4gICAgfSk7XG5cbiAgICBpZiAoZmxpcCA9PT0gZmFsc2UpIHtcbiAgICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfSFVSVFNfSVRTRUxGKTtcbiAgICAgIHBsYXllci5hY3RpdmUuZGFtYWdlICs9IDMwO1xuICAgICAgc3RhdGUgPSBzdG9yZS5yZWR1Y2VFZmZlY3Qoc3RhdGUsIG5ldyBFbmRUdXJuRWZmZWN0KHBsYXllcikpO1xuICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cbiAgfVxuXG4gIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfUExBWUVSX1VTRVNfQVRUQUNLLCB7IG5hbWU6IHBsYXllci5uYW1lLCBhdHRhY2s6IGF0dGFjay5uYW1lIH0pO1xuICBzdGF0ZS5waGFzZSA9IEdhbWVQaGFzZS5BVFRBQ0s7XG4gIGNvbnN0IGF0dGFja0VmZmVjdCA9IG5ldyBBdHRhY2tFZmZlY3QocGxheWVyLCBvcHBvbmVudCwgYXR0YWNrKTtcbiAgc3RhdGUgPSBzdG9yZS5yZWR1Y2VFZmZlY3Qoc3RhdGUsIGF0dGFja0VmZmVjdCk7XG5cbiAgaWYgKHN0b3JlLmhhc1Byb21wdHMoKSkge1xuICAgIHlpZWxkIHN0b3JlLndhaXRQcm9tcHQoc3RhdGUsICgpID0+IG5leHQoKSk7XG4gIH1cblxuICBpZiAoYXR0YWNrRWZmZWN0LmRhbWFnZSA+IDApIHtcbiAgICBjb25zdCBkZWFsRGFtYWdlID0gbmV3IERlYWxEYW1hZ2VFZmZlY3QoYXR0YWNrRWZmZWN0LCBhdHRhY2tFZmZlY3QuZGFtYWdlKTtcbiAgICBzdGF0ZSA9IHN0b3JlLnJlZHVjZUVmZmVjdChzdGF0ZSwgZGVhbERhbWFnZSk7XG4gIH1cblxuICBpZiAoc3RvcmUuaGFzUHJvbXB0cygpKSB7XG4gICAgeWllbGQgc3RvcmUud2FpdFByb21wdChzdGF0ZSwgKCkgPT4gbmV4dCgpKTtcbiAgfVxuXG4gIHJldHVybiBzdG9yZS5yZWR1Y2VFZmZlY3Qoc3RhdGUsIG5ldyBFbmRUdXJuRWZmZWN0KHBsYXllcikpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2FtZVJlZHVjZXIoc3RvcmU6IFN0b3JlTGlrZSwgc3RhdGU6IFN0YXRlLCBlZmZlY3Q6IEVmZmVjdCk6IFN0YXRlIHtcblxuICBpZiAoZWZmZWN0IGluc3RhbmNlb2YgS25vY2tPdXRFZmZlY3QpIHtcbiAgICBjb25zdCBjYXJkID0gZWZmZWN0LnRhcmdldC5nZXRQb2tlbW9uQ2FyZCgpO1xuICAgIGlmIChjYXJkICE9PSB1bmRlZmluZWQpIHtcblxuICAgICAgLy8gUG9rZW1vbiBleCBydWxlXG4gICAgICBpZiAoY2FyZC50YWdzLmluY2x1ZGVzKENhcmRUYWcuUE9LRU1PTl9FWCkpIHtcbiAgICAgICAgZWZmZWN0LnByaXplQ291bnQgKz0gMTtcbiAgICAgIH1cblxuICAgICAgc3RvcmUubG9nKHN0YXRlLCBHYW1lTG9nLkxPR19QT0tFTU9OX0tPLCB7IG5hbWU6IGNhcmQubmFtZSB9KTtcbiAgICAgIGVmZmVjdC50YXJnZXQubW92ZVRvKGVmZmVjdC5wbGF5ZXIuZGlzY2FyZCk7XG4gICAgICBlZmZlY3QudGFyZ2V0LmNsZWFyRWZmZWN0cygpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChlZmZlY3QgaW5zdGFuY2VvZiBBcHBseVdlYWtuZXNzRWZmZWN0KSB7XG4gICAgY29uc3QgY2hlY2tQb2tlbW9uVHlwZSA9IG5ldyBDaGVja1Bva2Vtb25UeXBlRWZmZWN0KGVmZmVjdC5zb3VyY2UpO1xuICAgIHN0YXRlID0gc3RvcmUucmVkdWNlRWZmZWN0KHN0YXRlLCBjaGVja1Bva2Vtb25UeXBlKTtcbiAgICBjb25zdCBjaGVja1Bva2Vtb25TdGF0cyA9IG5ldyBDaGVja1Bva2Vtb25TdGF0c0VmZmVjdChlZmZlY3QudGFyZ2V0KTtcbiAgICBzdGF0ZSA9IHN0b3JlLnJlZHVjZUVmZmVjdChzdGF0ZSwgY2hlY2tQb2tlbW9uU3RhdHMpO1xuXG4gICAgY29uc3QgY2FyZFR5cGUgPSBjaGVja1Bva2Vtb25UeXBlLmNhcmRUeXBlcztcbiAgICBjb25zdCB3ZWFrbmVzcyA9IGVmZmVjdC5pZ25vcmVXZWFrbmVzcyA/IFtdIDogY2hlY2tQb2tlbW9uU3RhdHMud2Vha25lc3M7XG4gICAgY29uc3QgcmVzaXN0YW5jZSA9IGVmZmVjdC5pZ25vcmVSZXNpc3RhbmNlID8gW10gOiBjaGVja1Bva2Vtb25TdGF0cy5yZXNpc3RhbmNlO1xuICAgIGVmZmVjdC5kYW1hZ2UgPSBhcHBseVdlYWtuZXNzQW5kUmVzaXN0YW5jZShlZmZlY3QuZGFtYWdlLCBjYXJkVHlwZSwgd2Vha25lc3MsIHJlc2lzdGFuY2UpO1xuICAgIHJldHVybiBzdGF0ZTtcbiAgfVxuXG4gIGlmIChlZmZlY3QgaW5zdGFuY2VvZiBVc2VBdHRhY2tFZmZlY3QpIHtcbiAgICBjb25zdCBnZW5lcmF0b3IgPSB1c2VBdHRhY2soKCkgPT4gZ2VuZXJhdG9yLm5leHQoKSwgc3RvcmUsIHN0YXRlLCBlZmZlY3QpO1xuICAgIHJldHVybiBnZW5lcmF0b3IubmV4dCgpLnZhbHVlO1xuICB9XG5cbiAgaWYgKGVmZmVjdCBpbnN0YW5jZW9mIFVzZVBvd2VyRWZmZWN0KSB7XG4gICAgY29uc3QgcGxheWVyID0gZWZmZWN0LnBsYXllcjtcbiAgICBjb25zdCBwb3dlciA9IGVmZmVjdC5wb3dlcjtcbiAgICBjb25zdCBjYXJkID0gZWZmZWN0LmNhcmQ7XG5cbiAgICBzdG9yZS5sb2coc3RhdGUsIEdhbWVMb2cuTE9HX1BMQVlFUl9VU0VTX0FCSUxJVFksIHsgbmFtZTogcGxheWVyLm5hbWUsIGFiaWxpdHk6IHBvd2VyLm5hbWUgfSk7XG4gICAgc3RhdGUgPSBzdG9yZS5yZWR1Y2VFZmZlY3Qoc3RhdGUsIG5ldyBQb3dlckVmZmVjdChwbGF5ZXIsIHBvd2VyLCBjYXJkKSk7XG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG5cbiAgaWYgKGVmZmVjdCBpbnN0YW5jZW9mIFVzZVN0YWRpdW1FZmZlY3QpIHtcbiAgICBjb25zdCBwbGF5ZXIgPSBlZmZlY3QucGxheWVyO1xuICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfUExBWUVSX1VTRVNfU1RBRElVTSwgeyBuYW1lOiBwbGF5ZXIubmFtZSwgc3RhZGl1bTogZWZmZWN0LnN0YWRpdW0ubmFtZSB9KTtcbiAgICBwbGF5ZXIuc3RhZGl1bVVzZWRUdXJuID0gc3RhdGUudHVybjtcbiAgfVxuXG4gIGlmIChlZmZlY3QgaW5zdGFuY2VvZiBIZWFsRWZmZWN0KSB7XG4gICAgZWZmZWN0LnRhcmdldC5kYW1hZ2UgPSBNYXRoLm1heCgwLCBlZmZlY3QudGFyZ2V0LmRhbWFnZSAtIGVmZmVjdC5kYW1hZ2UpO1xuICAgIHJldHVybiBzdGF0ZTtcbiAgfVxuXG4gIGlmIChlZmZlY3QgaW5zdGFuY2VvZiBFdm9sdmVFZmZlY3QpIHtcbiAgICBjb25zdCBwb2tlbW9uQ2FyZCA9IGVmZmVjdC50YXJnZXQuZ2V0UG9rZW1vbkNhcmQoKTtcbiAgICBpZiAocG9rZW1vbkNhcmQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEdhbWVFcnJvcihHYW1lTWVzc2FnZS5JTlZBTElEX1RBUkdFVCk7XG4gICAgfVxuICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfUExBWUVSX0VWT0xWRVNfUE9LRU1PTiwge1xuICAgICAgbmFtZTogZWZmZWN0LnBsYXllci5uYW1lLFxuICAgICAgcG9rZW1vbjogcG9rZW1vbkNhcmQubmFtZSxcbiAgICAgIGNhcmQ6IGVmZmVjdC5wb2tlbW9uQ2FyZC5uYW1lXG4gICAgfSk7XG4gICAgZWZmZWN0LnBsYXllci5oYW5kLm1vdmVDYXJkVG8oZWZmZWN0LnBva2Vtb25DYXJkLCBlZmZlY3QudGFyZ2V0KTtcbiAgICBlZmZlY3QudGFyZ2V0LnBva2Vtb25QbGF5ZWRUdXJuID0gc3RhdGUudHVybjtcbiAgICBlZmZlY3QudGFyZ2V0LmNsZWFyRWZmZWN0cygpO1xuICB9XG5cbiAgcmV0dXJuIHN0YXRlO1xufVxuIl19
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qb2VteWVyc2NvdWdoL0RvY3VtZW50cy9HaXRIdWIvcHRjZy1lcHNkL3B0Y2ctc2VydmVyL3NyYy9nYW1lL3N0b3JlL2VmZmVjdC1yZWR1Y2Vycy9nYW1lLWVmZmVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiMjl4QkF1Qk07Mk5BdkJOLEtBQUEsQ0FBQSxZQUFBLHlCQUFBLE9BQUEsQ0FBQSxrQkFBQSxDQUFBLENBQUEsQ0FDQSxLQUFBLENBQUEsY0FBQSx5QkFBQSxPQUFBLENBQUEsb0JBQUEsQ0FBQSxDQUFBLENBQ0EsS0FBQSxDQUFBLG9CQUFBLHlCQUFBLE9BQUEsQ0FBQSwrQkFBQSxDQUFBLENBQUEsQ0FFQSxLQUFBLENBQUEsT0FBQSx5QkFBQSxPQUFBLENBQUEsZ0JBQUEsQ0FBQSxDQUFBLENBRUEsS0FBQSxDQUFBLGFBQUEseUJBQUEsT0FBQSxDQUFBLGdCQUFBLENBQUEsQ0FBQSxDQUNBLEtBQUEsQ0FBQSxlQUFBLHlCQUFBLE9BQUEsQ0FBQSwwQkFBQSxDQUFBLENBQUEsQ0FHQSxLQUFBLENBQUEsWUFBQSx5QkFBQSxPQUFBLENBQUEsb0JBQUEsQ0FBQSxDQUFBLENBQ0EsS0FBQSxDQUFBLGNBQUEseUJBQUEsT0FBQSxDQUFBLHlCQUFBLENBQUEsQ0FBQSxDQUVBLEtBQUEsQ0FBQSxrQkFBQSwwQkFBQSxPQUFBLENBQUEsNkJBQUEsQ0FBQSxDQUFBLENBQ0EsS0FBQSxDQUFBLGdCQUFBLDBCQUFBLE9BQUEsQ0FBQSwyQkFBQSxDQUFBLENBQUEsQ0FFQSxRQUFTLENBQUEsMEJBQVQsQ0FDRSxNQURGLENBRUUsU0FGRixDQUdFLFFBSEYsQ0FJRSxVQUpGLENBSTBCLHdCQUV4QixHQUFJLENBQUEsUUFBUSwwQkFBRyxDQUFILENBQVosQ0FDQSxHQUFJLENBQUEsUUFBUSwwQkFBRyxDQUFILENBQVosQ0FId0Isd0JBS3hCLElBQUssS0FBTSxDQUFBLElBQVgsR0FBbUIsQ0FBQSxRQUFuQixDQUE2Qix5QkFDM0IsR0FBSSxTQUFTLENBQUMsUUFBVixDQUFtQixJQUFJLENBQUMsSUFBeEIsQ0FBSixDQUFtQyxtREFDakMsR0FBSSxJQUFJLENBQUMsS0FBTCxHQUFlLFNBQW5CLENBQThCLG1EQUM1QixRQUFRLEVBQUksQ0FBWixDQUNELENBRkQsSUFFTyxtREFDTCxRQUFRLEVBQUksSUFBSSxDQUFDLEtBQWpCLENBQ0QsQ0FDRixDQU5ELGdDQU9ELENBYnVCLHdCQWV4QixJQUFLLEtBQU0sQ0FBQSxJQUFYLEdBQW1CLENBQUEsVUFBbkIsQ0FBK0IseUJBQzdCLEdBQUksU0FBUyxDQUFDLFFBQVYsQ0FBbUIsSUFBSSxDQUFDLElBQXhCLENBQUosQ0FBbUMsbURBQ2pDLFFBQVEsRUFBSSxJQUFJLENBQUMsS0FBakIsQ0FDRCxDQUZELGdDQUdELENBbkJ1Qix3QkFxQnhCLE1BQVEsQ0FBQSxNQUFNLENBQUcsUUFBVixDQUFzQixRQUE3QixDQUNELENBRUQsU0FBVSxTQUFWLENBQW9CLElBQXBCLENBQW9DLEtBQXBDLENBQXNELEtBQXRELENBQW9FLE1BQXBFLENBQTJGLHdCQUN6RixLQUFNLENBQUEsTUFBTSwwQkFBRyxNQUFNLENBQUMsTUFBVixDQUFaLENBQ0EsS0FBTSxDQUFBLFFBQVEsMEJBQUcsYUFBQSxDQUFBLFVBQUEsQ0FBVyxXQUFYLENBQXVCLEtBQXZCLENBQThCLE1BQTlCLENBQUgsQ0FBZCxDQUVBLEtBQU0sQ0FBQSxFQUFFLDBCQUFHLE1BQU0sQ0FBQyxNQUFQLENBQWMsaUJBQWpCLENBQVIsQ0FKeUYsd0JBS3pGLEdBQUksMkJBQUEsRUFBRSxDQUFDLFFBQUgsQ0FBWSxZQUFBLENBQUEsZ0JBQUEsQ0FBaUIsU0FBN0IsK0JBQTJDLEVBQUUsQ0FBQyxRQUFILENBQVksWUFBQSxDQUFBLGdCQUFBLENBQWlCLE1BQTdCLENBQTNDLENBQUosQ0FBcUYsbURBQ25GLEtBQU0sSUFBSSxDQUFBLFlBQUEsQ0FBQSxTQUFKLENBQWMsY0FBQSxDQUFBLFdBQUEsQ0FBWSw0QkFBMUIsQ0FBTixDQUNELENBRkQsZ0NBSUEsS0FBTSxDQUFBLE1BQU0sMEJBQUcsTUFBTSxDQUFDLE1BQVYsQ0FBWixDQUNBLEtBQU0sQ0FBQSxlQUFlLDBCQUFHLEdBQUksQ0FBQSxlQUFBLENBQUEscUJBQUosQ0FBMEIsTUFBMUIsQ0FBa0MsTUFBbEMsQ0FBSCxDQUFyQixDQVZ5Rix3QkFXekYsS0FBSyxDQUFHLEtBQUssQ0FBQyxZQUFOLENBQW1CLEtBQW5CLENBQTBCLGVBQTFCLENBQVIsQ0FFQSxLQUFNLENBQUEsbUJBQW1CLDBCQUFHLEdBQUksQ0FBQSxlQUFBLENBQUEseUJBQUosQ0FBOEIsTUFBOUIsQ0FBSCxDQUF6QixDQWJ5Rix3QkFjekYsS0FBSyxDQUFHLEtBQUssQ0FBQyxZQUFOLENBQW1CLEtBQW5CLENBQTBCLG1CQUExQixDQUFSLENBZHlGLHdCQWdCekYsR0FBSSxhQUFBLENBQUEsVUFBQSxDQUFXLGlCQUFYLENBQTZCLG1CQUFtQixDQUFDLFNBQWpELENBQTRELGVBQWUsQ0FBQyxJQUE1RSxJQUFzRixLQUExRixDQUFpRyxtREFDL0YsS0FBTSxJQUFJLENBQUEsWUFBQSxDQUFBLFNBQUosQ0FBYyxjQUFBLENBQUEsV0FBQSxDQUFZLGlCQUExQixDQUFOLENBQ0QsQ0FGRCxnQ0FoQnlGLHdCQW9CekYsR0FBSSxFQUFFLENBQUMsUUFBSCxDQUFZLFlBQUEsQ0FBQSxnQkFBQSxDQUFpQixRQUE3QixDQUFKLENBQTRDLDJCQUMxQyxHQUFJLENBQUEsSUFBSSwwQkFBRyxLQUFILENBQVIsQ0FEMEMsd0JBRzFDLEtBQUssQ0FBQyxHQUFOLENBQVUsS0FBVixDQUFpQixjQUFBLENBQUEsT0FBQSxDQUFRLGtCQUF6QixDQUE2QyxDQUFFLElBQUksQ0FBRSxNQUFNLENBQUMsSUFBZixDQUE3QyxFQUgwQyx3QkFJMUMsS0FBTSxDQUFBLEtBQUssQ0FBQyxNQUFOLENBQWEsS0FBYixDQUFvQixHQUFJLENBQUEsa0JBQUEsQ0FBQSxjQUFKLENBQ3hCLE1BQU0sQ0FBQyxFQURpQixDQUV4QixjQUFBLENBQUEsV0FBQSxDQUFZLGNBRlksQ0FBcEIsQ0FHTixNQUFNLEVBQUcsZ0RBQ1AsSUFBSSxDQUFHLE1BQVAsQ0FETyx3QkFFUCxJQUFJLEdBQ0wsQ0FOSyxDQUFOLENBSjBDLHdCQVkxQyxHQUFJLElBQUksR0FBSyxLQUFiLENBQW9CLG1EQUNsQixLQUFLLENBQUMsR0FBTixDQUFVLEtBQVYsQ0FBaUIsY0FBQSxDQUFBLE9BQUEsQ0FBUSxnQkFBekIsRUFEa0Isd0JBRWxCLE1BQU0sQ0FBQyxNQUFQLENBQWMsTUFBZCxFQUF3QixFQUF4QixDQUZrQix3QkFHbEIsS0FBSyxDQUFHLEtBQUssQ0FBQyxZQUFOLENBQW1CLEtBQW5CLENBQTBCLEdBQUksQ0FBQSxvQkFBQSxDQUFBLGFBQUosQ0FBa0IsTUFBbEIsQ0FBMUIsQ0FBUixDQUhrQix3QkFJbEIsTUFBTyxDQUFBLEtBQVAsQ0FDRCxDQUxELGdDQU1ELENBbEJELGdDQXBCeUYsd0JBd0N6RixLQUFLLENBQUMsR0FBTixDQUFVLEtBQVYsQ0FBaUIsY0FBQSxDQUFBLE9BQUEsQ0FBUSxzQkFBekIsQ0FBaUQsQ0FBRSxJQUFJLENBQUUsTUFBTSxDQUFDLElBQWYsQ0FBcUIsTUFBTSxDQUFFLE1BQU0sQ0FBQyxJQUFwQyxDQUFqRCxFQXhDeUYsd0JBeUN6RixLQUFLLENBQUMsS0FBTixDQUFjLE9BQUEsQ0FBQSxTQUFBLENBQVUsTUFBeEIsQ0FDQSxLQUFNLENBQUEsWUFBWSwwQkFBRyxHQUFJLENBQUEsY0FBQSxDQUFBLFlBQUosQ0FBaUIsTUFBakIsQ0FBeUIsUUFBekIsQ0FBbUMsTUFBbkMsQ0FBSCxDQUFsQixDQTFDeUYsd0JBMkN6RixLQUFLLENBQUcsS0FBSyxDQUFDLFlBQU4sQ0FBbUIsS0FBbkIsQ0FBMEIsWUFBMUIsQ0FBUixDQTNDeUYsd0JBNkN6RixHQUFJLEtBQUssQ0FBQyxVQUFOLEVBQUosQ0FBd0IsbURBQ3RCLEtBQU0sQ0FBQSxLQUFLLENBQUMsVUFBTixDQUFpQixLQUFqQixDQUF3QixJQUFNLHNEQUFBLENBQUEsSUFBSSxHQUFFLENBQXBDLENBQU4sQ0FDRCxDQUZELGdDQTdDeUYsd0JBaUR6RixHQUFJLFlBQVksQ0FBQyxNQUFiLENBQXNCLENBQTFCLENBQTZCLDJCQUMzQixLQUFNLENBQUEsVUFBVSwwQkFBRyxHQUFJLENBQUEsZ0JBQUEsQ0FBQSxnQkFBSixDQUFxQixZQUFyQixDQUFtQyxZQUFZLENBQUMsTUFBaEQsQ0FBSCxDQUFoQixDQUQyQix3QkFFM0IsS0FBSyxDQUFHLEtBQUssQ0FBQyxZQUFOLENBQW1CLEtBQW5CLENBQTBCLFVBQTFCLENBQVIsQ0FDRCxDQUhELGdDQWpEeUYsd0JBc0R6RixHQUFJLEtBQUssQ0FBQyxVQUFOLEVBQUosQ0FBd0Isb0RBQ3RCLEtBQU0sQ0FBQSxLQUFLLENBQUMsVUFBTixDQUFpQixLQUFqQixDQUF3QixJQUFNLHNEQUFBLENBQUEsSUFBSSxHQUFFLENBQXBDLENBQU4sQ0FDRCxDQUZELGlDQXREeUYsd0JBMER6RixNQUFPLENBQUEsS0FBSyxDQUFDLFlBQU4sQ0FBbUIsS0FBbkIsQ0FBMEIsR0FBSSxDQUFBLG9CQUFBLENBQUEsYUFBSixDQUFrQixNQUFsQixDQUExQixDQUFQLENBQ0QsQ0FFRCxRQUFnQixDQUFBLFdBQWhCLENBQTRCLEtBQTVCLENBQThDLEtBQTlDLENBQTRELE1BQTVELENBQTBFLGdEQUV4RSxHQUFJLE1BQU0sV0FBWSxDQUFBLGNBQUEsQ0FBQSxjQUF0QixDQUFzQyw0QkFDcEMsS0FBTSxDQUFBLElBQUksMEJBQUcsTUFBTSxDQUFDLE1BQVAsQ0FBYyxjQUFkLEVBQUgsQ0FBVixDQURvQyx3QkFFcEMsR0FBSSxJQUFJLEdBQUssU0FBYixDQUF3QixvREFFdEI7QUFDQSxHQUFJLElBQUksQ0FBQyxJQUFMLENBQVUsUUFBVixDQUFtQixZQUFBLENBQUEsT0FBQSxDQUFRLFVBQTNCLENBQUosQ0FBNEMsb0RBQzFDLE1BQU0sQ0FBQyxVQUFQLEVBQXFCLENBQXJCLENBQ0QsQ0FGRCxpQ0FIc0Isd0JBT3RCLEtBQUssQ0FBQyxHQUFOLENBQVUsS0FBVixDQUFpQixjQUFBLENBQUEsT0FBQSxDQUFRLGNBQXpCLENBQXlDLENBQUUsSUFBSSxDQUFFLElBQUksQ0FBQyxJQUFiLENBQXpDLEVBUHNCLHdCQVF0QixNQUFNLENBQUMsTUFBUCxDQUFjLE1BQWQsQ0FBcUIsTUFBTSxDQUFDLE1BQVAsQ0FBYyxPQUFuQyxFQVJzQix3QkFTdEIsTUFBTSxDQUFDLE1BQVAsQ0FBYyxZQUFkLEdBQ0QsQ0FWRCxpQ0FXRCxDQWJELGlDQUZ3RSx3QkFpQnhFLEdBQUksTUFBTSxXQUFZLENBQUEsZ0JBQUEsQ0FBQSxtQkFBdEIsQ0FBMkMsNEJBQ3pDLEtBQU0sQ0FBQSxnQkFBZ0IsMEJBQUcsR0FBSSxDQUFBLGVBQUEsQ0FBQSxzQkFBSixDQUEyQixNQUFNLENBQUMsTUFBbEMsQ0FBSCxDQUF0QixDQUR5Qyx3QkFFekMsS0FBSyxDQUFHLEtBQUssQ0FBQyxZQUFOLENBQW1CLEtBQW5CLENBQTBCLGdCQUExQixDQUFSLENBQ0EsS0FBTSxDQUFBLGlCQUFpQiwwQkFBRyxHQUFJLENBQUEsZUFBQSxDQUFBLHVCQUFKLENBQTRCLE1BQU0sQ0FBQyxNQUFuQyxDQUFILENBQXZCLENBSHlDLHdCQUl6QyxLQUFLLENBQUcsS0FBSyxDQUFDLFlBQU4sQ0FBbUIsS0FBbkIsQ0FBMEIsaUJBQTFCLENBQVIsQ0FFQSxLQUFNLENBQUEsUUFBUSwwQkFBRyxnQkFBZ0IsQ0FBQyxTQUFwQixDQUFkLENBQ0EsS0FBTSxDQUFBLFFBQVEsMEJBQUcsTUFBTSxDQUFDLGNBQVAsNkJBQXdCLEVBQXhCLDhCQUE2QixpQkFBaUIsQ0FBQyxRQUEvQyxDQUFILENBQWQsQ0FDQSxLQUFNLENBQUEsVUFBVSwwQkFBRyxNQUFNLENBQUMsZ0JBQVAsNkJBQTBCLEVBQTFCLDhCQUErQixpQkFBaUIsQ0FBQyxVQUFqRCxDQUFILENBQWhCLENBUnlDLHdCQVN6QyxNQUFNLENBQUMsTUFBUCxDQUFnQiwwQkFBMEIsQ0FBQyxNQUFNLENBQUMsTUFBUixDQUFnQixRQUFoQixDQUEwQixRQUExQixDQUFvQyxVQUFwQyxDQUExQyxDQVR5Qyx3QkFVekMsTUFBTyxDQUFBLEtBQVAsQ0FDRCxDQVhELGlDQWpCd0Usd0JBOEJ4RSxHQUFJLE1BQU0sV0FBWSxDQUFBLGNBQUEsQ0FBQSxlQUF0QixDQUF1Qyw0QkFDckMsS0FBTSxDQUFBLFNBQVMsMEJBQUcsU0FBUyxDQUFDLElBQU0sc0RBQUEsQ0FBQSxTQUFTLENBQUMsSUFBVixHQUFnQixDQUF2QixDQUF5QixLQUF6QixDQUFnQyxLQUFoQyxDQUF1QyxNQUF2QyxDQUFaLENBQWYsQ0FEcUMsd0JBRXJDLE1BQU8sQ0FBQSxTQUFTLENBQUMsSUFBVixHQUFpQixLQUF4QixDQUNELENBSEQsaUNBOUJ3RSx3QkFtQ3hFLEdBQUksTUFBTSxXQUFZLENBQUEsY0FBQSxDQUFBLGNBQXRCLENBQXNDLDRCQUNwQyxLQUFNLENBQUEsTUFBTSwwQkFBRyxNQUFNLENBQUMsTUFBVixDQUFaLENBQ0EsS0FBTSxDQUFBLEtBQUssMEJBQUcsTUFBTSxDQUFDLEtBQVYsQ0FBWCxDQUNBLEtBQU0sQ0FBQSxJQUFJLDBCQUFHLE1BQU0sQ0FBQyxJQUFWLENBQVYsQ0FIb0Msd0JBS3BDLEtBQUssQ0FBQyxHQUFOLENBQVUsS0FBVixDQUFpQixjQUFBLENBQUEsT0FBQSxDQUFRLHVCQUF6QixDQUFrRCxDQUFFLElBQUksQ0FBRSxNQUFNLENBQUMsSUFBZixDQUFxQixPQUFPLENBQUUsS0FBSyxDQUFDLElBQXBDLENBQWxELEVBTG9DLHdCQU1wQyxLQUFLLENBQUcsS0FBSyxDQUFDLFlBQU4sQ0FBbUIsS0FBbkIsQ0FBMEIsR0FBSSxDQUFBLGNBQUEsQ0FBQSxXQUFKLENBQWdCLE1BQWhCLENBQXdCLEtBQXhCLENBQStCLElBQS9CLENBQTFCLENBQVIsQ0FOb0Msd0JBT3BDLE1BQU8sQ0FBQSxLQUFQLENBQ0QsQ0FSRCxpQ0FuQ3dFLHdCQTZDeEUsR0FBSSxNQUFNLFdBQVksQ0FBQSxjQUFBLENBQUEsZ0JBQXRCLENBQXdDLDRCQUN0QyxLQUFNLENBQUEsTUFBTSwwQkFBRyxNQUFNLENBQUMsTUFBVixDQUFaLENBRHNDLHdCQUV0QyxLQUFLLENBQUMsR0FBTixDQUFVLEtBQVYsQ0FBaUIsY0FBQSxDQUFBLE9BQUEsQ0FBUSx1QkFBekIsQ0FBa0QsQ0FBRSxJQUFJLENBQUUsTUFBTSxDQUFDLElBQWYsQ0FBcUIsT0FBTyxDQUFFLE1BQU0sQ0FBQyxPQUFQLENBQWUsSUFBN0MsQ0FBbEQsRUFGc0Msd0JBR3RDLE1BQU0sQ0FBQyxlQUFQLENBQXlCLEtBQUssQ0FBQyxJQUEvQixDQUNELENBSkQsaUNBN0N3RSx3QkFtRHhFLEdBQUksTUFBTSxXQUFZLENBQUEsY0FBQSxDQUFBLFVBQXRCLENBQWtDLG9EQUNoQyxNQUFNLENBQUMsTUFBUCxDQUFjLE1BQWQsQ0FBdUIsSUFBSSxDQUFDLEdBQUwsQ0FBUyxDQUFULENBQVksTUFBTSxDQUFDLE1BQVAsQ0FBYyxNQUFkLENBQXVCLE1BQU0sQ0FBQyxNQUExQyxDQUF2QixDQURnQyx3QkFFaEMsTUFBTyxDQUFBLEtBQVAsQ0FDRCxDQUhELGlDQW5Ed0Usd0JBd0R4RSxHQUFJLE1BQU0sV0FBWSxDQUFBLGNBQUEsQ0FBQSxZQUF0QixDQUFvQyw0QkFDbEMsS0FBTSxDQUFBLFdBQVcsMEJBQUcsTUFBTSxDQUFDLE1BQVAsQ0FBYyxjQUFkLEVBQUgsQ0FBakIsQ0FEa0Msd0JBRWxDLEdBQUksV0FBVyxHQUFLLFNBQXBCLENBQStCLG9EQUM3QixLQUFNLElBQUksQ0FBQSxZQUFBLENBQUEsU0FBSixDQUFjLGNBQUEsQ0FBQSxXQUFBLENBQVksY0FBMUIsQ0FBTixDQUNELENBRkQsaUNBRmtDLHlCQUtsQyxLQUFLLENBQUMsR0FBTixDQUFVLEtBQVYsQ0FBaUIsY0FBQSxDQUFBLE9BQUEsQ0FBUSwwQkFBekIsQ0FBcUQsQ0FDbkQsSUFBSSxDQUFFLE1BQU0sQ0FBQyxNQUFQLENBQWMsSUFEK0IsQ0FFbkQsT0FBTyxDQUFFLFdBQVcsQ0FBQyxJQUY4QixDQUduRCxJQUFJLENBQUUsTUFBTSxDQUFDLFdBQVAsQ0FBbUIsSUFIMEIsQ0FBckQsRUFMa0MseUJBVWxDLE1BQU0sQ0FBQyxNQUFQLENBQWMsSUFBZCxDQUFtQixVQUFuQixDQUE4QixNQUFNLENBQUMsV0FBckMsQ0FBa0QsTUFBTSxDQUFDLE1BQXpELEVBVmtDLHlCQVdsQyxNQUFNLENBQUMsTUFBUCxDQUFjLGlCQUFkLENBQWtDLEtBQUssQ0FBQyxJQUF4QyxDQVhrQyx5QkFZbEMsTUFBTSxDQUFDLE1BQVAsQ0FBYyxZQUFkLEdBQ0QsQ0FiRCxpQ0F4RHdFLHlCQXVFeEUsTUFBTyxDQUFBLEtBQVAsQ0FDRCxDLHlCQXhFRCxPQUFBLENBQUEsV0FBQSxDQUFBLFdBQUEsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdhbWVFcnJvciB9IGZyb20gJy4uLy4uL2dhbWUtZXJyb3InO1xuaW1wb3J0IHsgR2FtZU1lc3NhZ2UsIEdhbWVMb2cgfSBmcm9tICcuLi8uLi9nYW1lLW1lc3NhZ2UnO1xuaW1wb3J0IHsgRW5kVHVybkVmZmVjdCB9IGZyb20gJy4uL2VmZmVjdHMvZ2FtZS1waGFzZS1lZmZlY3RzJztcbmltcG9ydCB7IEVmZmVjdCB9IGZyb20gJy4uL2VmZmVjdHMvZWZmZWN0JztcbmltcG9ydCB7IFN0YXRlLCBHYW1lUGhhc2UgfSBmcm9tICcuLi9zdGF0ZS9zdGF0ZSc7XG5pbXBvcnQgeyBTdG9yZUxpa2UgfSBmcm9tICcuLi9zdG9yZS1saWtlJztcbmltcG9ydCB7IFN0YXRlVXRpbHMgfSBmcm9tICcuLi9zdGF0ZS11dGlscyc7XG5pbXBvcnQgeyBDaGVja1Bva2Vtb25UeXBlRWZmZWN0LCBDaGVja1Bva2Vtb25TdGF0c0VmZmVjdCxcbiAgQ2hlY2tQcm92aWRlZEVuZXJneUVmZmVjdCwgQ2hlY2tBdHRhY2tDb3N0RWZmZWN0IH0gZnJvbSAnLi4vZWZmZWN0cy9jaGVjay1lZmZlY3RzJztcbmltcG9ydCB7IFdlYWtuZXNzLCBSZXNpc3RhbmNlIH0gZnJvbSAnLi4vY2FyZC9wb2tlbW9uLXR5cGVzJztcbmltcG9ydCB7IENhcmRUeXBlLCBTcGVjaWFsQ29uZGl0aW9uLCBDYXJkVGFnIH0gZnJvbSAnLi4vY2FyZC9jYXJkLXR5cGVzJztcbmltcG9ydCB7IEF0dGFja0VmZmVjdCwgVXNlQXR0YWNrRWZmZWN0LCBIZWFsRWZmZWN0LCBLbm9ja091dEVmZmVjdCxcbiAgVXNlUG93ZXJFZmZlY3QsIFBvd2VyRWZmZWN0LCBVc2VTdGFkaXVtRWZmZWN0LCBFdm9sdmVFZmZlY3QgfSBmcm9tICcuLi9lZmZlY3RzL2dhbWUtZWZmZWN0cyc7XG5pbXBvcnQgeyBDb2luRmxpcFByb21wdCB9IGZyb20gJy4uL3Byb21wdHMvY29pbi1mbGlwLXByb21wdCc7XG5pbXBvcnQgeyBEZWFsRGFtYWdlRWZmZWN0LCBBcHBseVdlYWtuZXNzRWZmZWN0IH0gZnJvbSAnLi4vZWZmZWN0cy9hdHRhY2stZWZmZWN0cyc7XG5cbmZ1bmN0aW9uIGFwcGx5V2Vha25lc3NBbmRSZXNpc3RhbmNlKFxuICBkYW1hZ2U6IG51bWJlcixcbiAgY2FyZFR5cGVzOiBDYXJkVHlwZVtdLFxuICB3ZWFrbmVzczogV2Vha25lc3NbXSxcbiAgcmVzaXN0YW5jZTogUmVzaXN0YW5jZVtdXG4pOiBudW1iZXIge1xuICBsZXQgbXVsdGlwbHkgPSAxO1xuICBsZXQgbW9kaWZpZXIgPSAwO1xuXG4gIGZvciAoY29uc3QgaXRlbSBvZiB3ZWFrbmVzcykge1xuICAgIGlmIChjYXJkVHlwZXMuaW5jbHVkZXMoaXRlbS50eXBlKSkge1xuICAgICAgaWYgKGl0ZW0udmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBtdWx0aXBseSAqPSAyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbW9kaWZpZXIgKz0gaXRlbS52YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmb3IgKGNvbnN0IGl0ZW0gb2YgcmVzaXN0YW5jZSkge1xuICAgIGlmIChjYXJkVHlwZXMuaW5jbHVkZXMoaXRlbS50eXBlKSkge1xuICAgICAgbW9kaWZpZXIgKz0gaXRlbS52YWx1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gKGRhbWFnZSAqIG11bHRpcGx5KSArIG1vZGlmaWVyO1xufVxuXG5mdW5jdGlvbiogdXNlQXR0YWNrKG5leHQ6IEZ1bmN0aW9uLCBzdG9yZTogU3RvcmVMaWtlLCBzdGF0ZTogU3RhdGUsIGVmZmVjdDogVXNlQXR0YWNrRWZmZWN0KTogSXRlcmFibGVJdGVyYXRvcjxTdGF0ZT4ge1xuICBjb25zdCBwbGF5ZXIgPSBlZmZlY3QucGxheWVyO1xuICBjb25zdCBvcHBvbmVudCA9IFN0YXRlVXRpbHMuZ2V0T3Bwb25lbnQoc3RhdGUsIHBsYXllcik7XG5cbiAgY29uc3Qgc3AgPSBwbGF5ZXIuYWN0aXZlLnNwZWNpYWxDb25kaXRpb25zO1xuICBpZiAoc3AuaW5jbHVkZXMoU3BlY2lhbENvbmRpdGlvbi5QQVJBTFlaRUQpIHx8IHNwLmluY2x1ZGVzKFNwZWNpYWxDb25kaXRpb24uQVNMRUVQKSkge1xuICAgIHRocm93IG5ldyBHYW1lRXJyb3IoR2FtZU1lc3NhZ2UuQkxPQ0tFRF9CWV9TUEVDSUFMX0NPTkRJVElPTik7XG4gIH1cblxuICBjb25zdCBhdHRhY2sgPSBlZmZlY3QuYXR0YWNrO1xuICBjb25zdCBjaGVja0F0dGFja0Nvc3QgPSBuZXcgQ2hlY2tBdHRhY2tDb3N0RWZmZWN0KHBsYXllciwgYXR0YWNrKTtcbiAgc3RhdGUgPSBzdG9yZS5yZWR1Y2VFZmZlY3Qoc3RhdGUsIGNoZWNrQXR0YWNrQ29zdCk7XG5cbiAgY29uc3QgY2hlY2tQcm92aWRlZEVuZXJneSA9IG5ldyBDaGVja1Byb3ZpZGVkRW5lcmd5RWZmZWN0KHBsYXllcik7XG4gIHN0YXRlID0gc3RvcmUucmVkdWNlRWZmZWN0KHN0YXRlLCBjaGVja1Byb3ZpZGVkRW5lcmd5KTtcblxuICBpZiAoU3RhdGVVdGlscy5jaGVja0Vub3VnaEVuZXJneShjaGVja1Byb3ZpZGVkRW5lcmd5LmVuZXJneU1hcCwgY2hlY2tBdHRhY2tDb3N0LmNvc3QpID09PSBmYWxzZSkge1xuICAgIHRocm93IG5ldyBHYW1lRXJyb3IoR2FtZU1lc3NhZ2UuTk9UX0VOT1VHSF9FTkVSR1kpO1xuICB9XG5cbiAgaWYgKHNwLmluY2x1ZGVzKFNwZWNpYWxDb25kaXRpb24uQ09ORlVTRUQpKSB7XG4gICAgbGV0IGZsaXAgPSBmYWxzZTtcblxuICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfRkxJUF9DT05GVVNJT04sIHsgbmFtZTogcGxheWVyLm5hbWUgfSk7XG4gICAgeWllbGQgc3RvcmUucHJvbXB0KHN0YXRlLCBuZXcgQ29pbkZsaXBQcm9tcHQoXG4gICAgICBwbGF5ZXIuaWQsXG4gICAgICBHYW1lTWVzc2FnZS5GTElQX0NPTkZVU0lPTiksXG4gICAgcmVzdWx0ID0+IHtcbiAgICAgIGZsaXAgPSByZXN1bHQ7XG4gICAgICBuZXh0KCk7XG4gICAgfSk7XG5cbiAgICBpZiAoZmxpcCA9PT0gZmFsc2UpIHtcbiAgICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfSFVSVFNfSVRTRUxGKTtcbiAgICAgIHBsYXllci5hY3RpdmUuZGFtYWdlICs9IDMwO1xuICAgICAgc3RhdGUgPSBzdG9yZS5yZWR1Y2VFZmZlY3Qoc3RhdGUsIG5ldyBFbmRUdXJuRWZmZWN0KHBsYXllcikpO1xuICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cbiAgfVxuXG4gIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfUExBWUVSX1VTRVNfQVRUQUNLLCB7IG5hbWU6IHBsYXllci5uYW1lLCBhdHRhY2s6IGF0dGFjay5uYW1lIH0pO1xuICBzdGF0ZS5waGFzZSA9IEdhbWVQaGFzZS5BVFRBQ0s7XG4gIGNvbnN0IGF0dGFja0VmZmVjdCA9IG5ldyBBdHRhY2tFZmZlY3QocGxheWVyLCBvcHBvbmVudCwgYXR0YWNrKTtcbiAgc3RhdGUgPSBzdG9yZS5yZWR1Y2VFZmZlY3Qoc3RhdGUsIGF0dGFja0VmZmVjdCk7XG5cbiAgaWYgKHN0b3JlLmhhc1Byb21wdHMoKSkge1xuICAgIHlpZWxkIHN0b3JlLndhaXRQcm9tcHQoc3RhdGUsICgpID0+IG5leHQoKSk7XG4gIH1cblxuICBpZiAoYXR0YWNrRWZmZWN0LmRhbWFnZSA+IDApIHtcbiAgICBjb25zdCBkZWFsRGFtYWdlID0gbmV3IERlYWxEYW1hZ2VFZmZlY3QoYXR0YWNrRWZmZWN0LCBhdHRhY2tFZmZlY3QuZGFtYWdlKTtcbiAgICBzdGF0ZSA9IHN0b3JlLnJlZHVjZUVmZmVjdChzdGF0ZSwgZGVhbERhbWFnZSk7XG4gIH1cblxuICBpZiAoc3RvcmUuaGFzUHJvbXB0cygpKSB7XG4gICAgeWllbGQgc3RvcmUud2FpdFByb21wdChzdGF0ZSwgKCkgPT4gbmV4dCgpKTtcbiAgfVxuXG4gIHJldHVybiBzdG9yZS5yZWR1Y2VFZmZlY3Qoc3RhdGUsIG5ldyBFbmRUdXJuRWZmZWN0KHBsYXllcikpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2FtZVJlZHVjZXIoc3RvcmU6IFN0b3JlTGlrZSwgc3RhdGU6IFN0YXRlLCBlZmZlY3Q6IEVmZmVjdCk6IFN0YXRlIHtcblxuICBpZiAoZWZmZWN0IGluc3RhbmNlb2YgS25vY2tPdXRFZmZlY3QpIHtcbiAgICBjb25zdCBjYXJkID0gZWZmZWN0LnRhcmdldC5nZXRQb2tlbW9uQ2FyZCgpO1xuICAgIGlmIChjYXJkICE9PSB1bmRlZmluZWQpIHtcblxuICAgICAgLy8gUG9rZW1vbiBleCBydWxlXG4gICAgICBpZiAoY2FyZC50YWdzLmluY2x1ZGVzKENhcmRUYWcuUE9LRU1PTl9FWCkpIHtcbiAgICAgICAgZWZmZWN0LnByaXplQ291bnQgKz0gMTtcbiAgICAgIH1cblxuICAgICAgc3RvcmUubG9nKHN0YXRlLCBHYW1lTG9nLkxPR19QT0tFTU9OX0tPLCB7IG5hbWU6IGNhcmQubmFtZSB9KTtcbiAgICAgIGVmZmVjdC50YXJnZXQubW92ZVRvKGVmZmVjdC5wbGF5ZXIuZGlzY2FyZCk7XG4gICAgICBlZmZlY3QudGFyZ2V0LmNsZWFyRWZmZWN0cygpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChlZmZlY3QgaW5zdGFuY2VvZiBBcHBseVdlYWtuZXNzRWZmZWN0KSB7XG4gICAgY29uc3QgY2hlY2tQb2tlbW9uVHlwZSA9IG5ldyBDaGVja1Bva2Vtb25UeXBlRWZmZWN0KGVmZmVjdC5zb3VyY2UpO1xuICAgIHN0YXRlID0gc3RvcmUucmVkdWNlRWZmZWN0KHN0YXRlLCBjaGVja1Bva2Vtb25UeXBlKTtcbiAgICBjb25zdCBjaGVja1Bva2Vtb25TdGF0cyA9IG5ldyBDaGVja1Bva2Vtb25TdGF0c0VmZmVjdChlZmZlY3QudGFyZ2V0KTtcbiAgICBzdGF0ZSA9IHN0b3JlLnJlZHVjZUVmZmVjdChzdGF0ZSwgY2hlY2tQb2tlbW9uU3RhdHMpO1xuXG4gICAgY29uc3QgY2FyZFR5cGUgPSBjaGVja1Bva2Vtb25UeXBlLmNhcmRUeXBlcztcbiAgICBjb25zdCB3ZWFrbmVzcyA9IGVmZmVjdC5pZ25vcmVXZWFrbmVzcyA/IFtdIDogY2hlY2tQb2tlbW9uU3RhdHMud2Vha25lc3M7XG4gICAgY29uc3QgcmVzaXN0YW5jZSA9IGVmZmVjdC5pZ25vcmVSZXNpc3RhbmNlID8gW10gOiBjaGVja1Bva2Vtb25TdGF0cy5yZXNpc3RhbmNlO1xuICAgIGVmZmVjdC5kYW1hZ2UgPSBhcHBseVdlYWtuZXNzQW5kUmVzaXN0YW5jZShlZmZlY3QuZGFtYWdlLCBjYXJkVHlwZSwgd2Vha25lc3MsIHJlc2lzdGFuY2UpO1xuICAgIHJldHVybiBzdGF0ZTtcbiAgfVxuXG4gIGlmIChlZmZlY3QgaW5zdGFuY2VvZiBVc2VBdHRhY2tFZmZlY3QpIHtcbiAgICBjb25zdCBnZW5lcmF0b3IgPSB1c2VBdHRhY2soKCkgPT4gZ2VuZXJhdG9yLm5leHQoKSwgc3RvcmUsIHN0YXRlLCBlZmZlY3QpO1xuICAgIHJldHVybiBnZW5lcmF0b3IubmV4dCgpLnZhbHVlO1xuICB9XG5cbiAgaWYgKGVmZmVjdCBpbnN0YW5jZW9mIFVzZVBvd2VyRWZmZWN0KSB7XG4gICAgY29uc3QgcGxheWVyID0gZWZmZWN0LnBsYXllcjtcbiAgICBjb25zdCBwb3dlciA9IGVmZmVjdC5wb3dlcjtcbiAgICBjb25zdCBjYXJkID0gZWZmZWN0LmNhcmQ7XG5cbiAgICBzdG9yZS5sb2coc3RhdGUsIEdhbWVMb2cuTE9HX1BMQVlFUl9VU0VTX0FCSUxJVFksIHsgbmFtZTogcGxheWVyLm5hbWUsIGFiaWxpdHk6IHBvd2VyLm5hbWUgfSk7XG4gICAgc3RhdGUgPSBzdG9yZS5yZWR1Y2VFZmZlY3Qoc3RhdGUsIG5ldyBQb3dlckVmZmVjdChwbGF5ZXIsIHBvd2VyLCBjYXJkKSk7XG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG5cbiAgaWYgKGVmZmVjdCBpbnN0YW5jZW9mIFVzZVN0YWRpdW1FZmZlY3QpIHtcbiAgICBjb25zdCBwbGF5ZXIgPSBlZmZlY3QucGxheWVyO1xuICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfUExBWUVSX1VTRVNfU1RBRElVTSwgeyBuYW1lOiBwbGF5ZXIubmFtZSwgc3RhZGl1bTogZWZmZWN0LnN0YWRpdW0ubmFtZSB9KTtcbiAgICBwbGF5ZXIuc3RhZGl1bVVzZWRUdXJuID0gc3RhdGUudHVybjtcbiAgfVxuXG4gIGlmIChlZmZlY3QgaW5zdGFuY2VvZiBIZWFsRWZmZWN0KSB7XG4gICAgZWZmZWN0LnRhcmdldC5kYW1hZ2UgPSBNYXRoLm1heCgwLCBlZmZlY3QudGFyZ2V0LmRhbWFnZSAtIGVmZmVjdC5kYW1hZ2UpO1xuICAgIHJldHVybiBzdGF0ZTtcbiAgfVxuXG4gIGlmIChlZmZlY3QgaW5zdGFuY2VvZiBFdm9sdmVFZmZlY3QpIHtcbiAgICBjb25zdCBwb2tlbW9uQ2FyZCA9IGVmZmVjdC50YXJnZXQuZ2V0UG9rZW1vbkNhcmQoKTtcbiAgICBpZiAocG9rZW1vbkNhcmQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEdhbWVFcnJvcihHYW1lTWVzc2FnZS5JTlZBTElEX1RBUkdFVCk7XG4gICAgfVxuICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfUExBWUVSX0VWT0xWRVNfUE9LRU1PTiwge1xuICAgICAgbmFtZTogZWZmZWN0LnBsYXllci5uYW1lLFxuICAgICAgcG9rZW1vbjogcG9rZW1vbkNhcmQubmFtZSxcbiAgICAgIGNhcmQ6IGVmZmVjdC5wb2tlbW9uQ2FyZC5uYW1lXG4gICAgfSk7XG4gICAgZWZmZWN0LnBsYXllci5oYW5kLm1vdmVDYXJkVG8oZWZmZWN0LnBva2Vtb25DYXJkLCBlZmZlY3QudGFyZ2V0KTtcbiAgICBlZmZlY3QudGFyZ2V0LnBva2Vtb25QbGF5ZWRUdXJuID0gc3RhdGUudHVybjtcbiAgICBlZmZlY3QudGFyZ2V0LmNsZWFyRWZmZWN0cygpO1xuICB9XG5cbiAgcmV0dXJuIHN0YXRlO1xufVxuIl19