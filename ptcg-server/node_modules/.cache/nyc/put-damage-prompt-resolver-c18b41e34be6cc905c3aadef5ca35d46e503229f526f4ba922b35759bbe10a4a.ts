"use strict";function cov_1fqy65vtkk(){var path="/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/simple-bot/prompt-resolver/put-damage-prompt-resolver.ts";var hash="a3f5711275ae60a2909fdecefa795c41f478bfb3";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/simple-bot/prompt-resolver/put-damage-prompt-resolver.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:0},end:{line:3,column:41}},"2":{start:{line:4,column:15},end:{line:4,column:36}},"3":{start:{line:5,column:26},end:{line:5,column:54}},"4":{start:{line:6,column:28},end:{line:6,column:81}},"5":{start:{line:9,column:8},end:{line:12,column:9}},"6":{start:{line:10,column:27},end:{line:10,column:71}},"7":{start:{line:11,column:12},end:{line:11,column:69}},"8":{start:{line:15,column:22},end:{line:15,column:76}},"9":{start:{line:16,column:23},end:{line:16,column:25}},"10":{start:{line:17,column:20},end:{line:17,column:21}},"11":{start:{line:18,column:27},end:{line:18,column:40}},"12":{start:{line:19,column:8},end:{line:31,column:9}},"13":{start:{line:20,column:25},end:{line:20,column:38}},"14":{start:{line:21,column:12},end:{line:23,column:13}},"15":{start:{line:22,column:16},end:{line:22,column:22}},"16":{start:{line:24,column:27},end:{line:24,column:38}},"17":{start:{line:25,column:27},end:{line:25,column:48}},"18":{start:{line:26,column:27},end:{line:26,column:57}},"19":{start:{line:27,column:12},end:{line:27,column:35}},"20":{start:{line:28,column:12},end:{line:28,column:34}},"21":{start:{line:29,column:12},end:{line:29,column:41}},"22":{start:{line:30,column:12},end:{line:30,column:44}},"23":{start:{line:32,column:8},end:{line:34,column:9}},"24":{start:{line:33,column:12},end:{line:33,column:24}},"25":{start:{line:35,column:8},end:{line:37,column:9}},"26":{start:{line:36,column:12},end:{line:36,column:24}},"27":{start:{line:38,column:8},end:{line:38,column:22}},"28":{start:{line:41,column:23},end:{line:41,column:72}},"29":{start:{line:41,column:47},end:{line:41,column:71}},"30":{start:{line:42,column:25},end:{line:42,column:74}},"31":{start:{line:42,column:49},end:{line:42,column:73}},"32":{start:{line:43,column:8},end:{line:45,column:9}},"33":{start:{line:44,column:12},end:{line:44,column:22}},"34":{start:{line:46,column:28},end:{line:46,column:109}},"35":{start:{line:47,column:26},end:{line:47,column:110}},"36":{start:{line:48,column:22},end:{line:48,column:24}},"37":{start:{line:49,column:8},end:{line:63,column:9}},"38":{start:{line:50,column:12},end:{line:62,column:15}},"39":{start:{line:51,column:41},end:{line:55,column:18}},"40":{start:{line:52,column:20},end:{line:54,column:59}},"41":{start:{line:56,column:27},end:{line:56,column:73}},"42":{start:{line:57,column:31},end:{line:57,column:46}},"43":{start:{line:58,column:30},end:{line:58,column:71}},"44":{start:{line:59,column:16},end:{line:61,column:17}},"45":{start:{line:60,column:20},end:{line:60,column:74}},"46":{start:{line:64,column:8},end:{line:78,column:9}},"47":{start:{line:65,column:12},end:{line:77,column:15}},"48":{start:{line:66,column:30},end:{line:70,column:18}},"49":{start:{line:67,column:20},end:{line:69,column:59}},"50":{start:{line:71,column:27},end:{line:71,column:69}},"51":{start:{line:72,column:31},end:{line:72,column:46}},"52":{start:{line:73,column:30},end:{line:73,column:72}},"53":{start:{line:74,column:16},end:{line:76,column:17}},"54":{start:{line:75,column:20},end:{line:75,column:74}},"55":{start:{line:79,column:28},end:{line:79,column:91}},"56":{start:{line:79,column:45},end:{line:79,column:90}},"57":{start:{line:80,column:8},end:{line:80,column:73}},"58":{start:{line:80,column:38},end:{line:80,column:71}},"59":{start:{line:81,column:8},end:{line:81,column:50}},"60":{start:{line:81,column:31},end:{line:81,column:48}},"61":{start:{line:82,column:8},end:{line:82,column:23}},"62":{start:{line:85,column:0},end:{line:85,column:58}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:8,column:4},end:{line:8,column:5}},loc:{start:{line:8,column:41},end:{line:13,column:5}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:4},end:{line:14,column:5}},loc:{start:{line:14,column:44},end:{line:39,column:5}},line:14},"2":{name:"(anonymous_2)",decl:{start:{line:40,column:4},end:{line:40,column:5}},loc:{start:{line:40,column:39},end:{line:83,column:5}},line:40},"3":{name:"(anonymous_3)",decl:{start:{line:41,column:42},end:{line:41,column:43}},loc:{start:{line:41,column:47},end:{line:41,column:71}},line:41},"4":{name:"(anonymous_4)",decl:{start:{line:42,column:44},end:{line:42,column:45}},loc:{start:{line:42,column:49},end:{line:42,column:73}},line:42},"5":{name:"(anonymous_5)",decl:{start:{line:50,column:66},end:{line:50,column:67}},loc:{start:{line:50,column:94},end:{line:62,column:13}},line:50},"6":{name:"(anonymous_6)",decl:{start:{line:51,column:70},end:{line:51,column:71}},loc:{start:{line:51,column:75},end:{line:55,column:17}},line:51},"7":{name:"(anonymous_7)",decl:{start:{line:65,column:67},end:{line:65,column:68}},loc:{start:{line:65,column:95},end:{line:77,column:13}},line:65},"8":{name:"(anonymous_8)",decl:{start:{line:66,column:59},end:{line:66,column:60}},loc:{start:{line:66,column:64},end:{line:70,column:17}},line:66},"9":{name:"(anonymous_9)",decl:{start:{line:79,column:40},end:{line:79,column:41}},loc:{start:{line:79,column:45},end:{line:79,column:90}},line:79},"10":{name:"(anonymous_10)",decl:{start:{line:80,column:33},end:{line:80,column:34}},loc:{start:{line:80,column:38},end:{line:80,column:71}},line:80},"11":{name:"(anonymous_11)",decl:{start:{line:81,column:21},end:{line:81,column:22}},loc:{start:{line:81,column:31},end:{line:81,column:48}},line:81}},branchMap:{"0":{loc:{start:{line:9,column:8},end:{line:12,column:9}},type:"if",locations:[{start:{line:9,column:8},end:{line:12,column:9}},{start:{line:9,column:8},end:{line:12,column:9}}],line:9},"1":{loc:{start:{line:19,column:15},end:{line:19,column:51}},type:"binary-expr",locations:[{start:{line:19,column:15},end:{line:19,column:31}},{start:{line:19,column:35},end:{line:19,column:51}}],line:19},"2":{loc:{start:{line:21,column:12},end:{line:23,column:13}},type:"if",locations:[{start:{line:21,column:12},end:{line:23,column:13}},{start:{line:21,column:12},end:{line:23,column:13}}],line:21},"3":{loc:{start:{line:32,column:8},end:{line:34,column:9}},type:"if",locations:[{start:{line:32,column:8},end:{line:34,column:9}},{start:{line:32,column:8},end:{line:34,column:9}}],line:32},"4":{loc:{start:{line:32,column:12},end:{line:32,column:61}},type:"binary-expr",locations:[{start:{line:32,column:12},end:{line:32,column:31}},{start:{line:32,column:35},end:{line:32,column:61}}],line:32},"5":{loc:{start:{line:35,column:8},end:{line:37,column:9}},type:"if",locations:[{start:{line:35,column:8},end:{line:37,column:9}},{start:{line:35,column:8},end:{line:37,column:9}}],line:35},"6":{loc:{start:{line:35,column:12},end:{line:35,column:51}},type:"binary-expr",locations:[{start:{line:35,column:12},end:{line:35,column:21}},{start:{line:35,column:25},end:{line:35,column:51}}],line:35},"7":{loc:{start:{line:43,column:8},end:{line:45,column:9}},type:"if",locations:[{start:{line:43,column:8},end:{line:45,column:9}},{start:{line:43,column:8},end:{line:45,column:9}}],line:43},"8":{loc:{start:{line:43,column:12},end:{line:43,column:58}},type:"binary-expr",locations:[{start:{line:43,column:12},end:{line:43,column:32}},{start:{line:43,column:36},end:{line:43,column:58}}],line:43},"9":{loc:{start:{line:49,column:8},end:{line:63,column:9}},type:"if",locations:[{start:{line:49,column:8},end:{line:63,column:9}},{start:{line:49,column:8},end:{line:63,column:9}}],line:49},"10":{loc:{start:{line:52,column:27},end:{line:54,column:58}},type:"binary-expr",locations:[{start:{line:52,column:27},end:{line:52,column:60}},{start:{line:53,column:27},end:{line:53,column:56}},{start:{line:54,column:27},end:{line:54,column:58}}],line:52},"11":{loc:{start:{line:56,column:27},end:{line:56,column:73}},type:"cond-expr",locations:[{start:{line:56,column:46},end:{line:56,column:69}},{start:{line:56,column:72},end:{line:56,column:73}}],line:56},"12":{loc:{start:{line:59,column:16},end:{line:61,column:17}},type:"if",locations:[{start:{line:59,column:16},end:{line:61,column:17}},{start:{line:59,column:16},end:{line:61,column:17}}],line:59},"13":{loc:{start:{line:59,column:20},end:{line:59,column:64}},type:"binary-expr",locations:[{start:{line:59,column:20},end:{line:59,column:26}},{start:{line:59,column:30},end:{line:59,column:64}}],line:59},"14":{loc:{start:{line:64,column:8},end:{line:78,column:9}},type:"if",locations:[{start:{line:64,column:8},end:{line:78,column:9}},{start:{line:64,column:8},end:{line:78,column:9}}],line:64},"15":{loc:{start:{line:67,column:27},end:{line:69,column:58}},type:"binary-expr",locations:[{start:{line:67,column:27},end:{line:67,column:60}},{start:{line:68,column:27},end:{line:68,column:56}},{start:{line:69,column:27},end:{line:69,column:58}}],line:67},"16":{loc:{start:{line:71,column:27},end:{line:71,column:69}},type:"cond-expr",locations:[{start:{line:71,column:35},end:{line:71,column:65}},{start:{line:71,column:68},end:{line:71,column:69}}],line:71},"17":{loc:{start:{line:74,column:16},end:{line:76,column:17}},type:"if",locations:[{start:{line:74,column:16},end:{line:76,column:17}},{start:{line:74,column:16},end:{line:76,column:17}}],line:74},"18":{loc:{start:{line:74,column:20},end:{line:74,column:64}},type:"binary-expr",locations:[{start:{line:74,column:20},end:{line:74,column:26}},{start:{line:74,column:30},end:{line:74,column:64}}],line:74}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0,0],"16":[0,0],"17":[0,0],"18":[0,0]},inputSourceMap:{version:3,file:"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/simple-bot/prompt-resolver/put-damage-prompt-resolver.ts",sources:["/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/simple-bot/prompt-resolver/put-damage-prompt-resolver.ts"],names:[],mappings:"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",sourcesContent:["import { Player, State, Action, ResolvePromptAction, Prompt, CardTarget,\n  CardList, PlayerType, StateUtils, DamageMap, PokemonCardList, MoveDamagePrompt } from '../../game';\nimport { PromptResolver } from './prompt-resolver';\nimport { PutDamagePrompt } from '../../game/store/prompts/put-damage-prompt';\n\nexport type DamagePromptResolverType = PutDamagePrompt | MoveDamagePrompt;\n\nexport interface DamagePromptResolverTarget {\n  target: CardTarget;\n  cardList: PokemonCardList;\n  damage: number;\n  hp: number;\n  score: number;\n}\n\nexport class PutDamagePromptResolver extends PromptResolver {\n\n  public resolvePrompt(state: State, player: Player, prompt: Prompt<any>): Action | undefined {\n    if (prompt instanceof PutDamagePrompt) {\n      const result = this.getPutDamagePromptResult(state, prompt);\n      return new ResolvePromptAction(prompt.id, result);\n    }\n  }\n\n  private getPutDamagePromptResult(state: State, prompt: PutDamagePrompt): DamageMap[] | null {\n    const items = this.getTargets(state, prompt, prompt.options.blocked);\n\n    const result: DamageMap[] = [];\n    let score = 0;\n    let promptDamage = prompt.damage;\n\n    while (items.length > 0 && promptDamage > 0) {\n      const item = items.shift();\n      if (item === undefined) {\n        break;\n      }\n      const target = item.target;\n      const hpLeft = item.hp - item.damage;\n      const damage = Math.min(promptDamage, hpLeft);\n      promptDamage -= damage;\n      item.damage += damage;\n      score += item.score * damage;\n      result.push({ target, damage });\n    }\n\n    if (result.length === 0 && prompt.options.allowCancel) {\n      return null;\n    }\n\n    if (score < 0 && prompt.options.allowCancel) {\n      return null;\n    }\n\n    return result;\n  }\n\n  protected getTargets(\n    state: State,\n    prompt: DamagePromptResolverType,\n    blocked: CardTarget[]\n  ): DamagePromptResolverTarget[] {\n    const player = state.players.find(p => p.id === prompt.playerId);\n    const opponent = state.players.find(p => p.id !== prompt.playerId);\n    if (player === undefined || opponent === undefined) {\n      return [];\n    }\n    const hasOpponent = [PlayerType.TOP_PLAYER, PlayerType.ANY].includes(prompt.playerType);\n    const hasPlayer = [PlayerType.BOTTOM_PLAYER, PlayerType.ANY].includes(prompt.playerType);\n    let results: DamagePromptResolverTarget[] = [];\n    if (hasOpponent) {\n      opponent.forEachPokemon(PlayerType.TOP_PLAYER, (cardList, card, target) => {\n        const maxAllowedDamage = prompt.maxAllowedDamage.find(d => {\n          return d.target.player === target.player\n            && d.target.slot === target.slot\n            && d.target.index === target.index;\n        });\n        const hp = maxAllowedDamage ? maxAllowedDamage.damage : 0;\n        const damage = cardList.damage;\n        const score = this.stateScore.getPokemonScore(cardList);\n\n        if (hp > 0 && prompt.slots.includes(target.slot)) {\n          results.push({ target, cardList, damage, hp, score });\n        }\n      });\n    }\n    if (hasPlayer) {\n      player.forEachPokemon(PlayerType.BOTTOM_PLAYER, (cardList, card, target) => {\n        const maxHp = prompt.maxAllowedDamage.find(d => {\n          return d.target.player === target.player\n            && d.target.slot === target.slot\n            && d.target.index === target.index;\n        });\n        const hp = maxHp ? maxHp.damage - cardList.damage : 0;\n        const damage = cardList.damage;\n        const score = -this.stateScore.getPokemonScore(cardList);\n\n        if (hp > 0 && prompt.slots.includes(target.slot)) {\n          results.push({ target, cardList, damage, hp, score });\n        }\n      });\n    }\n\n    const blockedList: CardList[] = blocked.map(b => StateUtils.getTarget(state, player, b));\n    results = results.filter(i => !blockedList.includes(i.cardList));\n    results.sort((a, b) => b.score - a.score);\n    return results;\n  }\n\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"a3f5711275ae60a2909fdecefa795c41f478bfb3"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1fqy65vtkk=function(){return actualCoverage;};}return actualCoverage;}cov_1fqy65vtkk();cov_1fqy65vtkk().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_1fqy65vtkk().s[1]++;exports.PutDamagePromptResolver=void 0;const game_1=(cov_1fqy65vtkk().s[2]++,require("../../game"));const prompt_resolver_1=(cov_1fqy65vtkk().s[3]++,require("./prompt-resolver"));const put_damage_prompt_1=(cov_1fqy65vtkk().s[4]++,require("../../game/store/prompts/put-damage-prompt"));class PutDamagePromptResolver extends(prompt_resolver_1.PromptResolver){resolvePrompt(state,player,prompt){cov_1fqy65vtkk().f[0]++;cov_1fqy65vtkk().s[5]++;if(prompt instanceof put_damage_prompt_1.PutDamagePrompt){cov_1fqy65vtkk().b[0][0]++;const result=(cov_1fqy65vtkk().s[6]++,this.getPutDamagePromptResult(state,prompt));cov_1fqy65vtkk().s[7]++;return new game_1.ResolvePromptAction(prompt.id,result);}else{cov_1fqy65vtkk().b[0][1]++;}}getPutDamagePromptResult(state,prompt){cov_1fqy65vtkk().f[1]++;const items=(cov_1fqy65vtkk().s[8]++,this.getTargets(state,prompt,prompt.options.blocked));const result=(cov_1fqy65vtkk().s[9]++,[]);let score=(cov_1fqy65vtkk().s[10]++,0);let promptDamage=(cov_1fqy65vtkk().s[11]++,prompt.damage);cov_1fqy65vtkk().s[12]++;while((cov_1fqy65vtkk().b[1][0]++,items.length>0)&&(cov_1fqy65vtkk().b[1][1]++,promptDamage>0)){const item=(cov_1fqy65vtkk().s[13]++,items.shift());cov_1fqy65vtkk().s[14]++;if(item===undefined){cov_1fqy65vtkk().b[2][0]++;cov_1fqy65vtkk().s[15]++;break;}else{cov_1fqy65vtkk().b[2][1]++;}const target=(cov_1fqy65vtkk().s[16]++,item.target);const hpLeft=(cov_1fqy65vtkk().s[17]++,item.hp-item.damage);const damage=(cov_1fqy65vtkk().s[18]++,Math.min(promptDamage,hpLeft));cov_1fqy65vtkk().s[19]++;promptDamage-=damage;cov_1fqy65vtkk().s[20]++;item.damage+=damage;cov_1fqy65vtkk().s[21]++;score+=item.score*damage;cov_1fqy65vtkk().s[22]++;result.push({target,damage});}cov_1fqy65vtkk().s[23]++;if((cov_1fqy65vtkk().b[4][0]++,result.length===0)&&(cov_1fqy65vtkk().b[4][1]++,prompt.options.allowCancel)){cov_1fqy65vtkk().b[3][0]++;cov_1fqy65vtkk().s[24]++;return null;}else{cov_1fqy65vtkk().b[3][1]++;}cov_1fqy65vtkk().s[25]++;if((cov_1fqy65vtkk().b[6][0]++,score<0)&&(cov_1fqy65vtkk().b[6][1]++,prompt.options.allowCancel)){cov_1fqy65vtkk().b[5][0]++;cov_1fqy65vtkk().s[26]++;return null;}else{cov_1fqy65vtkk().b[5][1]++;}cov_1fqy65vtkk().s[27]++;return result;}getTargets(state,prompt,blocked){cov_1fqy65vtkk().f[2]++;const player=(cov_1fqy65vtkk().s[28]++,state.players.find(p=>{cov_1fqy65vtkk().f[3]++;cov_1fqy65vtkk().s[29]++;return p.id===prompt.playerId;}));const opponent=(cov_1fqy65vtkk().s[30]++,state.players.find(p=>{cov_1fqy65vtkk().f[4]++;cov_1fqy65vtkk().s[31]++;return p.id!==prompt.playerId;}));cov_1fqy65vtkk().s[32]++;if((cov_1fqy65vtkk().b[8][0]++,player===undefined)||(cov_1fqy65vtkk().b[8][1]++,opponent===undefined)){cov_1fqy65vtkk().b[7][0]++;cov_1fqy65vtkk().s[33]++;return[];}else{cov_1fqy65vtkk().b[7][1]++;}const hasOpponent=(cov_1fqy65vtkk().s[34]++,[game_1.PlayerType.TOP_PLAYER,game_1.PlayerType.ANY].includes(prompt.playerType));const hasPlayer=(cov_1fqy65vtkk().s[35]++,[game_1.PlayerType.BOTTOM_PLAYER,game_1.PlayerType.ANY].includes(prompt.playerType));let results=(cov_1fqy65vtkk().s[36]++,[]);cov_1fqy65vtkk().s[37]++;if(hasOpponent){cov_1fqy65vtkk().b[9][0]++;cov_1fqy65vtkk().s[38]++;opponent.forEachPokemon(game_1.PlayerType.TOP_PLAYER,(cardList,card,target)=>{cov_1fqy65vtkk().f[5]++;const maxAllowedDamage=(cov_1fqy65vtkk().s[39]++,prompt.maxAllowedDamage.find(d=>{cov_1fqy65vtkk().f[6]++;cov_1fqy65vtkk().s[40]++;return(cov_1fqy65vtkk().b[10][0]++,d.target.player===target.player)&&(cov_1fqy65vtkk().b[10][1]++,d.target.slot===target.slot)&&(cov_1fqy65vtkk().b[10][2]++,d.target.index===target.index);}));const hp=(cov_1fqy65vtkk().s[41]++,maxAllowedDamage?(cov_1fqy65vtkk().b[11][0]++,maxAllowedDamage.damage):(cov_1fqy65vtkk().b[11][1]++,0));const damage=(cov_1fqy65vtkk().s[42]++,cardList.damage);const score=(cov_1fqy65vtkk().s[43]++,this.stateScore.getPokemonScore(cardList));cov_1fqy65vtkk().s[44]++;if((cov_1fqy65vtkk().b[13][0]++,hp>0)&&(cov_1fqy65vtkk().b[13][1]++,prompt.slots.includes(target.slot))){cov_1fqy65vtkk().b[12][0]++;cov_1fqy65vtkk().s[45]++;results.push({target,cardList,damage,hp,score});}else{cov_1fqy65vtkk().b[12][1]++;}});}else{cov_1fqy65vtkk().b[9][1]++;}cov_1fqy65vtkk().s[46]++;if(hasPlayer){cov_1fqy65vtkk().b[14][0]++;cov_1fqy65vtkk().s[47]++;player.forEachPokemon(game_1.PlayerType.BOTTOM_PLAYER,(cardList,card,target)=>{cov_1fqy65vtkk().f[7]++;const maxHp=(cov_1fqy65vtkk().s[48]++,prompt.maxAllowedDamage.find(d=>{cov_1fqy65vtkk().f[8]++;cov_1fqy65vtkk().s[49]++;return(cov_1fqy65vtkk().b[15][0]++,d.target.player===target.player)&&(cov_1fqy65vtkk().b[15][1]++,d.target.slot===target.slot)&&(cov_1fqy65vtkk().b[15][2]++,d.target.index===target.index);}));const hp=(cov_1fqy65vtkk().s[50]++,maxHp?(cov_1fqy65vtkk().b[16][0]++,maxHp.damage-cardList.damage):(cov_1fqy65vtkk().b[16][1]++,0));const damage=(cov_1fqy65vtkk().s[51]++,cardList.damage);const score=(cov_1fqy65vtkk().s[52]++,-this.stateScore.getPokemonScore(cardList));cov_1fqy65vtkk().s[53]++;if((cov_1fqy65vtkk().b[18][0]++,hp>0)&&(cov_1fqy65vtkk().b[18][1]++,prompt.slots.includes(target.slot))){cov_1fqy65vtkk().b[17][0]++;cov_1fqy65vtkk().s[54]++;results.push({target,cardList,damage,hp,score});}else{cov_1fqy65vtkk().b[17][1]++;}});}else{cov_1fqy65vtkk().b[14][1]++;}const blockedList=(cov_1fqy65vtkk().s[55]++,blocked.map(b=>{cov_1fqy65vtkk().f[9]++;cov_1fqy65vtkk().s[56]++;return game_1.StateUtils.getTarget(state,player,b);}));cov_1fqy65vtkk().s[57]++;results=results.filter(i=>{cov_1fqy65vtkk().f[10]++;cov_1fqy65vtkk().s[58]++;return!blockedList.includes(i.cardList);});cov_1fqy65vtkk().s[59]++;results.sort((a,b)=>{cov_1fqy65vtkk().f[11]++;cov_1fqy65vtkk().s[60]++;return b.score-a.score;});cov_1fqy65vtkk().s[61]++;return results;}}cov_1fqy65vtkk().s[62]++;exports.PutDamagePromptResolver=PutDamagePromptResolver;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2pvZW15ZXJzY291Z2gvRG9jdW1lbnRzL0dpdEh1Yi9wdGNnLWVwc2QvcHRjZy1zZXJ2ZXIvc3JjL3NpbXBsZS1ib3QvcHJvbXB0LXJlc29sdmVyL3B1dC1kYW1hZ2UtcHJvbXB0LXJlc29sdmVyLnRzIiwic291cmNlcyI6WyIvVXNlcnMvam9lbXllcnNjb3VnaC9Eb2N1bWVudHMvR2l0SHViL3B0Y2ctZXBzZC9wdGNnLXNlcnZlci9zcmMvc2ltcGxlLWJvdC9wcm9tcHQtcmVzb2x2ZXIvcHV0LWRhbWFnZS1wcm9tcHQtcmVzb2x2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEscUNBQ3FHO0FBQ3JHLHVEQUFtRDtBQUNuRCxrRkFBNkU7QUFZN0UsTUFBYSx1QkFBd0IsU0FBUSxnQ0FBYztJQUVsRCxhQUFhLENBQUMsS0FBWSxFQUFFLE1BQWMsRUFBRSxNQUFtQjtRQUNwRSxJQUFJLE1BQU0sWUFBWSxtQ0FBZSxFQUFFO1lBQ3JDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDNUQsT0FBTyxJQUFJLDBCQUFtQixDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDbkQ7SUFDSCxDQUFDO0lBRU8sd0JBQXdCLENBQUMsS0FBWSxFQUFFLE1BQXVCO1FBQ3BFLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRXJFLE1BQU0sTUFBTSxHQUFnQixFQUFFLENBQUM7UUFDL0IsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUVqQyxPQUFPLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLFlBQVksR0FBRyxDQUFDLEVBQUU7WUFDM0MsTUFBTSxJQUFJ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RSxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztpQkFDdkQ7WUFDSCxDQUFDLENBQUMsQ0FBQztTQUNKO1FBRUQsTUFBTSxXQUFXLEdBQWUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLGlCQUFVLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6RixPQUFPLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNqRSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUMsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQztDQUVGO0FBN0ZELDBEQTZGQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBsYXllciwgU3RhdGUsIEFjdGlvbiwgUmVzb2x2ZVByb21wdEFjdGlvbiwgUHJvbXB0LCBDYXJkVGFyZ2V0LFxuICBDYXJkTGlzdCwgUGxheWVyVHlwZSwgU3RhdGVVdGlscywgRGFtYWdlTWFwLCBQb2tlbW9uQ2FyZExpc3QsIE1vdmVEYW1hZ2VQcm9tcHQgfSBmcm9tICcuLi8uLi9nYW1lJztcbmltcG9ydCB7IFByb21wdFJlc29sdmVyIH0gZnJvbSAnLi9wcm9tcHQtcmVzb2x2ZXInO1xuaW1wb3J0IHsgUHV0RGFtYWdlUHJvbXB0IH0gZnJvbSAnLi4vLi4vZ2FtZS9zdG9yZS9wcm9tcHRzL3B1dC1kYW1hZ2UtcHJvbXB0JztcblxuZXhwb3J0IHR5cGUgRGFtYWdlUHJvbXB0UmVzb2x2ZXJUeXBlID0gUHV0RGFtYWdlUHJvbXB0IHwgTW92ZURhbWFnZVByb21wdDtcblxuZXhwb3J0IGludGVyZmFjZSBEYW1hZ2VQcm9tcHRSZXNvbHZlclRhcmdldCB7XG4gIHRhcmdldDogQ2FyZFRhcmdldDtcbiAgY2FyZExpc3Q6IFBva2Vtb25DYXJkTGlzdDtcbiAgZGFtYWdlOiBudW1iZXI7XG4gIGhwOiBudW1iZXI7XG4gIHNjb3JlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBQdXREYW1hZ2VQcm9tcHRSZXNvbHZlciBleHRlbmRzIFByb21wdFJlc29sdmVyIHtcblxuICBwdWJsaWMgcmVzb2x2ZVByb21wdChzdGF0ZTogU3RhdGUsIHBsYXllcjogUGxheWVyLCBwcm9tcHQ6IFByb21wdDxhbnk+KTogQWN0aW9uIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAocHJvbXB0IGluc3RhbmNlb2YgUHV0RGFtYWdlUHJvbXB0KSB7XG4gICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmdldFB1dERhbWFnZVByb21wdFJlc3VsdChzdGF0ZSwgcHJvbXB0KTtcbiAgICAgIHJldHVybiBuZXcgUmVzb2x2ZVByb21wdEFjdGlvbihwcm9tcHQuaWQsIHJlc3VsdCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRQdXREYW1hZ2VQcm9tcHRSZXN1bHQoc3RhdGU6IFN0YXRlLCBwcm9tcHQ6IFB1dERhbWFnZVByb21wdCk6IERhbWFnZU1hcFtdIHwgbnVsbCB7XG4gICAgY29uc3QgaXRlbXMgPSB0aGlzLmdldFRhcmdldHMoc3RhdGUsIHByb21wdCwgcHJvbXB0Lm9wdGlvbnMuYmxvY2tlZCk7XG5cbiAgICBjb25zdCByZXN1bHQ6IERhbWFnZU1hcFtdID0gW107XG4gICAgbGV0IHNjb3JlID0gMDtcbiAgICBsZXQgcHJvbXB0RGFtYWdlID0gcHJvbXB0LmRhbWFnZTtcblxuICAgIHdoaWxlIChpdGVtcy5sZW5ndGggPiAwICYmIHByb21wdERhbWFnZSA+IDApIHtcbiAgICAgIGNvbnN0IGl0ZW0gPSBpdGVtcy5zaGlmdCgpO1xuICAgICAgaWYgKGl0ZW0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNvbnN0IHRhcmdldCA9IGl0ZW0udGFyZ2V0O1xuICAgICAgY29uc3QgaHBMZWZ0ID0gaXRlbS5ocCAtIGl0ZW0uZGFtYWdlO1xuICAgICAgY29uc3QgZGFtYWdlID0gTWF0aC5taW4ocHJvbXB0RGFtYWdlLCBocExlZnQpO1xuICAgICAgcHJvbXB0RGFtYWdlIC09IGRhbWFnZTtcbiAgICAgIGl0ZW0uZGFtYWdlICs9IGRhbWFnZTtcbiAgICAgIHNjb3JlICs9IGl0ZW0uc2NvcmUgKiBkYW1hZ2U7XG4gICAgICByZXN1bHQucHVzaCh7IHRhcmdldCwgZGFtYWdlIH0pO1xuICAgIH1cblxuICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwICYmIHByb21wdC5vcHRpb25zLmFsbG93Q2FuY2VsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoc2NvcmUgPCAwICYmIHByb21wdC5vcHRpb25zLmFsbG93Q2FuY2VsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFRhcmdldHMoXG4gICAgc3RhdGU6IFN0YXRlLFxuICAgIHByb21wdDogRGFtYWdlUHJvbXB0UmVzb2x2ZXJUeXBlLFxuICAgIGJsb2NrZWQ6IENhcmRUYXJnZXRbXVxuICApOiBEYW1hZ2VQcm9tcHRSZXNvbHZlclRhcmdldFtdIHtcbiAgICBjb25zdCBwbGF5ZXIgPSBzdGF0ZS5wbGF5ZXJzLmZpbmQocCA9PiBwLmlkID09PSBwcm9tcHQucGxheWVySWQpO1xuICAgIGNvbnN0IG9wcG9uZW50ID0gc3RhdGUucGxheWVycy5maW5kKHAgPT4gcC5pZCAhPT0gcHJvbXB0LnBsYXllcklkKTtcbiAgICBpZiAocGxheWVyID09PSB1bmRlZmluZWQgfHwgb3Bwb25lbnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBjb25zdCBoYXNPcHBvbmVudCA9IFtQbGF5ZXJUeXBlLlRPUF9QTEFZRVIsIFBsYXllclR5cGUuQU5ZXS5pbmNsdWRlcyhwcm9tcHQucGxheWVyVHlwZSk7XG4gICAgY29uc3QgaGFzUGxheWVyID0gW1BsYXllclR5cGUuQk9UVE9NX1BMQVlFUiwgUGxheWVyVHlwZS5BTlldLmluY2x1ZGVzKHByb21wdC5wbGF5ZXJUeXBlKTtcbiAgICBsZXQgcmVzdWx0czogRGFtYWdlUHJvbXB0UmVzb2x2ZXJUYXJnZXRbXSA9IFtdO1xuICAgIGlmIChoYXNPcHBvbmVudCkge1xuICAgICAgb3Bwb25lbnQuZm9yRWFjaFBva2Vtb24oUGxheWVyVHlwZS5UT1BfUExBWUVSLCAoY2FyZExpc3QsIGNhcmQsIHRhcmdldCkgPT4ge1xuICAgICAgICBjb25zdCBtYXhBbGxvd2VkRGFtYWdlID0gcHJvbXB0Lm1heEFsbG93ZWREYW1hZ2UuZmluZChkID0+IHtcbiAgICAgICAgICByZXR1cm4gZC50YXJnZXQucGxheWVyID09PSB0YXJnZXQucGxheWVyXG4gICAgICAgICAgICAmJiBkLnRhcmdldC5zbG90ID09PSB0YXJnZXQuc2xvdFxuICAgICAgICAgICAgJiYgZC50YXJnZXQuaW5kZXggPT09IHRhcmdldC5pbmRleDtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGhwID0gbWF4QWxsb3dlZERhbWFnZSA/IG1heEFsbG93ZWREYW1hZ2UuZGFtYWdlIDogMDtcbiAgICAgICAgY29uc3QgZGFtYWdlID0gY2FyZExpc3QuZGFtYWdlO1xuICAgICAgICBjb25zdCBzY29yZSA9IHRoaXMuc3RhdGVTY29yZS5nZXRQb2tlbW9uU2NvcmUoY2FyZExpc3QpO1xuXG4gICAgICAgIGlmIChocCA+IDAgJiYgcHJvbXB0LnNsb3RzLmluY2x1ZGVzKHRhcmdldC5zbG90KSkge1xuICAgICAgICAgIHJlc3VsdHMucHVzaCh7IHRhcmdldCwgY2FyZExpc3QsIGRhbWFnZSwgaHAsIHNjb3JlIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGhhc1BsYXllcikge1xuICAgICAgcGxheWVyLmZvckVhY2hQb2tlbW9uKFBsYXllclR5cGUuQk9UVE9NX1BMQVlFUiwgKGNhcmRMaXN0LCBjYXJkLCB0YXJnZXQpID0+IHtcbiAgICAgICAgY29uc3QgbWF4SHAgPSBwcm9tcHQubWF4QWxsb3dlZERhbWFnZS5maW5kKGQgPT4ge1xuICAgICAgICAgIHJldHVybiBkLnRhcmdldC5wbGF5ZXIgPT09IHRhcmdldC5wbGF5ZXJcbiAgICAgICAgICAgICYmIGQudGFyZ2V0LnNsb3QgPT09IHRhcmdldC5zbG90XG4gICAgICAgICAgICAmJiBkLnRhcmdldC5pbmRleCA9PT0gdGFyZ2V0LmluZGV4O1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgaHAgPSBtYXhIcCA/IG1heEhwLmRhbWFnZSAtIGNhcmRMaXN0LmRhbWFnZSA6IDA7XG4gICAgICAgIGNvbnN0IGRhbWFnZSA9IGNhcmRMaXN0LmRhbWFnZTtcbiAgICAgICAgY29uc3Qgc2NvcmUgPSAtdGhpcy5zdGF0ZVNjb3JlLmdldFBva2Vtb25TY29yZShjYXJkTGlzdCk7XG5cbiAgICAgICAgaWYgKGhwID4gMCAmJiBwcm9tcHQuc2xvdHMuaW5jbHVkZXModGFyZ2V0LnNsb3QpKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHsgdGFyZ2V0LCBjYXJkTGlzdCwgZGFtYWdlLCBocCwgc2NvcmUgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGJsb2NrZWRMaXN0OiBDYXJkTGlzdFtdID0gYmxvY2tlZC5tYXAoYiA9PiBTdGF0ZVV0aWxzLmdldFRhcmdldChzdGF0ZSwgcGxheWVyLCBiKSk7XG4gICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGkgPT4gIWJsb2NrZWRMaXN0LmluY2x1ZGVzKGkuY2FyZExpc3QpKTtcbiAgICByZXN1bHRzLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTtcbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG59XG4iXX0=
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qb2VteWVyc2NvdWdoL0RvY3VtZW50cy9HaXRIdWIvcHRjZy1lcHNkL3B0Y2ctc2VydmVyL3NyYy9zaW1wbGUtYm90L3Byb21wdC1yZXNvbHZlci9wdXQtZGFtYWdlLXByb21wdC1yZXNvbHZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoidXprQkEyQkk7Mk9BM0JKLEtBQUEsQ0FBQSxNQUFBLDBCQUFBLE9BQUEsQ0FBQSxZQUFBLENBQUEsQ0FBQSxDQUVBLEtBQUEsQ0FBQSxpQkFBQSwwQkFBQSxPQUFBLENBQUEsbUJBQUEsQ0FBQSxDQUFBLENBQ0EsS0FBQSxDQUFBLG1CQUFBLDBCQUFBLE9BQUEsQ0FBQSw0Q0FBQSxDQUFBLENBQUEsQ0FZQSxLQUFhLENBQUEsdUJBQWIsU0FBNkMsaUJBQUEsQ0FBQSxjQUE3QyxDQUEyRCxDQUVsRCxhQUFhLENBQUMsS0FBRCxDQUFlLE1BQWYsQ0FBK0IsTUFBL0IsQ0FBa0QsaURBQ3BFLEdBQUksTUFBTSxXQUFZLENBQUEsbUJBQUEsQ0FBQSxlQUF0QixDQUF1Qyw0QkFDckMsS0FBTSxDQUFBLE1BQU0sMEJBQUcsS0FBSyx3QkFBTCxDQUE4QixLQUE5QixDQUFxQyxNQUFyQyxDQUFILENBQVosQ0FEcUMsd0JBRXJDLE1BQU8sSUFBSSxDQUFBLE1BQUEsQ0FBQSxtQkFBSixDQUF3QixNQUFNLENBQUMsRUFBL0IsQ0FBbUMsTUFBbkMsQ0FBUCxDQUNELENBSEQsaUNBSUQsQ0FFTyx3QkFBd0IsQ0FBQyxLQUFELENBQWUsTUFBZixDQUFzQyx5QkFDcEUsS0FBTSxDQUFBLEtBQUssMEJBQUcsS0FBSyxVQUFMLENBQWdCLEtBQWhCLENBQXVCLE1BQXZCLENBQStCLE1BQU0sQ0FBQyxPQUFQLENBQWUsT0FBOUMsQ0FBSCxDQUFYLENBRUEsS0FBTSxDQUFBLE1BQU0sMEJBQWdCLEVBQWhCLENBQVosQ0FDQSxHQUFJLENBQUEsS0FBSywyQkFBRyxDQUFILENBQVQsQ0FDQSxHQUFJLENBQUEsWUFBWSwyQkFB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LENBQVUsQ0FBQyxDQUFDLEtBQVosQ0FBaUIsQ0FBeEMsRUE3Q3FCLHlCQThDckIsTUFBTyxDQUFBLE9BQVAsQ0FDRCxDQTNGd0QsQyx5QkFBM0QsT0FBQSxDQUFBLHVCQUFBLENBQUEsdUJBQUEsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBsYXllciwgU3RhdGUsIEFjdGlvbiwgUmVzb2x2ZVByb21wdEFjdGlvbiwgUHJvbXB0LCBDYXJkVGFyZ2V0LFxuICBDYXJkTGlzdCwgUGxheWVyVHlwZSwgU3RhdGVVdGlscywgRGFtYWdlTWFwLCBQb2tlbW9uQ2FyZExpc3QsIE1vdmVEYW1hZ2VQcm9tcHQgfSBmcm9tICcuLi8uLi9nYW1lJztcbmltcG9ydCB7IFByb21wdFJlc29sdmVyIH0gZnJvbSAnLi9wcm9tcHQtcmVzb2x2ZXInO1xuaW1wb3J0IHsgUHV0RGFtYWdlUHJvbXB0IH0gZnJvbSAnLi4vLi4vZ2FtZS9zdG9yZS9wcm9tcHRzL3B1dC1kYW1hZ2UtcHJvbXB0JztcblxuZXhwb3J0IHR5cGUgRGFtYWdlUHJvbXB0UmVzb2x2ZXJUeXBlID0gUHV0RGFtYWdlUHJvbXB0IHwgTW92ZURhbWFnZVByb21wdDtcblxuZXhwb3J0IGludGVyZmFjZSBEYW1hZ2VQcm9tcHRSZXNvbHZlclRhcmdldCB7XG4gIHRhcmdldDogQ2FyZFRhcmdldDtcbiAgY2FyZExpc3Q6IFBva2Vtb25DYXJkTGlzdDtcbiAgZGFtYWdlOiBudW1iZXI7XG4gIGhwOiBudW1iZXI7XG4gIHNjb3JlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBQdXREYW1hZ2VQcm9tcHRSZXNvbHZlciBleHRlbmRzIFByb21wdFJlc29sdmVyIHtcblxuICBwdWJsaWMgcmVzb2x2ZVByb21wdChzdGF0ZTogU3RhdGUsIHBsYXllcjogUGxheWVyLCBwcm9tcHQ6IFByb21wdDxhbnk+KTogQWN0aW9uIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAocHJvbXB0IGluc3RhbmNlb2YgUHV0RGFtYWdlUHJvbXB0KSB7XG4gICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmdldFB1dERhbWFnZVByb21wdFJlc3VsdChzdGF0ZSwgcHJvbXB0KTtcbiAgICAgIHJldHVybiBuZXcgUmVzb2x2ZVByb21wdEFjdGlvbihwcm9tcHQuaWQsIHJlc3VsdCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRQdXREYW1hZ2VQcm9tcHRSZXN1bHQoc3RhdGU6IFN0YXRlLCBwcm9tcHQ6IFB1dERhbWFnZVByb21wdCk6IERhbWFnZU1hcFtdIHwgbnVsbCB7XG4gICAgY29uc3QgaXRlbXMgPSB0aGlzLmdldFRhcmdldHMoc3RhdGUsIHByb21wdCwgcHJvbXB0Lm9wdGlvbnMuYmxvY2tlZCk7XG5cbiAgICBjb25zdCByZXN1bHQ6IERhbWFnZU1hcFtdID0gW107XG4gICAgbGV0IHNjb3JlID0gMDtcbiAgICBsZXQgcHJvbXB0RGFtYWdlID0gcHJvbXB0LmRhbWFnZTtcblxuICAgIHdoaWxlIChpdGVtcy5sZW5ndGggPiAwICYmIHByb21wdERhbWFnZSA+IDApIHtcbiAgICAgIGNvbnN0IGl0ZW0gPSBpdGVtcy5zaGlmdCgpO1xuICAgICAgaWYgKGl0ZW0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNvbnN0IHRhcmdldCA9IGl0ZW0udGFyZ2V0O1xuICAgICAgY29uc3QgaHBMZWZ0ID0gaXRlbS5ocCAtIGl0ZW0uZGFtYWdlO1xuICAgICAgY29uc3QgZGFtYWdlID0gTWF0aC5taW4ocHJvbXB0RGFtYWdlLCBocExlZnQpO1xuICAgICAgcHJvbXB0RGFtYWdlIC09IGRhbWFnZTtcbiAgICAgIGl0ZW0uZGFtYWdlICs9IGRhbWFnZTtcbiAgICAgIHNjb3JlICs9IGl0ZW0uc2NvcmUgKiBkYW1hZ2U7XG4gICAgICByZXN1bHQucHVzaCh7IHRhcmdldCwgZGFtYWdlIH0pO1xuICAgIH1cblxuICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwICYmIHByb21wdC5vcHRpb25zLmFsbG93Q2FuY2VsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoc2NvcmUgPCAwICYmIHByb21wdC5vcHRpb25zLmFsbG93Q2FuY2VsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFRhcmdldHMoXG4gICAgc3RhdGU6IFN0YXRlLFxuICAgIHByb21wdDogRGFtYWdlUHJvbXB0UmVzb2x2ZXJUeXBlLFxuICAgIGJsb2NrZWQ6IENhcmRUYXJnZXRbXVxuICApOiBEYW1hZ2VQcm9tcHRSZXNvbHZlclRhcmdldFtdIHtcbiAgICBjb25zdCBwbGF5ZXIgPSBzdGF0ZS5wbGF5ZXJzLmZpbmQocCA9PiBwLmlkID09PSBwcm9tcHQucGxheWVySWQpO1xuICAgIGNvbnN0IG9wcG9uZW50ID0gc3RhdGUucGxheWVycy5maW5kKHAgPT4gcC5pZCAhPT0gcHJvbXB0LnBsYXllcklkKTtcbiAgICBpZiAocGxheWVyID09PSB1bmRlZmluZWQgfHwgb3Bwb25lbnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBjb25zdCBoYXNPcHBvbmVudCA9IFtQbGF5ZXJUeXBlLlRPUF9QTEFZRVIsIFBsYXllclR5cGUuQU5ZXS5pbmNsdWRlcyhwcm9tcHQucGxheWVyVHlwZSk7XG4gICAgY29uc3QgaGFzUGxheWVyID0gW1BsYXllclR5cGUuQk9UVE9NX1BMQVlFUiwgUGxheWVyVHlwZS5BTlldLmluY2x1ZGVzKHByb21wdC5wbGF5ZXJUeXBlKTtcbiAgICBsZXQgcmVzdWx0czogRGFtYWdlUHJvbXB0UmVzb2x2ZXJUYXJnZXRbXSA9IFtdO1xuICAgIGlmIChoYXNPcHBvbmVudCkge1xuICAgICAgb3Bwb25lbnQuZm9yRWFjaFBva2Vtb24oUGxheWVyVHlwZS5UT1BfUExBWUVSLCAoY2FyZExpc3QsIGNhcmQsIHRhcmdldCkgPT4ge1xuICAgICAgICBjb25zdCBtYXhBbGxvd2VkRGFtYWdlID0gcHJvbXB0Lm1heEFsbG93ZWREYW1hZ2UuZmluZChkID0+IHtcbiAgICAgICAgICByZXR1cm4gZC50YXJnZXQucGxheWVyID09PSB0YXJnZXQucGxheWVyXG4gICAgICAgICAgICAmJiBkLnRhcmdldC5zbG90ID09PSB0YXJnZXQuc2xvdFxuICAgICAgICAgICAgJiYgZC50YXJnZXQuaW5kZXggPT09IHRhcmdldC5pbmRleDtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGhwID0gbWF4QWxsb3dlZERhbWFnZSA/IG1heEFsbG93ZWREYW1hZ2UuZGFtYWdlIDogMDtcbiAgICAgICAgY29uc3QgZGFtYWdlID0gY2FyZExpc3QuZGFtYWdlO1xuICAgICAgICBjb25zdCBzY29yZSA9IHRoaXMuc3RhdGVTY29yZS5nZXRQb2tlbW9uU2NvcmUoY2FyZExpc3QpO1xuXG4gICAgICAgIGlmIChocCA+IDAgJiYgcHJvbXB0LnNsb3RzLmluY2x1ZGVzKHRhcmdldC5zbG90KSkge1xuICAgICAgICAgIHJlc3VsdHMucHVzaCh7IHRhcmdldCwgY2FyZExpc3QsIGRhbWFnZSwgaHAsIHNjb3JlIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGhhc1BsYXllcikge1xuICAgICAgcGxheWVyLmZvckVhY2hQb2tlbW9uKFBsYXllclR5cGUuQk9UVE9NX1BMQVlFUiwgKGNhcmRMaXN0LCBjYXJkLCB0YXJnZXQpID0+IHtcbiAgICAgICAgY29uc3QgbWF4SHAgPSBwcm9tcHQubWF4QWxsb3dlZERhbWFnZS5maW5kKGQgPT4ge1xuICAgICAgICAgIHJldHVybiBkLnRhcmdldC5wbGF5ZXIgPT09IHRhcmdldC5wbGF5ZXJcbiAgICAgICAgICAgICYmIGQudGFyZ2V0LnNsb3QgPT09IHRhcmdldC5zbG90XG4gICAgICAgICAgICAmJiBkLnRhcmdldC5pbmRleCA9PT0gdGFyZ2V0LmluZGV4O1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgaHAgPSBtYXhIcCA/IG1heEhwLmRhbWFnZSAtIGNhcmRMaXN0LmRhbWFnZSA6IDA7XG4gICAgICAgIGNvbnN0IGRhbWFnZSA9IGNhcmRMaXN0LmRhbWFnZTtcbiAgICAgICAgY29uc3Qgc2NvcmUgPSAtdGhpcy5zdGF0ZVNjb3JlLmdldFBva2Vtb25TY29yZShjYXJkTGlzdCk7XG5cbiAgICAgICAgaWYgKGhwID4gMCAmJiBwcm9tcHQuc2xvdHMuaW5jbHVkZXModGFyZ2V0LnNsb3QpKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHsgdGFyZ2V0LCBjYXJkTGlzdCwgZGFtYWdlLCBocCwgc2NvcmUgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGJsb2NrZWRMaXN0OiBDYXJkTGlzdFtdID0gYmxvY2tlZC5tYXAoYiA9PiBTdGF0ZVV0aWxzLmdldFRhcmdldChzdGF0ZSwgcGxheWVyLCBiKSk7XG4gICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGkgPT4gIWJsb2NrZWRMaXN0LmluY2x1ZGVzKGkuY2FyZExpc3QpKTtcbiAgICByZXN1bHRzLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTtcbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG59XG4iXX0=