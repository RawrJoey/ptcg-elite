"use strict";function cov_2hkzhaf9ev(){var path="/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/bots/simulator.ts";var hash="aeb1d575ee5e4d31ace33d3b2d63e0f89ed255d7";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/bots/simulator.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:0},end:{line:3,column:27}},"2":{start:{line:4,column:16},end:{line:4,column:41}},"3":{start:{line:5,column:22},end:{line:5,column:46}},"4":{start:{line:6,column:21},end:{line:6,column:45}},"5":{start:{line:7,column:23},end:{line:7,column:49}},"6":{start:{line:8,column:16},end:{line:8,column:38}},"7":{start:{line:9,column:15},end:{line:9,column:44}},"8":{start:{line:12,column:8},end:{line:14,column:9}},"9":{start:{line:12,column:36},end:{line:12,column:58}},"10":{start:{line:13,column:12},end:{line:13,column:102}},"11":{start:{line:15,column:8},end:{line:15,column:74}},"12":{start:{line:16,column:8},end:{line:16,column:45}},"13":{start:{line:17,column:8},end:{line:17,column:67}},"14":{start:{line:20,column:8},end:{line:20,column:47}},"15":{start:{line:25,column:27},end:{line:25,column:82}},"16":{start:{line:25,column:56},end:{line:25,column:81}},"17":{start:{line:26,column:8},end:{line:32,column:9}},"18":{start:{line:26,column:21},end:{line:26,column:22}},"19":{start:{line:27,column:27},end:{line:27,column:78}},"20":{start:{line:28,column:12},end:{line:31,column:13}},"21":{start:{line:29,column:16},end:{line:29,column:60}},"22":{start:{line:30,column:16},end:{line:30,column:22}},"23":{start:{line:33,column:8},end:{line:33,column:54}},"24":{start:{line:36,column:20},end:{line:36,column:47}},"25":{start:{line:37,column:22},end:{line:37,column:65}},"26":{start:{line:38,column:8},end:{line:41,column:9}},"27":{start:{line:39,column:12},end:{line:39,column:49}},"28":{start:{line:40,column:12},end:{line:40,column:66}},"29":{start:{line:42,column:8},end:{line:42,column:21}},"30":{start:{line:45,column:0},end:{line:45,column:30}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:11,column:4},end:{line:11,column:5}},loc:{start:{line:11,column:47},end:{line:18,column:5}},line:11},"1":{name:"(anonymous_1)",decl:{start:{line:12,column:31},end:{line:12,column:32}},loc:{start:{line:12,column:36},end:{line:12,column:58}},line:12},"2":{name:"(anonymous_2)",decl:{start:{line:19,column:4},end:{line:19,column:5}},loc:{start:{line:19,column:12},end:{line:21,column:5}},line:19},"3":{name:"(anonymous_3)",decl:{start:{line:22,column:4},end:{line:22,column:5}},loc:{start:{line:22,column:25},end:{line:22,column:28}},line:22},"4":{name:"(anonymous_4)",decl:{start:{line:23,column:4},end:{line:23,column:5}},loc:{start:{line:23,column:32},end:{line:34,column:5}},line:23},"5":{name:"(anonymous_5)",decl:{start:{line:25,column:48},end:{line:25,column:49}},loc:{start:{line:25,column:56},end:{line:25,column:81}},line:25},"6":{name:"(anonymous_6)",decl:{start:{line:35,column:4},end:{line:35,column:5}},loc:{start:{line:35,column:21},end:{line:43,column:5}},line:35}},branchMap:{"0":{loc:{start:{line:11,column:23},end:{line:11,column:45}},type:"default-arg",locations:[{start:{line:11,column:43},end:{line:11,column:45}}],line:11},"1":{loc:{start:{line:12,column:8},end:{line:14,column:9}},type:"if",locations:[{start:{line:12,column:8},end:{line:14,column:9}},{start:{line:12,column:8},end:{line:14,column:9}}],line:12},"2":{loc:{start:{line:28,column:12},end:{line:31,column:13}},type:"if",locations:[{start:{line:28,column:12},end:{line:31,column:13}},{start:{line:28,column:12},end:{line:31,column:13}}],line:28},"3":{loc:{start:{line:33,column:15},end:{line:33,column:53}},type:"cond-expr",locations:[{start:{line:33,column:26},end:{line:33,column:41}},{start:{line:33,column:44},end:{line:33,column:53}}],line:33}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0],"1":[0,0],"2":[0,0],"3":[0,0]},inputSourceMap:{version:3,file:"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/bots/simulator.ts",sources:["/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/bots/simulator.ts"],names:[],mappings:";;;AAAA,0CAAuC;AAEvC,+CAA8D;AAG9D,8CAA0C;AAC1C,kDAAgD;AAEhD,uCAAwC;AACxC,6CAA0C;AAG1C,MAAa,SAAS;IAIpB,YAAY,KAAY,EAAE,oBAAgD,EAAE;QAC1E,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,KAAK,SAAS,CAAC,EAAE;YACnD,MAAM,IAAI,sBAAS,CAAC,4BAAa,CAAC,0BAA0B,CAAC,CAAC;SAC/D;QACD,IAAI,CAAC,UAAU,GAAG,IAAI,wBAAU,CAAC,iBAAiB,CAAC,CAAC;QACpD,IAAI,CAAC,KAAK,GAAG,IAAI,aAAK,CAAC,IAAI,CAAC,CAAC;QAC7B,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,iBAAS,CAAC,KAAK,EAAE,CAAE,WAAI,CAAE,CAAC,CAAC;IAChD,CAAC;IAEM,KAAK;QACV,OAAO,IAAI,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IACzC,CAAC;IAEM,aAAa,CAAC,KAAY,IAAS,CAAC;IAEnC,oBAAoB,CAAC,KAAY;QACvC,IAAI,QAA+D,CAAC;QACpE,MAAM,UAAU,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,KAAK,SAAS,CAAC,CAAC;QAE3E,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC1C,MAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;YACnE,IAAI,MAAM,KAAK,SAAS,EAAE;gBACxB,QAAQ,GAAG,EAAE,EAAE,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,MAAM,EAAE,CAAC;gBAC5C,MAAM;aACP;SACF;QAED,OAAO,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC;IAChD,CAAC;IAEM,QAAQ,CAAC,MAAc;QAC5B,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAExC,IAAI,OAAO,GAAG,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAC1D,OAAO,OAAO,KAAK,SAAS,EAAE;YAC5B,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;YACrC,OAAO,GAAG,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;SACvD;QAED,OAAO,KAAK,CAAC;IACf,CAAC;CAEF;AA9CD,8BA8CC",sourcesContent:["import { Store } from '../store/store';\nimport { Action } from '../store/actions/action';\nimport { BotArbiter, BotArbiterOptions } from './bot-arbiter';\nimport { State } from '../store/state/state';\nimport { StoreHandler } from '../store/store-handler';\nimport { GameError } from '../game-error';\nimport { GameCoreError } from '../game-message';\nimport { ResolvePromptAction } from '../store/actions/resolve-prompt-action';\nimport { deepClone } from '../../utils';\nimport { Card } from '../store/card/card';\n\n\nexport class Simulator implements StoreHandler {\n  public store: Store;\n  private botArbiter: BotArbiter;\n\n  constructor(state: State, botArbiterOptions: Partial<BotArbiterOptions> = {}) {\n    if (state.prompts.some(p => p.result === undefined)) {\n      throw new GameError(GameCoreError.ERROR_SIMULATOR_NOT_STABLE);\n    }\n    this.botArbiter = new BotArbiter(botArbiterOptions);\n    this.store = new Store(this);\n    this.store.state = deepClone(state, [ Card ]);\n  }\n\n  public clone(): Simulator {\n    return new Simulator(this.store.state);\n  }\n\n  public onStateChange(state: State): void {}\n\n  private handleArbiterPrompts(state: State): ResolvePromptAction | undefined {\n    let resolved: {id: number, action: ResolvePromptAction} | undefined;\n    const unresolved = state.prompts.filter(item => item.result === undefined);\n\n    for (let i = 0; i < unresolved.length; i++) {\n      const action = this.botArbiter.resolvePrompt(state, unresolved[i]);\n      if (action !== undefined) {\n        resolved = { id: unresolved[i].id, action };\n        break;\n      }\n    }\n\n    return resolved ? resolved.action : undefined;\n  }\n\n  public dispatch(action: Action): State {\n    let state = this.store.dispatch(action);\n\n    let resolve = this.handleArbiterPrompts(this.store.state);\n    while (resolve !== undefined) {\n      state = this.store.dispatch(resolve);\n      resolve = this.handleArbiterPrompts(this.store.state);\n    }\n\n    return state;\n  }\n\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"aeb1d575ee5e4d31ace33d3b2d63e0f89ed255d7"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2hkzhaf9ev=function(){return actualCoverage;};}return actualCoverage;}cov_2hkzhaf9ev();cov_2hkzhaf9ev().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_2hkzhaf9ev().s[1]++;exports.Simulator=void 0;const store_1=(cov_2hkzhaf9ev().s[2]++,require("../store/store"));const bot_arbiter_1=(cov_2hkzhaf9ev().s[3]++,require("./bot-arbiter"));const game_error_1=(cov_2hkzhaf9ev().s[4]++,require("../game-error"));const game_message_1=(cov_2hkzhaf9ev().s[5]++,require("../game-message"));const utils_1=(cov_2hkzhaf9ev().s[6]++,require("../../utils"));const card_1=(cov_2hkzhaf9ev().s[7]++,require("../store/card/card"));class Simulator{constructor(state,botArbiterOptions=(cov_2hkzhaf9ev().b[0][0]++,{})){cov_2hkzhaf9ev().f[0]++;cov_2hkzhaf9ev().s[8]++;if(state.prompts.some(p=>{cov_2hkzhaf9ev().f[1]++;cov_2hkzhaf9ev().s[9]++;return p.result===undefined;})){cov_2hkzhaf9ev().b[1][0]++;cov_2hkzhaf9ev().s[10]++;throw new game_error_1.GameError(game_message_1.GameCoreError.ERROR_SIMULATOR_NOT_STABLE);}else{cov_2hkzhaf9ev().b[1][1]++;}cov_2hkzhaf9ev().s[11]++;this.botArbiter=new bot_arbiter_1.BotArbiter(botArbiterOptions);cov_2hkzhaf9ev().s[12]++;this.store=new store_1.Store(this);cov_2hkzhaf9ev().s[13]++;this.store.state=utils_1.deepClone(state,[card_1.Card]);}clone(){cov_2hkzhaf9ev().f[2]++;cov_2hkzhaf9ev().s[14]++;return new Simulator(this.store.state);}onStateChange(state){cov_2hkzhaf9ev().f[3]++;}handleArbiterPrompts(state){cov_2hkzhaf9ev().f[4]++;let resolved;const unresolved=(cov_2hkzhaf9ev().s[15]++,state.prompts.filter(item=>{cov_2hkzhaf9ev().f[5]++;cov_2hkzhaf9ev().s[16]++;return item.result===undefined;}));cov_2hkzhaf9ev().s[17]++;for(let i=(cov_2hkzhaf9ev().s[18]++,0);i<unresolved.length;i++){const action=(cov_2hkzhaf9ev().s[19]++,this.botArbiter.resolvePrompt(state,unresolved[i]));cov_2hkzhaf9ev().s[20]++;if(action!==undefined){cov_2hkzhaf9ev().b[2][0]++;cov_2hkzhaf9ev().s[21]++;resolved={id:unresolved[i].id,action};cov_2hkzhaf9ev().s[22]++;break;}else{cov_2hkzhaf9ev().b[2][1]++;}}cov_2hkzhaf9ev().s[23]++;return resolved?(cov_2hkzhaf9ev().b[3][0]++,resolved.action):(cov_2hkzhaf9ev().b[3][1]++,undefined);}dispatch(action){cov_2hkzhaf9ev().f[6]++;let state=(cov_2hkzhaf9ev().s[24]++,this.store.dispatch(action));let resolve=(cov_2hkzhaf9ev().s[25]++,this.handleArbiterPrompts(this.store.state));cov_2hkzhaf9ev().s[26]++;while(resolve!==undefined){cov_2hkzhaf9ev().s[27]++;state=this.store.dispatch(resolve);cov_2hkzhaf9ev().s[28]++;resolve=this.handleArbiterPrompts(this.store.state);}cov_2hkzhaf9ev().s[29]++;return state;}}cov_2hkzhaf9ev().s[30]++;exports.Simulator=Simulator;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2pvZW15ZXJzY291Z2gvRG9jdW1lbnRzL0dpdEh1Yi9wdGNnLWVwc2QvcHRjZy1zZXJ2ZXIvc3JjL2dhbWUvYm90cy9zaW11bGF0b3IudHMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9qb2VteWVyc2NvdWdoL0RvY3VtZW50cy9HaXRIdWIvcHRjZy1lcHNkL3B0Y2ctc2VydmVyL3NyYy9nYW1lL2JvdHMvc2ltdWxhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDBDQUF1QztBQUV2QywrQ0FBOEQ7QUFHOUQsOENBQTBDO0FBQzFDLGtEQUFnRDtBQUVoRCx1Q0FBd0M7QUFDeEMsNkNBQTBDO0FBRzFDLE1BQWEsU0FBUztJQUlwQixZQUFZLEtBQVksRUFBRSxvQkFBZ0QsRUFBRTtRQUMxRSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxTQUFTLENBQUMsRUFBRTtZQUNuRCxNQUFNLElBQUksc0JBQVMsQ0FBQyw0QkFBYSxDQUFDLDBCQUEwQixDQUFDLENBQUM7U0FDL0Q7UUFDRCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksd0JBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxhQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDN0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsaUJBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBRSxXQUFJLENBQUUsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFTSxLQUFLO1FBQ1YsT0FBTyxJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFTSxhQUFhLENBQUMsS0FBWSxJQUFTLENBQUM7SUFFbkMsb0JBQW9CLENBQUMsS0FBWTtRQUN2QyxJQUFJLFFBQStELENBQUM7UUFDcEUsTUFBTSxVQUFVLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLFNBQVMsQ0FBQyxDQUFDO1FBRTNFLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzFDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNuRSxJQUFJLE1BQU0sS0FBSyxTQUFTLEVBQUU7Z0JBQ3hCLFFBQVEsR0FBRyxFQUFFLEVBQUUsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDO2dCQUM1QyxNQUFNO2FBQ1A7U0FDRjtRQUVELE9BQU8sUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7SUFDaEQsQ0FBQztJQUVNLFFBQVEsQ0FBQyxNQUFjO1FBQzVCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXhDLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzFELE9BQU8sT0FBTyxLQUFLLFNBQVMsRUFBRTtZQUM1QixLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDckMsT0FBTyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3ZEO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0NBRUY7QUE5Q0QsOEJBOENDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3RvcmUgfSBmcm9tICcuLi9zdG9yZS9zdG9yZSc7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tICcuLi9zdG9yZS9hY3Rpb25zL2FjdGlvbic7XG5pbXBvcnQgeyBCb3RBcmJpdGVyLCBCb3RBcmJpdGVyT3B0aW9ucyB9IGZyb20gJy4vYm90LWFyYml0ZXInO1xuaW1wb3J0IHsgU3RhdGUgfSBmcm9tICcuLi9zdG9yZS9zdGF0ZS9zdGF0ZSc7XG5pbXBvcnQgeyBTdG9yZUhhbmRsZXIgfSBmcm9tICcuLi9zdG9yZS9zdG9yZS1oYW5kbGVyJztcbmltcG9ydCB7IEdhbWVFcnJvciB9IGZyb20gJy4uL2dhbWUtZXJyb3InO1xuaW1wb3J0IHsgR2FtZUNvcmVFcnJvciB9IGZyb20gJy4uL2dhbWUtbWVzc2FnZSc7XG5pbXBvcnQgeyBSZXNvbHZlUHJvbXB0QWN0aW9uIH0gZnJvbSAnLi4vc3RvcmUvYWN0aW9ucy9yZXNvbHZlLXByb21wdC1hY3Rpb24nO1xuaW1wb3J0IHsgZGVlcENsb25lIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xuaW1wb3J0IHsgQ2FyZCB9IGZyb20gJy4uL3N0b3JlL2NhcmQvY2FyZCc7XG5cblxuZXhwb3J0IGNsYXNzIFNpbXVsYXRvciBpbXBsZW1lbnRzIFN0b3JlSGFuZGxlciB7XG4gIHB1YmxpYyBzdG9yZTogU3RvcmU7XG4gIHByaXZhdGUgYm90QXJiaXRlcjogQm90QXJiaXRlcjtcblxuICBjb25zdHJ1Y3RvcihzdGF0ZTogU3RhdGUsIGJvdEFyYml0ZXJPcHRpb25zOiBQYXJ0aWFsPEJvdEFyYml0ZXJPcHRpb25zPiA9IHt9KSB7XG4gICAgaWYgKHN0YXRlLnByb21wdHMuc29tZShwID0+IHAucmVzdWx0ID09PSB1bmRlZmluZWQpKSB7XG4gICAgICB0aHJvdyBuZXcgR2FtZUVycm9yKEdhbWVDb3JlRXJyb3IuRVJST1JfU0lNVUxBVE9SX05PVF9TVEFCTEUpO1xuICAgIH1cbiAgICB0aGlzLmJvdEFyYml0ZXIgPSBuZXcgQm90QXJiaXRlcihib3RBcmJpdGVyT3B0aW9ucyk7XG4gICAgdGhpcy5zdG9yZSA9IG5ldyBTdG9yZSh0aGlzKTtcbiAgICB0aGlzLnN0b3JlLnN0YXRlID0gZGVlcENsb25lKHN0YXRlLCBbIENhcmQgXSk7XG4gIH1cblxuICBwdWJsaWMgY2xvbmUoKTogU2ltdWxhdG9yIHtcbiAgICByZXR1cm4gbmV3IFNpbXVsYXRvcih0aGlzLnN0b3JlLnN0YXRlKTtcbiAgfVxuXG4gIHB1YmxpYyBvblN0YXRlQ2hhbmdlKHN0YXRlOiBTdGF0ZSk6IHZvaWQge31cblxuICBwcml2YXRlIGhhbmRsZUFyYml0ZXJQcm9tcHRzKHN0YXRlOiBTdGF0ZSk6IFJlc29sdmVQcm9tcHRBY3Rpb24gfCB1bmRlZmluZWQge1xuICAgIGxldCByZXNvbHZlZDoge2lkOiBudW1iZXIsIGFjdGlvbjogUmVzb2x2ZVByb21wdEFjdGlvbn0gfCB1bmRlZmluZWQ7XG4gICAgY29uc3QgdW5yZXNvbHZlZCA9IHN0YXRlLnByb21wdHMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5yZXN1bHQgPT09IHVuZGVmaW5lZCk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVucmVzb2x2ZWQubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMuYm90QXJiaXRlci5yZXNvbHZlUHJvbXB0KHN0YXRlLCB1bnJlc29sdmVkW2ldKTtcbiAgICAgIGlmIChhY3Rpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXNvbHZlZCA9IHsgaWQ6IHVucmVzb2x2ZWRbaV0uaWQsIGFjdGlvbiB9O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzb2x2ZWQgPyByZXNvbHZlZC5hY3Rpb24gOiB1bmRlZmluZWQ7XG4gIH1cblxuICBwdWJsaWMgZGlzcGF0Y2goYWN0aW9uOiBBY3Rpb24pOiBTdGF0ZSB7XG4gICAgbGV0IHN0YXRlID0gdGhpcy5zdG9yZS5kaXNwYXRjaChhY3Rpb24pO1xuXG4gICAgbGV0IHJlc29sdmUgPSB0aGlzLmhhbmRsZUFyYml0ZXJQcm9tcHRzKHRoaXMuc3RvcmUuc3RhdGUpO1xuICAgIHdoaWxlIChyZXNvbHZlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHN0YXRlID0gdGhpcy5zdG9yZS5kaXNwYXRjaChyZXNvbHZlKTtcbiAgICAgIHJlc29sdmUgPSB0aGlzLmhhbmRsZUFyYml0ZXJQcm9tcHRzKHRoaXMuc3RvcmUuc3RhdGUpO1xuICAgIH1cblxuICAgIHJldHVybiBzdGF0ZTtcbiAgfVxuXG59XG4iXX0=
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qb2VteWVyc2NvdWdoL0RvY3VtZW50cy9HaXRIdWIvcHRjZy1lcHNkL3B0Y2ctc2VydmVyL3NyYy9nYW1lL2JvdHMvc2ltdWxhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJva1FBcUJROzZOQXJCUixLQUFBLENBQUEsT0FBQSwwQkFBQSxPQUFBLENBQUEsZ0JBQUEsQ0FBQSxDQUFBLENBRUEsS0FBQSxDQUFBLGFBQUEsMEJBQUEsT0FBQSxDQUFBLGVBQUEsQ0FBQSxDQUFBLENBR0EsS0FBQSxDQUFBLFlBQUEsMEJBQUEsT0FBQSxDQUFBLGVBQUEsQ0FBQSxDQUFBLENBQ0EsS0FBQSxDQUFBLGNBQUEsMEJBQUEsT0FBQSxDQUFBLGlCQUFBLENBQUEsQ0FBQSxDQUVBLEtBQUEsQ0FBQSxPQUFBLDBCQUFBLE9BQUEsQ0FBQSxhQUFBLENBQUEsQ0FBQSxDQUNBLEtBQUEsQ0FBQSxNQUFBLDBCQUFBLE9BQUEsQ0FBQSxvQkFBQSxDQUFBLENBQUEsQ0FHQSxLQUFhLENBQUEsU0FBUyxDQUlwQixXQUFBLENBQVksS0FBWixDQUEwQixpQkFBQSw2QkFBZ0QsRUFBaEQsQ0FBMUIsQ0FBNEUsaURBQzFFLEdBQUksS0FBSyxDQUFDLE9BQU4sQ0FBYyxJQUFkLENBQW1CLENBQUMsRUFBSSx1REFBQSxDQUFBLENBQUMsQ0FBQyxNQUFGLEdBQWEsU0FBYixDQUFzQixDQUE5QyxDQUFKLENBQXFELHFEQUNuRCxLQUFNLElBQUksQ0FBQSxZQUFBLENBQUEsU0FBSixDQUFjLGNBQUEsQ0FBQSxhQUFBLENBQWMsMEJBQTVCLENBQU4sQ0FDRCxDQUZELGlDQUQwRSx5QkFJMUUsS0FBSyxVQUFMLENBQWtCLEdBQUksQ0FBQSxhQUFBLENBQUEsVUFBSixDQUFlLGlCQUFmLENBQWxCLENBSjBFLHlCQUsxRSxLQUFLLEtBQUwsQ0FBYSxHQUFJLENBQUEsT0FBQSxDQUFBLEtBQUosQ0FBVSxJQUFWLENBQWIsQ0FMMEUseUJBTTFFLEtBQUssS0FBTCxDQUFXLEtBQVgsQ0FBbUIsT0FBQSxDQUFBLFNBQUEsQ0FBVSxLQUFWLENBQWlCLENBQUUsTUFBQSxDQUFBLElBQUYsQ0FBakIsQ0FBbkIsQ0FDRCxDQUVNLEtBQUssRUFBQSxrREFDVixNQUFPLElBQUksQ0FBQSxTQUFKLENBQWMsS0FBSyxLQUFMLENBQVcsS0FBekIsQ0FBUCxDQUNELENBRU0sYUFBYSxDQUFDLEtBQUQsQ0FBYSx5QkFBVSxDQUVuQyxvQkFBb0IsQ0FBQyxLQUFELENBQWEseUJBQ3ZDLEdBQUksQ0FBQSxRQUFKLENBQ0EsS0FBTSxDQUFBLFVBQVUsMkJBQUcsS0FBSyxDQUFDLE9BQU4sQ0FBYyxNQUFkLENBQXFCLElBQUksRUFBSSx3REFBQSxDQUFBLElBQUksQ0FBQyxNQUFMLEdBQWdCLFNBQWhCLENBQXlCLENBQXRELENBQUgsQ0FBaEIsQ0FGdUMseUJBSXZDLElBQUssR0FBSSxDQUFBLENBQUMsMkJBQUcsQ0FBSCxDQUFWLENBQWdCLENBQUMsQ0FBRyxVQUFVLENBQUMsTUFBL0IsQ0FBdUMsQ0FBQyxFQUF4QyxDQUE0QyxDQUMxQyxLQUFNLENBQUEsTUFBTSwyQkFBRyxLQUFLLFVBQUwsQ0FBZ0IsYUFBaEIsQ0FBOEIsS0FBOUIsQ0FBcUMsVUFBVSxDQUFDLENBQUQsQ0FBL0MsQ0FBSCxDQUFaLENBRDBDLHlCQUUxQyxHQUFJLE1BQU0sR0FBSyxTQUFmLENBQTBCLHFEQUN4QixRQUFRLENBQUcsQ0FBRSxFQUFFLENBQUUsVUFBVSxDQUFDLENBQUQsQ0FBVixDQUFjLEVBQXBCLENBQXdCLE1BQXhCLENBQVgsQ0FEd0IseUJBRXhCLE1BQ0QsQ0FIRCxpQ0FJRCxDQVZzQyx5QkFZdkMsTUFBTyxDQUFBLFFBQVEsNkJBQUcsUUFBUSxDQUFDLE1BQVosOEJBQXFCLFNBQXJCLENBQWYsQ0FDRCxDQUVNLFFBQVEsQ0FBQyxNQUFELENBQWUseUJBQzVCLEdBQUksQ0FBQSxLQUFLLDJCQUFHLEtBQUssS0FBTCxDQUFXLFFBQVgsQ0FBb0IsTUFBcEIsQ0FBSCxDQUFULENBRUEsR0FBSSxDQUFBLE9BQU8sMkJBQUcsS0FBSyxvQkFBTCxDQUEwQixLQUFLLEtBQUwsQ0FBVyxLQUFyQyxDQUFILENBQVgsQ0FINEIseUJBSTVCLE1BQU8sT0FBTyxHQUFLLFNBQW5CLENBQThCLDBCQUM1QixLQUFLLENBQUcsS0FBSyxLQUFMLENBQVcsUUFBWCxDQUFvQixPQUFwQixDQUFSLENBRDRCLHlCQUU1QixPQUFPLENBQUcsS0FBSyxvQkFBTCxDQUEwQixLQUFLLEtBQUwsQ0FBVyxLQUFyQyxDQUFWLENBQ0QsQ0FQMkIseUJBUzVCLE1BQU8sQ0FBQSxLQUFQLENBQ0QsQ0E1Q21CLEMseUJBQXRCLE9BQUEsQ0FBQSxTQUFBLENBQUEsU0FBQSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3RvcmUgfSBmcm9tICcuLi9zdG9yZS9zdG9yZSc7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tICcuLi9zdG9yZS9hY3Rpb25zL2FjdGlvbic7XG5pbXBvcnQgeyBCb3RBcmJpdGVyLCBCb3RBcmJpdGVyT3B0aW9ucyB9IGZyb20gJy4vYm90LWFyYml0ZXInO1xuaW1wb3J0IHsgU3RhdGUgfSBmcm9tICcuLi9zdG9yZS9zdGF0ZS9zdGF0ZSc7XG5pbXBvcnQgeyBTdG9yZUhhbmRsZXIgfSBmcm9tICcuLi9zdG9yZS9zdG9yZS1oYW5kbGVyJztcbmltcG9ydCB7IEdhbWVFcnJvciB9IGZyb20gJy4uL2dhbWUtZXJyb3InO1xuaW1wb3J0IHsgR2FtZUNvcmVFcnJvciB9IGZyb20gJy4uL2dhbWUtbWVzc2FnZSc7XG5pbXBvcnQgeyBSZXNvbHZlUHJvbXB0QWN0aW9uIH0gZnJvbSAnLi4vc3RvcmUvYWN0aW9ucy9yZXNvbHZlLXByb21wdC1hY3Rpb24nO1xuaW1wb3J0IHsgZGVlcENsb25lIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xuaW1wb3J0IHsgQ2FyZCB9IGZyb20gJy4uL3N0b3JlL2NhcmQvY2FyZCc7XG5cblxuZXhwb3J0IGNsYXNzIFNpbXVsYXRvciBpbXBsZW1lbnRzIFN0b3JlSGFuZGxlciB7XG4gIHB1YmxpYyBzdG9yZTogU3RvcmU7XG4gIHByaXZhdGUgYm90QXJiaXRlcjogQm90QXJiaXRlcjtcblxuICBjb25zdHJ1Y3RvcihzdGF0ZTogU3RhdGUsIGJvdEFyYml0ZXJPcHRpb25zOiBQYXJ0aWFsPEJvdEFyYml0ZXJPcHRpb25zPiA9IHt9KSB7XG4gICAgaWYgKHN0YXRlLnByb21wdHMuc29tZShwID0+IHAucmVzdWx0ID09PSB1bmRlZmluZWQpKSB7XG4gICAgICB0aHJvdyBuZXcgR2FtZUVycm9yKEdhbWVDb3JlRXJyb3IuRVJST1JfU0lNVUxBVE9SX05PVF9TVEFCTEUpO1xuICAgIH1cbiAgICB0aGlzLmJvdEFyYml0ZXIgPSBuZXcgQm90QXJiaXRlcihib3RBcmJpdGVyT3B0aW9ucyk7XG4gICAgdGhpcy5zdG9yZSA9IG5ldyBTdG9yZSh0aGlzKTtcbiAgICB0aGlzLnN0b3JlLnN0YXRlID0gZGVlcENsb25lKHN0YXRlLCBbIENhcmQgXSk7XG4gIH1cblxuICBwdWJsaWMgY2xvbmUoKTogU2ltdWxhdG9yIHtcbiAgICByZXR1cm4gbmV3IFNpbXVsYXRvcih0aGlzLnN0b3JlLnN0YXRlKTtcbiAgfVxuXG4gIHB1YmxpYyBvblN0YXRlQ2hhbmdlKHN0YXRlOiBTdGF0ZSk6IHZvaWQge31cblxuICBwcml2YXRlIGhhbmRsZUFyYml0ZXJQcm9tcHRzKHN0YXRlOiBTdGF0ZSk6IFJlc29sdmVQcm9tcHRBY3Rpb24gfCB1bmRlZmluZWQge1xuICAgIGxldCByZXNvbHZlZDoge2lkOiBudW1iZXIsIGFjdGlvbjogUmVzb2x2ZVByb21wdEFjdGlvbn0gfCB1bmRlZmluZWQ7XG4gICAgY29uc3QgdW5yZXNvbHZlZCA9IHN0YXRlLnByb21wdHMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5yZXN1bHQgPT09IHVuZGVmaW5lZCk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVucmVzb2x2ZWQubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMuYm90QXJiaXRlci5yZXNvbHZlUHJvbXB0KHN0YXRlLCB1bnJlc29sdmVkW2ldKTtcbiAgICAgIGlmIChhY3Rpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXNvbHZlZCA9IHsgaWQ6IHVucmVzb2x2ZWRbaV0uaWQsIGFjdGlvbiB9O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzb2x2ZWQgPyByZXNvbHZlZC5hY3Rpb24gOiB1bmRlZmluZWQ7XG4gIH1cblxuICBwdWJsaWMgZGlzcGF0Y2goYWN0aW9uOiBBY3Rpb24pOiBTdGF0ZSB7XG4gICAgbGV0IHN0YXRlID0gdGhpcy5zdG9yZS5kaXNwYXRjaChhY3Rpb24pO1xuXG4gICAgbGV0IHJlc29sdmUgPSB0aGlzLmhhbmRsZUFyYml0ZXJQcm9tcHRzKHRoaXMuc3RvcmUuc3RhdGUpO1xuICAgIHdoaWxlIChyZXNvbHZlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHN0YXRlID0gdGhpcy5zdG9yZS5kaXNwYXRjaChyZXNvbHZlKTtcbiAgICAgIHJlc29sdmUgPSB0aGlzLmhhbmRsZUFyYml0ZXJQcm9tcHRzKHRoaXMuc3RvcmUuc3RhdGUpO1xuICAgIH1cblxuICAgIHJldHVybiBzdGF0ZTtcbiAgfVxuXG59XG4iXX0=