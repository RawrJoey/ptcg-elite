"use strict";function cov_1bqqkird0l(){var path="/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/reducers/abort-game-reducer.ts";var hash="8aa7301e9b375a8613f78d504a1177ff178908c4";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/reducers/abort-game-reducer.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:0},end:{line:3,column:34}},"2":{start:{line:4,column:16},end:{line:4,column:41}},"3":{start:{line:5,column:21},end:{line:5,column:48}},"4":{start:{line:6,column:23},end:{line:6,column:52}},"5":{start:{line:7,column:28},end:{line:7,column:67}},"6":{start:{line:8,column:23},end:{line:8,column:65}},"7":{start:{line:9,column:22},end:{line:9,column:47}},"8":{start:{line:11,column:4},end:{line:60,column:5}},"9":{start:{line:12,column:24},end:{line:12,column:74}},"10":{start:{line:12,column:48},end:{line:12,column:73}},"11":{start:{line:13,column:8},end:{line:15,column:9}},"12":{start:{line:14,column:12},end:{line:14,column:88}},"13":{start:{line:17,column:8},end:{line:21,column:11}},"14":{start:{line:18,column:12},end:{line:20,column:13}},"15":{start:{line:19,column:16},end:{line:19,column:37}},"16":{start:{line:23,column:8},end:{line:33,column:9}},"17":{start:{line:25,column:16},end:{line:25,column:98}},"18":{start:{line:26,column:16},end:{line:26,column:22}},"19":{start:{line:28,column:16},end:{line:28,column:103}},"20":{start:{line:29,column:16},end:{line:29,column:22}},"21":{start:{line:31,column:16},end:{line:31,column:106}},"22":{start:{line:32,column:16},end:{line:32,column:22}},"23":{start:{line:35,column:8},end:{line:40,column:9}},"24":{start:{line:36,column:12},end:{line:36,column:86}},"25":{start:{line:37,column:12},end:{line:37,column:53}},"26":{start:{line:38,column:12},end:{line:38,column:51}},"27":{start:{line:39,column:12},end:{line:39,column:25}},"28":{start:{line:42,column:25},end:{line:42,column:77}},"29":{start:{line:43,column:33},end:{line:43,column:55}},"30":{start:{line:44,column:34},end:{line:44,column:57}},"31":{start:{line:46,column:8},end:{line:49,column:9}},"32":{start:{line:47,column:12},end:{line:47,column:82}},"33":{start:{line:48,column:12},end:{line:48,column:25}},"34":{start:{line:51,column:8},end:{line:57,column:9}},"35":{start:{line:52,column:27},end:{line:54,column:45}},"36":{start:{line:55,column:12},end:{line:55,column:65}},"37":{start:{line:56,column:12},end:{line:56,column:25}},"38":{start:{line:59,column:8},end:{line:59,column:78}},"39":{start:{line:61,column:4},end:{line:61,column:17}},"40":{start:{line:63,column:0},end:{line:63,column:44}}},fnMap:{"0":{name:"abortGameReducer",decl:{start:{line:10,column:9},end:{line:10,column:25}},loc:{start:{line:10,column:48},end:{line:62,column:1}},line:10},"1":{name:"(anonymous_1)",decl:{start:{line:12,column:43},end:{line:12,column:44}},loc:{start:{line:12,column:48},end:{line:12,column:73}},line:12},"2":{name:"(anonymous_2)",decl:{start:{line:17,column:30},end:{line:17,column:31}},loc:{start:{line:17,column:40},end:{line:21,column:9}},line:17}},branchMap:{"0":{loc:{start:{line:11,column:4},end:{line:60,column:5}},type:"if",locations:[{start:{line:11,column:4},end:{line:60,column:5}},{start:{line:11,column:4},end:{line:60,column:5}}],line:11},"1":{loc:{start:{line:11,column:8},end:{line:11,column:107}},type:"binary-expr",locations:[{start:{line:11,column:8},end:{line:11,column:50}},{start:{line:11,column:54},end:{line:11,column:107}}],line:11},"2":{loc:{start:{line:13,column:8},end:{line:15,column:9}},type:"if",locations:[{start:{line:13,column:8},end:{line:15,column:9}},{start:{line:13,column:8},end:{line:15,column:9}}],line:13},"3":{loc:{start:{line:18,column:12},end:{line:20,column:13}},type:"if",locations:[{start:{line:18,column:12},end:{line:20,column:13}},{start:{line:18,column:12},end:{line:20,column:13}}],line:18},"4":{loc:{start:{line:23,column:8},end:{line:33,column:9}},type:"switch",locations:[{start:{line:24,column:12},end:{line:26,column:22}},{start:{line:27,column:12},end:{line:29,column:22}},{start:{line:30,column:12},end:{line:32,column:22}}],line:23},"5":{loc:{start:{line:35,column:8},end:{line:40,column:9}},type:"if",locations:[{start:{line:35,column:8},end:{line:40,column:9}},{start:{line:35,column:8},end:{line:40,column:9}}],line:35},"6":{loc:{start:{line:35,column:12},end:{line:35,column:108}},type:"binary-expr",locations:[{start:{line:35,column:12},end:{line:35,column:65}},{start:{line:35,column:69},end:{line:35,column:108}}],line:35},"7":{loc:{start:{line:46,column:8},end:{line:49,column:9}},type:"if",locations:[{start:{line:46,column:8},end:{line:49,column:9}},{start:{line:46,column:8},end:{line:49,column:9}}],line:46},"8":{loc:{start:{line:46,column:12},end:{line:46,column:69}},type:"binary-expr",locations:[{start:{line:46,column:12},end:{line:46,column:27}},{start:{line:46,column:31},end:{line:46,column:69}}],line:46},"9":{loc:{start:{line:51,column:8},end:{line:57,column:9}},type:"if",locations:[{start:{line:51,column:8},end:{line:57,column:9}},{start:{line:51,column:8},end:{line:57,column:9}}],line:51},"10":{loc:{start:{line:52,column:27},end:{line:54,column:45}},type:"cond-expr",locations:[{start:{line:53,column:18},end:{line:53,column:45}},{start:{line:54,column:18},end:{line:54,column:45}}],line:52}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},inputSourceMap:{version:3,file:"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/reducers/abort-game-reducer.ts",sources:["/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/reducers/abort-game-reducer.ts"],names:[],mappings:"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",sourcesContent:["import { Action } from '../actions/action';\nimport { State, GamePhase, GameWinner } from '../state/state';\nimport { GameError } from '../../game-error';\nimport { GameMessage, GameLog } from '../../game-message';\nimport { StoreLike } from '../store-like';\nimport { AbortGameAction, AbortGameReason} from '../actions/abort-game-action';\nimport { endGame } from '../effect-reducers/check-effect';\nimport {StateUtils} from '../state-utils';\n\n\nexport function abortGameReducer(store: StoreLike, state: State, action: Action): State {\n\n  if (state.phase !== GamePhase.FINISHED && action instanceof AbortGameAction) {\n\n    const culprit = state.players.find(p => p.id === action.culpritId);\n    if (culprit === undefined) {\n      throw new GameError(GameMessage.ILLEGAL_ACTION);\n    }\n\n    // Mark all prompts as resolved, so they won't mess with our state anymore.\n    state.prompts.forEach(prompt => {\n      if (prompt.result === undefined) {\n        prompt.result = null;\n      }\n    });\n\n    // Explain why game was aborted\n    switch (action.reason) {\n      case AbortGameReason.TIME_ELAPSED:\n        store.log(state, GameLog.LOG_TIME_ELAPSED, { name: culprit.name });\n        break;\n      case AbortGameReason.ILLEGAL_MOVES:\n        store.log(state, GameLog.LOG_BANNED_BY_ARBITER, { name: culprit.name });\n        break;\n      case AbortGameReason.DISCONNECTED:\n        store.log(state, GameLog.LOG_PLAYER_LEFT_THE_GAME, { name: culprit.name });\n        break;\n    }\n\n    // Game has not started, no winner\n    if (state.phase === GamePhase.WAITING_FOR_PLAYERS || state.phase === GamePhase.SETUP) {\n      store.log(state, GameLog.LOG_GAME_FINISHED_BEFORE_STARTED);\n      state.phase = GamePhase.FINISHED;\n      state.winner = GameWinner.NONE;\n      return state;\n    }\n\n    // Let's decide who wins.\n    const opponent = StateUtils.getOpponent(state, culprit);\n    const culpritPrizeLeft = culprit.getPrizeLeft();\n    const opponentPrizeLeft = opponent.getPrizeLeft();\n\n    // It was first turn, no winner\n    if (state.turn <= 2 && culpritPrizeLeft === opponentPrizeLeft) {\n      state = endGame(store, state, GameWinner.NONE);\n      return state;\n    }\n\n    // Opponent has same or less prizes, he wins\n    if (opponentPrizeLeft <= culpritPrizeLeft) {\n      const winner = opponent === state.players[0]\n        ? GameWinner.PLAYER_1\n        : GameWinner.PLAYER_2;\n      state = endGame(store, state, winner);\n      return state;\n    }\n\n    // Otherwise it's a draw\n    state = endGame(store, state, GameWinner.DRAW);\n  }\n\n  return state;\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"8aa7301e9b375a8613f78d504a1177ff178908c4"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1bqqkird0l=function(){return actualCoverage;};}return actualCoverage;}cov_1bqqkird0l();cov_1bqqkird0l().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_1bqqkird0l().s[1]++;exports.abortGameReducer=void 0;const state_1=(cov_1bqqkird0l().s[2]++,require("../state/state"));const game_error_1=(cov_1bqqkird0l().s[3]++,require("../../game-error"));const game_message_1=(cov_1bqqkird0l().s[4]++,require("../../game-message"));const abort_game_action_1=(cov_1bqqkird0l().s[5]++,require("../actions/abort-game-action"));const check_effect_1=(cov_1bqqkird0l().s[6]++,require("../effect-reducers/check-effect"));const state_utils_1=(cov_1bqqkird0l().s[7]++,require("../state-utils"));function abortGameReducer(store,state,action){cov_1bqqkird0l().f[0]++;cov_1bqqkird0l().s[8]++;if((cov_1bqqkird0l().b[1][0]++,state.phase!==state_1.GamePhase.FINISHED)&&(cov_1bqqkird0l().b[1][1]++,action instanceof abort_game_action_1.AbortGameAction)){cov_1bqqkird0l().b[0][0]++;const culprit=(cov_1bqqkird0l().s[9]++,state.players.find(p=>{cov_1bqqkird0l().f[1]++;cov_1bqqkird0l().s[10]++;return p.id===action.culpritId;}));cov_1bqqkird0l().s[11]++;if(culprit===undefined){cov_1bqqkird0l().b[2][0]++;cov_1bqqkird0l().s[12]++;throw new game_error_1.GameError(game_message_1.GameMessage.ILLEGAL_ACTION);}else{cov_1bqqkird0l().b[2][1]++;}// Mark all prompts as resolved, so they won't mess with our state anymore.
cov_1bqqkird0l().s[13]++;state.prompts.forEach(prompt=>{cov_1bqqkird0l().f[2]++;cov_1bqqkird0l().s[14]++;if(prompt.result===undefined){cov_1bqqkird0l().b[3][0]++;cov_1bqqkird0l().s[15]++;prompt.result=null;}else{cov_1bqqkird0l().b[3][1]++;}});// Explain why game was aborted
cov_1bqqkird0l().s[16]++;switch(action.reason){case abort_game_action_1.AbortGameReason.TIME_ELAPSED:cov_1bqqkird0l().b[4][0]++;cov_1bqqkird0l().s[17]++;store.log(state,game_message_1.GameLog.LOG_TIME_ELAPSED,{name:culprit.name});cov_1bqqkird0l().s[18]++;break;case abort_game_action_1.AbortGameReason.ILLEGAL_MOVES:cov_1bqqkird0l().b[4][1]++;cov_1bqqkird0l().s[19]++;store.log(state,game_message_1.GameLog.LOG_BANNED_BY_ARBITER,{name:culprit.name});cov_1bqqkird0l().s[20]++;break;case abort_game_action_1.AbortGameReason.DISCONNECTED:cov_1bqqkird0l().b[4][2]++;cov_1bqqkird0l().s[21]++;store.log(state,game_message_1.GameLog.LOG_PLAYER_LEFT_THE_GAME,{name:culprit.name});cov_1bqqkird0l().s[22]++;break;}// Game has not started, no winner
cov_1bqqkird0l().s[23]++;if((cov_1bqqkird0l().b[6][0]++,state.phase===state_1.GamePhase.WAITING_FOR_PLAYERS)||(cov_1bqqkird0l().b[6][1]++,state.phase===state_1.GamePhase.SETUP)){cov_1bqqkird0l().b[5][0]++;cov_1bqqkird0l().s[24]++;store.log(state,game_message_1.GameLog.LOG_GAME_FINISHED_BEFORE_STARTED);cov_1bqqkird0l().s[25]++;state.phase=state_1.GamePhase.FINISHED;cov_1bqqkird0l().s[26]++;state.winner=state_1.GameWinner.NONE;cov_1bqqkird0l().s[27]++;return state;}else{cov_1bqqkird0l().b[5][1]++;}// Let's decide who wins.
const opponent=(cov_1bqqkird0l().s[28]++,state_utils_1.StateUtils.getOpponent(state,culprit));const culpritPrizeLeft=(cov_1bqqkird0l().s[29]++,culprit.getPrizeLeft());const opponentPrizeLeft=(cov_1bqqkird0l().s[30]++,opponent.getPrizeLeft());// It was first turn, no winner
cov_1bqqkird0l().s[31]++;if((cov_1bqqkird0l().b[8][0]++,state.turn<=2)&&(cov_1bqqkird0l().b[8][1]++,culpritPrizeLeft===opponentPrizeLeft)){cov_1bqqkird0l().b[7][0]++;cov_1bqqkird0l().s[32]++;state=check_effect_1.endGame(store,state,state_1.GameWinner.NONE);cov_1bqqkird0l().s[33]++;return state;}else{cov_1bqqkird0l().b[7][1]++;}// Opponent has same or less prizes, he wins
cov_1bqqkird0l().s[34]++;if(opponentPrizeLeft<=culpritPrizeLeft){cov_1bqqkird0l().b[9][0]++;const winner=(cov_1bqqkird0l().s[35]++,opponent===state.players[0]?(cov_1bqqkird0l().b[10][0]++,state_1.GameWinner.PLAYER_1):(cov_1bqqkird0l().b[10][1]++,state_1.GameWinner.PLAYER_2));cov_1bqqkird0l().s[36]++;state=check_effect_1.endGame(store,state,winner);cov_1bqqkird0l().s[37]++;return state;}else{cov_1bqqkird0l().b[9][1]++;}// Otherwise it's a draw
cov_1bqqkird0l().s[38]++;state=check_effect_1.endGame(store,state,state_1.GameWinner.DRAW);}else{cov_1bqqkird0l().b[0][1]++;}cov_1bqqkird0l().s[39]++;return state;}cov_1bqqkird0l().s[40]++;exports.abortGameReducer=abortGameReducer;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2pvZW15ZXJzY291Z2gvRG9jdW1lbnRzL0dpdEh1Yi9wdGNnLWVwc2QvcHRjZy1zZXJ2ZXIvc3JjL2dhbWUvc3RvcmUvcmVkdWNlcnMvYWJvcnQtZ2FtZS1yZWR1Y2VyLnRzIiwic291cmNlcyI6WyIvVXNlcnMvam9lbXllcnNjb3VnaC9Eb2N1bWVudHMvR2l0SHViL3B0Y2ctZXBzZC9wdGNnLXNlcnZlci9zcmMvZ2FtZS9zdG9yZS9yZWR1Y2Vycy9hYm9ydC1nYW1lLXJlZHVjZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsMENBQThEO0FBQzlELGlEQUE2QztBQUM3QyxxREFBMEQ7QUFFMUQsb0VBQStFO0FBQy9FLGtFQUEwRDtBQUMxRCxnREFBMEM7QUFHMUMsU0FBZ0IsZ0JBQWdCLENBQUMsS0FBZ0IsRUFBRSxLQUFZLEVBQUUsTUFBYztJQUU3RSxJQUFJLEtBQUssQ0FBQyxLQUFLLEtBQUssaUJBQVMsQ0FBQyxRQUFRLElBQUksTUFBTSxZQUFZLG1DQUFlLEVBQUU7UUFFM0UsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNuRSxJQUFJLE9BQU8sS0FBSyxTQUFTLEVBQUU7WUFDekIsTUFBTSxJQUFJLHNCQUFTLENBQUMsMEJBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQztTQUNqRDtRQUVELDJFQUEyRTtRQUMzRSxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUM3QixJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssU0FBUyxFQUFFO2dCQUMvQixNQUFNLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQzthQUN0QjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsK0JBQStCO1FBQy9CLFFBQVEsTUFBTSxDQUFDLE1BQU0sRUFBRTtZQUNyQixLQUFLLG1DQUFlLENBQUMsWUFBWTtnQkFDL0IsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsc0JBQU8sQ0FBQyxnQkFBZ0IsRUFBRSxFQUFFLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztnQkFDbkUsTUFBTTtZQUNSLEtBQUssbUNBQWUsQ0FBQyxhQUFhO2dCQUNoQyxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxzQkFBTyxDQUFDLHFCQUFxQixFQUFFLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO2dCQUN4RSxNQUFNO1lBQ1IsS0FBSyxtQ0FBZSxDQUFDLFlBQVk7Z0JBQy9CLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLHNCQUFPLENBQUMsd0JBQXdCLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7Z0JBQzNFLE1BQU07U0FDVDtRQUVELGtDQUFrQztRQUNsQyxJQUFJLEtBQUssQ0FBQyxLQUFLLEtBQUssaUJBQVMsQ0FBQyxtQkFBbUIsSUFBSSxLQUFLLENBQUMsS0FBSyxLQUFLLGlCQUFTLENBQUMsS0FBSyxFQUFFO1lBQ3BGLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLHNCQUFPLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztZQUMzRCxLQUFLLENBQUMsS0FBSyxHQUFHLGlCQUFTLENBQUMsUUFBUSxDQUFDO1lBQ2pDLEtBQUssQ0FBQyxNQUFNLEdBQUcsa0JBQVUsQ0FBQyxJQUFJLENBQUM7WUFDL0IsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUVELHlCQUF5QjtRQUN6QixNQUFNLFFBQVEsR0FBRyx3QkFBVSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDeEQsTUFBTSxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDaEQsTUFBTSxpQkFBaUIsR0FBRyxRQUFRLENBQUMsWUFBWSxFQUFFLENBQUM7UUFFbEQsK0JBQStCO1FBQy9CLElBQUksS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksZ0JBQWdCLEtBQUssaUJBQWlCLEVBQUU7WUFDN0QsS0FBSyxHQUFHLHNCQUFPLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxrQkFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQy9DLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFFRCw0Q0FBNEM7UUFDNUMsSUFBSSxpQkFBaUIsSUFBSSxnQkFBZ0IsRUFBRTtZQUN6QyxNQUFNLE1BQU0sR0FBRyxRQUFRLEtBQUssS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQzFDLENBQUMsQ0FBQyxrQkFBVSxDQUFDLFFBQVE7Z0JBQ3JCLENBQUMsQ0FBQyxrQkFBVSxDQUFDLFFBQVEsQ0FBQztZQUN4QixLQUFLLEdBQUcsc0JBQU8sQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3RDLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFFRCx3QkFBd0I7UUFDeEIsS0FBSyxHQUFHLHNCQUFPLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxrQkFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQ2hEO0lBRUQsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBOURELDRDQThEQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFjdGlvbiB9IGZyb20gJy4uL2FjdGlvbnMvYWN0aW9uJztcbmltcG9ydCB7IFN0YXRlLCBHYW1lUGhhc2UsIEdhbWVXaW5uZXIgfSBmcm9tICcuLi9zdGF0ZS9zdGF0ZSc7XG5pbXBvcnQgeyBHYW1lRXJyb3IgfSBmcm9tICcuLi8uLi9nYW1lLWVycm9yJztcbmltcG9ydCB7IEdhbWVNZXNzYWdlLCBHYW1lTG9nIH0gZnJvbSAnLi4vLi4vZ2FtZS1tZXNzYWdlJztcbmltcG9ydCB7IFN0b3JlTGlrZSB9IGZyb20gJy4uL3N0b3JlLWxpa2UnO1xuaW1wb3J0IHsgQWJvcnRHYW1lQWN0aW9uLCBBYm9ydEdhbWVSZWFzb259IGZyb20gJy4uL2FjdGlvbnMvYWJvcnQtZ2FtZS1hY3Rpb24nO1xuaW1wb3J0IHsgZW5kR2FtZSB9IGZyb20gJy4uL2VmZmVjdC1yZWR1Y2Vycy9jaGVjay1lZmZlY3QnO1xuaW1wb3J0IHtTdGF0ZVV0aWxzfSBmcm9tICcuLi9zdGF0ZS11dGlscyc7XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGFib3J0R2FtZVJlZHVjZXIoc3RvcmU6IFN0b3JlTGlrZSwgc3RhdGU6IFN0YXRlLCBhY3Rpb246IEFjdGlvbik6IFN0YXRlIHtcblxuICBpZiAoc3RhdGUucGhhc2UgIT09IEdhbWVQaGFzZS5GSU5JU0hFRCAmJiBhY3Rpb24gaW5zdGFuY2VvZiBBYm9ydEdhbWVBY3Rpb24pIHtcblxuICAgIGNvbnN0IGN1bHByaXQgPSBzdGF0ZS5wbGF5ZXJzLmZpbmQocCA9PiBwLmlkID09PSBhY3Rpb24uY3VscHJpdElkKTtcbiAgICBpZiAoY3VscHJpdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgR2FtZUVycm9yKEdhbWVNZXNzYWdlLklMTEVHQUxfQUNUSU9OKTtcbiAgICB9XG5cbiAgICAvLyBNYXJrIGFsbCBwcm9tcHRzIGFzIHJlc29sdmVkLCBzbyB0aGV5IHdvbid0IG1lc3Mgd2l0aCBvdXIgc3RhdGUgYW55bW9yZS5cbiAgICBzdGF0ZS5wcm9tcHRzLmZvckVhY2gocHJvbXB0ID0+IHtcbiAgICAgIGlmIChwcm9tcHQucmVzdWx0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcHJvbXB0LnJlc3VsdCA9IG51bGw7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBFeHBsYWluIHdoeSBnYW1lIHdhcyBhYm9ydGVkXG4gICAgc3dpdGNoIChhY3Rpb24ucmVhc29uKSB7XG4gICAgICBjYXNlIEFib3J0R2FtZVJlYXNvbi5USU1FX0VMQVBTRUQ6XG4gICAgICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfVElNRV9FTEFQU0VELCB7IG5hbWU6IGN1bHByaXQubmFtZSB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEFib3J0R2FtZVJlYXNvbi5JTExFR0FMX01PVkVTOlxuICAgICAgICBzdG9yZS5sb2coc3RhdGUsIEdhbWVMb2cuTE9HX0JBTk5FRF9CWV9BUkJJVEVSLCB7IG5hbWU6IGN1bHByaXQubmFtZSB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEFib3J0R2FtZVJlYXNvbi5ESVNDT05ORUNURUQ6XG4gICAgICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfUExBWUVSX0xFRlRfVEhFX0dBTUUsIHsgbmFtZTogY3VscHJpdC5uYW1lIH0pO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvLyBHYW1lIGhhcyBub3Qgc3RhcnRlZCwgbm8gd2lubmVyXG4gICAgaWYgKHN0YXRlLnBoYXNlID09PSBHYW1lUGhhc2UuV0FJVElOR19GT1JfUExBWUVSUyB8fCBzdGF0ZS5waGFzZSA9PT0gR2FtZVBoYXNlLlNFVFVQKSB7XG4gICAgICBzdG9yZS5sb2coc3RhdGUsIEdhbWVMb2cuTE9HX0dBTUVfRklOSVNIRURfQkVGT1JFX1NUQVJURUQpO1xuICAgICAgc3RhdGUucGhhc2UgPSBHYW1lUGhhc2UuRklOSVNIRUQ7XG4gICAgICBzdGF0ZS53aW5uZXIgPSBHYW1lV2lubmVyLk5PTkU7XG4gICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxuXG4gICAgLy8gTGV0J3MgZGVjaWRlIHdobyB3aW5zLlxuICAgIGNvbnN0IG9wcG9uZW50ID0gU3RhdGVVdGlscy5nZXRPcHBvbmVudChzdGF0ZSwgY3VscHJpdCk7XG4gICAgY29uc3QgY3VscHJpdFByaXplTGVmdCA9IGN1bHByaXQuZ2V0UHJpemVMZWZ0KCk7XG4gICAgY29uc3Qgb3Bwb25lbnRQcml6ZUxlZnQgPSBvcHBvbmVudC5nZXRQcml6ZUxlZnQoKTtcblxuICAgIC8vIEl0IHdhcyBmaXJzdCB0dXJuLCBubyB3aW5uZXJcbiAgICBpZiAoc3RhdGUudHVybiA8PSAyICYmIGN1bHByaXRQcml6ZUxlZnQgPT09IG9wcG9uZW50UHJpemVMZWZ0KSB7XG4gICAgICBzdGF0ZSA9IGVuZEdhbWUoc3RvcmUsIHN0YXRlLCBHYW1lV2lubmVyLk5PTkUpO1xuICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cblxuICAgIC8vIE9wcG9uZW50IGhhcyBzYW1lIG9yIGxlc3MgcHJpemVzLCBoZSB3aW5zXG4gICAgaWYgKG9wcG9uZW50UHJpemVMZWZ0IDw9IGN1bHByaXRQcml6ZUxlZnQpIHtcbiAgICAgIGNvbnN0IHdpbm5lciA9IG9wcG9uZW50ID09PSBzdGF0ZS5wbGF5ZXJzWzBdXG4gICAgICAgID8gR2FtZVdpbm5lci5QTEFZRVJfMVxuICAgICAgICA6IEdhbWVXaW5uZXIuUExBWUVSXzI7XG4gICAgICBzdGF0ZSA9IGVuZEdhbWUoc3RvcmUsIHN0YXRlLCB3aW5uZXIpO1xuICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cblxuICAgIC8vIE90aGVyd2lzZSBpdCdzIGEgZHJhd1xuICAgIHN0YXRlID0gZW5kR2FtZShzdG9yZSwgc3RhdGUsIEdhbWVXaW5uZXIuRFJBVyk7XG4gIH1cblxuICByZXR1cm4gc3RhdGU7XG59XG4iXX0=
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qb2VteWVyc2NvdWdoL0RvY3VtZW50cy9HaXRIdWIvcHRjZy1lcHNkL3B0Y2ctc2VydmVyL3NyYy9nYW1lL3N0b3JlL3JlZHVjZXJzL2Fib3J0LWdhbWUtcmVkdWNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiKzBWQW1CSTtvT0FsQkosS0FBQSxDQUFBLE9BQUEsMEJBQUEsT0FBQSxDQUFBLGdCQUFBLENBQUEsQ0FBQSxDQUNBLEtBQUEsQ0FBQSxZQUFBLDBCQUFBLE9BQUEsQ0FBQSxrQkFBQSxDQUFBLENBQUEsQ0FDQSxLQUFBLENBQUEsY0FBQSwwQkFBQSxPQUFBLENBQUEsb0JBQUEsQ0FBQSxDQUFBLENBRUEsS0FBQSxDQUFBLG1CQUFBLDBCQUFBLE9BQUEsQ0FBQSw4QkFBQSxDQUFBLENBQUEsQ0FDQSxLQUFBLENBQUEsY0FBQSwwQkFBQSxPQUFBLENBQUEsaUNBQUEsQ0FBQSxDQUFBLENBQ0EsS0FBQSxDQUFBLGFBQUEsMEJBQUEsT0FBQSxDQUFBLGdCQUFBLENBQUEsQ0FBQSxDQUdBLFFBQWdCLENBQUEsZ0JBQWhCLENBQWlDLEtBQWpDLENBQW1ELEtBQW5ELENBQWlFLE1BQWpFLENBQStFLGlEQUU3RSxHQUFJLDRCQUFBLEtBQUssQ0FBQyxLQUFOLEdBQWdCLE9BQUEsQ0FBQSxTQUFBLENBQVUsUUFBMUIsK0JBQXNDLE1BQU0sV0FBWSxDQUFBLG1CQUFBLENBQUEsZUFBeEQsQ0FBSixDQUE2RSw0QkFFM0UsS0FBTSxDQUFBLE9BQU8sMEJBQUcsS0FBSyxDQUFDLE9BQU4sQ0FBYyxJQUFkLENBQW1CLENBQUMsRUFBSSx3REFBQSxDQUFBLENBQUMsQ0FBQyxFQUFGLEdBQVMsTUFBTSxDQUFDLFNBQWhCLENBQXlCLENBQWpELENBQUgsQ0FBYixDQUYyRSx5QkFHM0UsR0FBSSxPQUFPLEdBQUssU0FBaEIsQ0FBMkIscURBQ3pCLEtBQU0sSUFBSSxDQUFBLFlBQUEsQ0FBQSxTQUFKLENBQWMsY0FBQSxDQUFBLFdBQUEsQ0FBWSxj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QUF2RDJFLHlCQXdEM0UsS0FBSyxDQUFHLGNBQUEsQ0FBQSxPQUFBLENBQVEsS0FBUixDQUFlLEtBQWYsQ0FBc0IsT0FBQSxDQUFBLFVBQUEsQ0FBVyxJQUFqQyxDQUFSLENBQ0QsQ0F6REQsaUNBRjZFLHlCQTZEN0UsTUFBTyxDQUFBLEtBQVAsQ0FDRCxDLHlCQTlERCxPQUFBLENBQUEsZ0JBQUEsQ0FBQSxnQkFBQSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSAnLi4vYWN0aW9ucy9hY3Rpb24nO1xuaW1wb3J0IHsgU3RhdGUsIEdhbWVQaGFzZSwgR2FtZVdpbm5lciB9IGZyb20gJy4uL3N0YXRlL3N0YXRlJztcbmltcG9ydCB7IEdhbWVFcnJvciB9IGZyb20gJy4uLy4uL2dhbWUtZXJyb3InO1xuaW1wb3J0IHsgR2FtZU1lc3NhZ2UsIEdhbWVMb2cgfSBmcm9tICcuLi8uLi9nYW1lLW1lc3NhZ2UnO1xuaW1wb3J0IHsgU3RvcmVMaWtlIH0gZnJvbSAnLi4vc3RvcmUtbGlrZSc7XG5pbXBvcnQgeyBBYm9ydEdhbWVBY3Rpb24sIEFib3J0R2FtZVJlYXNvbn0gZnJvbSAnLi4vYWN0aW9ucy9hYm9ydC1nYW1lLWFjdGlvbic7XG5pbXBvcnQgeyBlbmRHYW1lIH0gZnJvbSAnLi4vZWZmZWN0LXJlZHVjZXJzL2NoZWNrLWVmZmVjdCc7XG5pbXBvcnQge1N0YXRlVXRpbHN9IGZyb20gJy4uL3N0YXRlLXV0aWxzJztcblxuXG5leHBvcnQgZnVuY3Rpb24gYWJvcnRHYW1lUmVkdWNlcihzdG9yZTogU3RvcmVMaWtlLCBzdGF0ZTogU3RhdGUsIGFjdGlvbjogQWN0aW9uKTogU3RhdGUge1xuXG4gIGlmIChzdGF0ZS5waGFzZSAhPT0gR2FtZVBoYXNlLkZJTklTSEVEICYmIGFjdGlvbiBpbnN0YW5jZW9mIEFib3J0R2FtZUFjdGlvbikge1xuXG4gICAgY29uc3QgY3VscHJpdCA9IHN0YXRlLnBsYXllcnMuZmluZChwID0+IHAuaWQgPT09IGFjdGlvbi5jdWxwcml0SWQpO1xuICAgIGlmIChjdWxwcml0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBHYW1lRXJyb3IoR2FtZU1lc3NhZ2UuSUxMRUdBTF9BQ1RJT04pO1xuICAgIH1cblxuICAgIC8vIE1hcmsgYWxsIHByb21wdHMgYXMgcmVzb2x2ZWQsIHNvIHRoZXkgd29uJ3QgbWVzcyB3aXRoIG91ciBzdGF0ZSBhbnltb3JlLlxuICAgIHN0YXRlLnByb21wdHMuZm9yRWFjaChwcm9tcHQgPT4ge1xuICAgICAgaWYgKHByb21wdC5yZXN1bHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBwcm9tcHQucmVzdWx0ID0gbnVsbDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEV4cGxhaW4gd2h5IGdhbWUgd2FzIGFib3J0ZWRcbiAgICBzd2l0Y2ggKGFjdGlvbi5yZWFzb24pIHtcbiAgICAgIGNhc2UgQWJvcnRHYW1lUmVhc29uLlRJTUVfRUxBUFNFRDpcbiAgICAgICAgc3RvcmUubG9nKHN0YXRlLCBHYW1lTG9nLkxPR19USU1FX0VMQVBTRUQsIHsgbmFtZTogY3VscHJpdC5uYW1lIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQWJvcnRHYW1lUmVhc29uLklMTEVHQUxfTU9WRVM6XG4gICAgICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfQkFOTkVEX0JZX0FSQklURVIsIHsgbmFtZTogY3VscHJpdC5uYW1lIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQWJvcnRHYW1lUmVhc29uLkRJU0NPTk5FQ1RFRDpcbiAgICAgICAgc3RvcmUubG9nKHN0YXRlLCBHYW1lTG9nLkxPR19QTEFZRVJfTEVGVF9USEVfR0FNRSwgeyBuYW1lOiBjdWxwcml0Lm5hbWUgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vIEdhbWUgaGFzIG5vdCBzdGFydGVkLCBubyB3aW5uZXJcbiAgICBpZiAoc3RhdGUucGhhc2UgPT09IEdhbWVQaGFzZS5XQUlUSU5HX0ZPUl9QTEFZRVJTIHx8IHN0YXRlLnBoYXNlID09PSBHYW1lUGhhc2UuU0VUVVApIHtcbiAgICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfR0FNRV9GSU5JU0hFRF9CRUZPUkVfU1RBUlRFRCk7XG4gICAgICBzdGF0ZS5waGFzZSA9IEdhbWVQaGFzZS5GSU5JU0hFRDtcbiAgICAgIHN0YXRlLndpbm5lciA9IEdhbWVXaW5uZXIuTk9ORTtcbiAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9XG5cbiAgICAvLyBMZXQncyBkZWNpZGUgd2hvIHdpbnMuXG4gICAgY29uc3Qgb3Bwb25lbnQgPSBTdGF0ZVV0aWxzLmdldE9wcG9uZW50KHN0YXRlLCBjdWxwcml0KTtcbiAgICBjb25zdCBjdWxwcml0UHJpemVMZWZ0ID0gY3VscHJpdC5nZXRQcml6ZUxlZnQoKTtcbiAgICBjb25zdCBvcHBvbmVudFByaXplTGVmdCA9IG9wcG9uZW50LmdldFByaXplTGVmdCgpO1xuXG4gICAgLy8gSXQgd2FzIGZpcnN0IHR1cm4sIG5vIHdpbm5lclxuICAgIGlmIChzdGF0ZS50dXJuIDw9IDIgJiYgY3VscHJpdFByaXplTGVmdCA9PT0gb3Bwb25lbnRQcml6ZUxlZnQpIHtcbiAgICAgIHN0YXRlID0gZW5kR2FtZShzdG9yZSwgc3RhdGUsIEdhbWVXaW5uZXIuTk9ORSk7XG4gICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxuXG4gICAgLy8gT3Bwb25lbnQgaGFzIHNhbWUgb3IgbGVzcyBwcml6ZXMsIGhlIHdpbnNcbiAgICBpZiAob3Bwb25lbnRQcml6ZUxlZnQgPD0gY3VscHJpdFByaXplTGVmdCkge1xuICAgICAgY29uc3Qgd2lubmVyID0gb3Bwb25lbnQgPT09IHN0YXRlLnBsYXllcnNbMF1cbiAgICAgICAgPyBHYW1lV2lubmVyLlBMQVlFUl8xXG4gICAgICAgIDogR2FtZVdpbm5lci5QTEFZRVJfMjtcbiAgICAgIHN0YXRlID0gZW5kR2FtZShzdG9yZSwgc3RhdGUsIHdpbm5lcik7XG4gICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxuXG4gICAgLy8gT3RoZXJ3aXNlIGl0J3MgYSBkcmF3XG4gICAgc3RhdGUgPSBlbmRHYW1lKHN0b3JlLCBzdGF0ZSwgR2FtZVdpbm5lci5EUkFXKTtcbiAgfVxuXG4gIHJldHVybiBzdGF0ZTtcbn1cbiJdfQ==