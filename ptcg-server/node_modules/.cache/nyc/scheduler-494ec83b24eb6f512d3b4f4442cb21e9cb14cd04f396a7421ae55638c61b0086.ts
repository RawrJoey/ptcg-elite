"use strict";function cov_2ktoewn3r6(){var path="/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/utils/scheduler.ts";var hash="5de4b61f83f3bab459636b883beed1c6cbc826eb";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/utils/scheduler.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:0},end:{line:3,column:27}},"2":{start:{line:4,column:17},end:{line:4,column:37}},"3":{start:{line:7,column:8},end:{line:7,column:23}},"4":{start:{line:10,column:8},end:{line:10,column:34}},"5":{start:{line:14,column:8},end:{line:16,column:9}},"6":{start:{line:15,column:12},end:{line:15,column:19}},"7":{start:{line:17,column:8},end:{line:17,column:56}},"8":{start:{line:18,column:8},end:{line:20,column:9}},"9":{start:{line:19,column:12},end:{line:19,column:19}},"10":{start:{line:21,column:8},end:{line:24,column:9}},"11":{start:{line:22,column:12},end:{line:22,column:33}},"12":{start:{line:23,column:12},end:{line:23,column:19}},"13":{start:{line:26,column:25},end:{line:26,column:39}},"14":{start:{line:27,column:29},end:{line:27,column:71}},"15":{start:{line:28,column:8},end:{line:31,column:25}},"16":{start:{line:29,column:12},end:{line:29,column:40}},"17":{start:{line:30,column:12},end:{line:30,column:33}},"18":{start:{line:34,column:8},end:{line:36,column:9}},"19":{start:{line:35,column:12},end:{line:35,column:19}},"20":{start:{line:37,column:8},end:{line:45,column:51}},"21":{start:{line:38,column:12},end:{line:44,column:15}},"22":{start:{line:39,column:16},end:{line:39,column:31}},"23":{start:{line:40,column:16},end:{line:43,column:17}},"24":{start:{line:41,column:20},end:{line:41,column:34}},"25":{start:{line:42,column:20},end:{line:42,column:35}},"26":{start:{line:48,column:22},end:{line:48,column:75}},"27":{start:{line:48,column:49},end:{line:48,column:74}},"28":{start:{line:49,column:8},end:{line:61,column:9}},"29":{start:{line:50,column:12},end:{line:50,column:39}},"30":{start:{line:51,column:12},end:{line:60,column:13}},"31":{start:{line:52,column:16},end:{line:55,column:17}},"32":{start:{line:53,column:20},end:{line:53,column:50}},"33":{start:{line:54,column:20},end:{line:54,column:48}},"34":{start:{line:56,column:16},end:{line:59,column:17}},"35":{start:{line:57,column:20},end:{line:57,column:52}},"36":{start:{line:58,column:20},end:{line:58,column:49}},"37":{start:{line:64,column:0},end:{line:64,column:30}},"38":{start:{line:65,column:0},end:{line:65,column:37}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:4},end:{line:6,column:5}},loc:{start:{line:6,column:18},end:{line:8,column:5}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:9,column:4},end:{line:9,column:5}},loc:{start:{line:9,column:25},end:{line:11,column:5}},line:9},"2":{name:"(anonymous_2)",decl:{start:{line:12,column:4},end:{line:12,column:5}},loc:{start:{line:12,column:31},end:{line:32,column:5}},line:12},"3":{name:"(anonymous_3)",decl:{start:{line:28,column:37},end:{line:28,column:38}},loc:{start:{line:28,column:43},end:{line:31,column:9}},line:28},"4":{name:"(anonymous_4)",decl:{start:{line:33,column:4},end:{line:33,column:5}},loc:{start:{line:33,column:20},end:{line:46,column:5}},line:33},"5":{name:"(anonymous_5)",decl:{start:{line:37,column:39},end:{line:37,column:40}},loc:{start:{line:37,column:45},end:{line:45,column:9}},line:37},"6":{name:"(anonymous_6)",decl:{start:{line:38,column:30},end:{line:38,column:31}},loc:{start:{line:38,column:37},end:{line:44,column:13}},line:38},"7":{name:"(anonymous_7)",decl:{start:{line:47,column:4},end:{line:47,column:5}},loc:{start:{line:47,column:19},end:{line:62,column:5}},line:47},"8":{name:"(anonymous_8)",decl:{start:{line:48,column:42},end:{line:48,column:43}},loc:{start:{line:48,column:49},end:{line:48,column:74}},line:48}},branchMap:{"0":{loc:{start:{line:12,column:18},end:{line:12,column:29}},type:"default-arg",locations:[{start:{line:12,column:28},end:{line:12,column:29}}],line:12},"1":{loc:{start:{line:14,column:8},end:{line:16,column:9}},type:"if",locations:[{start:{line:14,column:8},end:{line:16,column:9}},{start:{line:14,column:8},end:{line:16,column:9}}],line:14},"2":{loc:{start:{line:18,column:8},end:{line:20,column:9}},type:"if",locations:[{start:{line:18,column:8},end:{line:20,column:9}},{start:{line:18,column:8},end:{line:20,column:9}}],line:18},"3":{loc:{start:{line:18,column:12},end:{line:18,column:75}},type:"binary-expr",locations:[{start:{line:18,column:12},end:{line:18,column:42}},{start:{line:18,column:46},end:{line:18,column:75}}],line:18},"4":{loc:{start:{line:21,column:8},end:{line:24,column:9}},type:"if",locations:[{start:{line:21,column:8},end:{line:24,column:9}},{start:{line:21,column:8},end:{line:24,column:9}}],line:21},"5":{loc:{start:{line:34,column:8},end:{line:36,column:9}},type:"if",locations:[{start:{line:34,column:8},end:{line:36,column:9}},{start:{line:34,column:8},end:{line:36,column:9}}],line:34},"6":{loc:{start:{line:34,column:12},end:{line:34,column:68}},type:"binary-expr",locations:[{start:{line:34,column:12},end:{line:34,column:34}},{start:{line:34,column:38},end:{line:34,column:68}}],line:34},"7":{loc:{start:{line:40,column:16},end:{line:43,column:17}},type:"if",locations:[{start:{line:40,column:16},end:{line:43,column:17}},{start:{line:40,column:16},end:{line:43,column:17}}],line:40},"8":{loc:{start:{line:49,column:8},end:{line:61,column:9}},type:"if",locations:[{start:{line:49,column:8},end:{line:61,column:9}},{start:{line:49,column:8},end:{line:61,column:9}}],line:49},"9":{loc:{start:{line:51,column:12},end:{line:60,column:13}},type:"if",locations:[{start:{line:51,column:12},end:{line:60,column:13}},{start:{line:51,column:12},end:{line:60,column:13}}],line:51},"10":{loc:{start:{line:52,column:16},end:{line:55,column:17}},type:"if",locations:[{start:{line:52,column:16},end:{line:55,column:17}},{start:{line:52,column:16},end:{line:55,column:17}}],line:52},"11":{loc:{start:{line:56,column:16},end:{line:59,column:17}},type:"if",locations:[{start:{line:56,column:16},end:{line:59,column:17}},{start:{line:56,column:16},end:{line:59,column:17}}],line:56}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},b:{"0":[0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},inputSourceMap:{version:3,file:"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/utils/scheduler.ts",sources:["/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/utils/scheduler.ts"],names:[],mappings:";;;AAAA,sCAAmC;AAEnC,MAAa,SAAS;IAAtB;QAGU,SAAI,GAA6D,EAAE,CAAC;IAkE9E,CAAC;IA9DQ,MAAM,CAAC,WAAW;QACvB,OAAO,SAAS,CAAC,QAAQ,CAAC;IAC5B,CAAC;IAEM,GAAG,CAAC,QAAkB,EAAE,UAAkB,CAAC;QAChD,8DAA8D;QAC9D,IAAI,OAAO,KAAK,CAAC,EAAE;YACjB,OAAO;SACR;QAED,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC;QAEhD,IAAI,IAAI,CAAC,WAAW,KAAK,SAAS,IAAI,IAAI,CAAC,UAAU,KAAK,SAAS,EAAE;YACnE,OAAO;SACR;QAED,IAAI,CAAC,eAAM,CAAC,IAAI,CAAC,sBAAsB,EAAE;YACvC,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,OAAO;SACR;QAED,8CAA8C;QAC9C,MAAM,QAAQ,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;QAChC,MAAM,YAAY,GAAG,QAAQ,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,GAAG,QAAQ,CAAC;QAChE,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,GAAG,EAAE;YAChC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;YAC5B,IAAI,CAAC,aAAa,EAAE,CAAC;QACvB,CAAC,EAAE,YAAY,CAAC,CAAC;IACnB,CAAC;IAEO,aAAa;QACnB,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,IAAI,IAAI,CAAC,WAAW,KAAK,SAAS,EAAE;YAC5D,OAAO;SACR;QACD,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC,GAAG,EAAE;YAClC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;gBACtB,GAAG,CAAC,KAAK,IAAI,CAAC,CAAC;gBACf,IAAI,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC,OAAO,EAAE;oBAC5B,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC;oBACd,GAAG,CAAC,QAAQ,EAAE,CAAC;iBAChB;YACH,CAAC,CAAC,CAAC;QACL,CAAC,EAAE,eAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;IACpC,CAAC;IAEM,IAAI,CAAC,QAAkB;QAC5B,MAAM,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC;QACpE,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE;YAChB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YAC3B,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE;gBAC1B,IAAI,IAAI,CAAC,UAAU,KAAK,SAAS,EAAE;oBACjC,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;oBAC9B,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;iBAC7B;gBACD,IAAI,IAAI,CAAC,WAAW,KAAK,SAAS,EAAE;oBAClC,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;oBAChC,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;iBAC9B;aACF;SACF;IACH,CAAC;;AAnEH,8BAqEC;AAnEgB,kBAAQ,GAAc,IAAI,SAAS,EAAE,CAAC",sourcesContent:["import { config } from '../config';\n\nexport class Scheduler {\n\n  private static instance: Scheduler = new Scheduler();\n  private jobs: { callback: Function, counter: number, value: number }[] = [];\n  private timeoutRef: NodeJS.Timeout | undefined;\n  private intervalRef: NodeJS.Timeout | undefined;\n\n  public static getInstance(): Scheduler {\n    return Scheduler.instance;\n  }\n\n  public run(callback: Function, counter: number = 1): void {\n    // Job disabled in the config file, do not add it to scheduler\n    if (counter === 0) {\n      return;\n    }\n\n    this.jobs.push({ counter, callback, value: 0 });\n\n    if (this.intervalRef !== undefined || this.timeoutRef !== undefined) {\n      return;\n    }\n\n    if (!config.core.schedulerStartNextHour) {\n      this.startInterval();\n      return;\n    }\n\n    // wait with the initialization till next hour\n    const msInHour = 60 * 60 * 1000;\n    const msToNextHour = msInHour - new Date().getTime() % msInHour;\n    this.timeoutRef = setTimeout(() => {\n      this.timeoutRef = undefined;\n      this.startInterval();\n    }, msToNextHour);\n  }\n\n  private startInterval(): void {\n    if (this.jobs.length === 0 || this.intervalRef !== undefined) {\n      return;\n    }\n    this.intervalRef = setInterval(() => {\n      this.jobs.forEach(job => {\n        job.value += 1;\n        if (job.value >= job.counter) {\n          job.value = 0;\n          job.callback();\n        }\n      });\n    }, config.core.schedulerInterval);\n  }\n\n  public stop(callback: Function): void {\n    const index = this.jobs.findIndex(job => job.callback === callback);\n    if (index !== -1) {\n      this.jobs.splice(index, 1);\n      if (this.jobs.length === 0) {\n        if (this.timeoutRef !== undefined) {\n          clearTimeout(this.timeoutRef);\n          this.timeoutRef = undefined;\n        }\n        if (this.intervalRef !== undefined) {\n          clearInterval(this.intervalRef);\n          this.intervalRef = undefined;\n        }\n      }\n    }\n  }\n\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"5de4b61f83f3bab459636b883beed1c6cbc826eb"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2ktoewn3r6=function(){return actualCoverage;};}return actualCoverage;}cov_2ktoewn3r6();cov_2ktoewn3r6().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_2ktoewn3r6().s[1]++;exports.Scheduler=void 0;const config_1=(cov_2ktoewn3r6().s[2]++,require("../config"));class Scheduler{constructor(){cov_2ktoewn3r6().f[0]++;cov_2ktoewn3r6().s[3]++;this.jobs=[];}static getInstance(){cov_2ktoewn3r6().f[1]++;cov_2ktoewn3r6().s[4]++;return Scheduler.instance;}run(callback,counter=(cov_2ktoewn3r6().b[0][0]++,1)){cov_2ktoewn3r6().f[2]++;cov_2ktoewn3r6().s[5]++;// Job disabled in the config file, do not add it to scheduler
if(counter===0){cov_2ktoewn3r6().b[1][0]++;cov_2ktoewn3r6().s[6]++;return;}else{cov_2ktoewn3r6().b[1][1]++;}cov_2ktoewn3r6().s[7]++;this.jobs.push({counter,callback,value:0});cov_2ktoewn3r6().s[8]++;if((cov_2ktoewn3r6().b[3][0]++,this.intervalRef!==undefined)||(cov_2ktoewn3r6().b[3][1]++,this.timeoutRef!==undefined)){cov_2ktoewn3r6().b[2][0]++;cov_2ktoewn3r6().s[9]++;return;}else{cov_2ktoewn3r6().b[2][1]++;}cov_2ktoewn3r6().s[10]++;if(!config_1.config.core.schedulerStartNextHour){cov_2ktoewn3r6().b[4][0]++;cov_2ktoewn3r6().s[11]++;this.startInterval();cov_2ktoewn3r6().s[12]++;return;}else{cov_2ktoewn3r6().b[4][1]++;}// wait with the initialization till next hour
const msInHour=(cov_2ktoewn3r6().s[13]++,60*60*1000);const msToNextHour=(cov_2ktoewn3r6().s[14]++,msInHour-new Date().getTime()%msInHour);cov_2ktoewn3r6().s[15]++;this.timeoutRef=setTimeout(()=>{cov_2ktoewn3r6().f[3]++;cov_2ktoewn3r6().s[16]++;this.timeoutRef=undefined;cov_2ktoewn3r6().s[17]++;this.startInterval();},msToNextHour);}startInterval(){cov_2ktoewn3r6().f[4]++;cov_2ktoewn3r6().s[18]++;if((cov_2ktoewn3r6().b[6][0]++,this.jobs.length===0)||(cov_2ktoewn3r6().b[6][1]++,this.intervalRef!==undefined)){cov_2ktoewn3r6().b[5][0]++;cov_2ktoewn3r6().s[19]++;return;}else{cov_2ktoewn3r6().b[5][1]++;}cov_2ktoewn3r6().s[20]++;this.intervalRef=setInterval(()=>{cov_2ktoewn3r6().f[5]++;cov_2ktoewn3r6().s[21]++;this.jobs.forEach(job=>{cov_2ktoewn3r6().f[6]++;cov_2ktoewn3r6().s[22]++;job.value+=1;cov_2ktoewn3r6().s[23]++;if(job.value>=job.counter){cov_2ktoewn3r6().b[7][0]++;cov_2ktoewn3r6().s[24]++;job.value=0;cov_2ktoewn3r6().s[25]++;job.callback();}else{cov_2ktoewn3r6().b[7][1]++;}});},config_1.config.core.schedulerInterval);}stop(callback){cov_2ktoewn3r6().f[7]++;const index=(cov_2ktoewn3r6().s[26]++,this.jobs.findIndex(job=>{cov_2ktoewn3r6().f[8]++;cov_2ktoewn3r6().s[27]++;return job.callback===callback;}));cov_2ktoewn3r6().s[28]++;if(index!==-1){cov_2ktoewn3r6().b[8][0]++;cov_2ktoewn3r6().s[29]++;this.jobs.splice(index,1);cov_2ktoewn3r6().s[30]++;if(this.jobs.length===0){cov_2ktoewn3r6().b[9][0]++;cov_2ktoewn3r6().s[31]++;if(this.timeoutRef!==undefined){cov_2ktoewn3r6().b[10][0]++;cov_2ktoewn3r6().s[32]++;clearTimeout(this.timeoutRef);cov_2ktoewn3r6().s[33]++;this.timeoutRef=undefined;}else{cov_2ktoewn3r6().b[10][1]++;}cov_2ktoewn3r6().s[34]++;if(this.intervalRef!==undefined){cov_2ktoewn3r6().b[11][0]++;cov_2ktoewn3r6().s[35]++;clearInterval(this.intervalRef);cov_2ktoewn3r6().s[36]++;this.intervalRef=undefined;}else{cov_2ktoewn3r6().b[11][1]++;}}else{cov_2ktoewn3r6().b[9][1]++;}}else{cov_2ktoewn3r6().b[8][1]++;}}}cov_2ktoewn3r6().s[37]++;exports.Scheduler=Scheduler;cov_2ktoewn3r6().s[38]++;Scheduler.instance=new Scheduler();//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2pvZW15ZXJzY291Z2gvRG9jdW1lbnRzL0dpdEh1Yi9wdGNnLWVwc2QvcHRjZy1zZXJ2ZXIvc3JjL3V0aWxzL3NjaGVkdWxlci50cyIsInNvdXJjZXMiOlsiL1VzZXJzL2pvZW15ZXJzY291Z2gvRG9jdW1lbnRzL0dpdEh1Yi9wdGNnLWVwc2QvcHRjZy1zZXJ2ZXIvc3JjL3V0aWxzL3NjaGVkdWxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxzQ0FBbUM7QUFFbkMsTUFBYSxTQUFTO0lBQXRCO1FBR1UsU0FBSSxHQUE2RCxFQUFFLENBQUM7SUFrRTlFLENBQUM7SUE5RFEsTUFBTSxDQUFDLFdBQVc7UUFDdkIsT0FBTyxTQUFTLENBQUMsUUFBUSxDQUFDO0lBQzVCLENBQUM7SUFFTSxHQUFHLENBQUMsUUFBa0IsRUFBRSxVQUFrQixDQUFDO1FBQ2hELDhEQUE4RDtRQUM5RCxJQUFJLE9BQU8sS0FBSyxDQUFDLEVBQUU7WUFDakIsT0FBTztTQUNSO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRWhELElBQUksSUFBSSxDQUFDLFdBQVcsS0FBSyxTQUFTLElBQUksSUFBSSxDQUFDLFVBQVUsS0FBSyxTQUFTLEVBQUU7WUFDbkUsT0FBTztTQUNSO1FBRUQsSUFBSSxDQUFDLGVBQU0sQ0FBQyxJQUFJLENBQUMsc0JBQXNCLEVBQUU7WUFDdkMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQ3JCLE9BQU87U0FDUjtRQUVELDhDQUE4QztRQUM5QyxNQUFNLFFBQVEsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQztRQUNoQyxNQUFNLFlBQVksR0FBRyxRQUFRLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxRQUFRLENBQUM7UUFDaEUsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2hDLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1lBQzVCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN2QixDQUFDLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDbkIsQ0FBQztJQUVPLGFBQWE7UUFDbkIsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLFdBQVcsS0FBSyxTQUFTLEVBQUU7WUFDNUQsT0FBTztTQUNSO1FBQ0QsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFO1lBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUN0QixHQUFHLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQztnQkFDZixJQUFJLEdBQUcsQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDLE9BQU8sRUFBRTtvQkFDNUIsR0FBRyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7b0JBQ2QsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDO2lCQUNoQjtZQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxFQUFFLGVBQU0sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRU0sSUFBSSxDQUFDLFFBQWtCO1FBQzVCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxRQUFRLENBQUMsQ0FBQztRQUNwRSxJQUFJLEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNoQixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDM0IsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQzFCLElBQUksSUFBSSxDQUFDLFVBQVUsS0FBSyxTQUFTLEVBQUU7b0JBQ2pDLFlBQVksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7b0JBQzlCLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO2lCQUM3QjtnQkFDRCxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssU0FBUyxFQUFFO29CQUNsQyxhQUFhLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO29CQUNoQyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztpQkFDOUI7YUFDRjtTQUNGO0lBQ0gsQ0FBQzs7QUFuRUgsOEJBcUVDO0FBbkVnQixrQkFBUSxHQUFjLElBQUksU0FBUyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb25maWcgfSBmcm9tICcuLi9jb25maWcnO1xuXG5leHBvcnQgY2xhc3MgU2NoZWR1bGVyIHtcblxuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogU2NoZWR1bGVyID0gbmV3IFNjaGVkdWxlcigpO1xuICBwcml2YXRlIGpvYnM6IHsgY2FsbGJhY2s6IEZ1bmN0aW9uLCBjb3VudGVyOiBudW1iZXIsIHZhbHVlOiBudW1iZXIgfVtdID0gW107XG4gIHByaXZhdGUgdGltZW91dFJlZjogTm9kZUpTLlRpbWVvdXQgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgaW50ZXJ2YWxSZWY6IE5vZGVKUy5UaW1lb3V0IHwgdW5kZWZpbmVkO1xuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogU2NoZWR1bGVyIHtcbiAgICByZXR1cm4gU2NoZWR1bGVyLmluc3RhbmNlO1xuICB9XG5cbiAgcHVibGljIHJ1bihjYWxsYmFjazogRnVuY3Rpb24sIGNvdW50ZXI6IG51bWJlciA9IDEpOiB2b2lkIHtcbiAgICAvLyBKb2IgZGlzYWJsZWQgaW4gdGhlIGNvbmZpZyBmaWxlLCBkbyBub3QgYWRkIGl0IHRvIHNjaGVkdWxlclxuICAgIGlmIChjb3VudGVyID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5qb2JzLnB1c2goeyBjb3VudGVyLCBjYWxsYmFjaywgdmFsdWU6IDAgfSk7XG5cbiAgICBpZiAodGhpcy5pbnRlcnZhbFJlZiAhPT0gdW5kZWZpbmVkIHx8IHRoaXMudGltZW91dFJlZiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFjb25maWcuY29yZS5zY2hlZHVsZXJTdGFydE5leHRIb3VyKSB7XG4gICAgICB0aGlzLnN0YXJ0SW50ZXJ2YWwoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyB3YWl0IHdpdGggdGhlIGluaXRpYWxpemF0aW9uIHRpbGwgbmV4dCBob3VyXG4gICAgY29uc3QgbXNJbkhvdXIgPSA2MCAqIDYwICogMTAwMDtcbiAgICBjb25zdCBtc1RvTmV4dEhvdXIgPSBtc0luSG91ciAtIG5ldyBEYXRlKCkuZ2V0VGltZSgpICUgbXNJbkhvdXI7XG4gICAgdGhpcy50aW1lb3V0UmVmID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLnRpbWVvdXRSZWYgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLnN0YXJ0SW50ZXJ2YWwoKTtcbiAgICB9LCBtc1RvTmV4dEhvdXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGFydEludGVydmFsKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmpvYnMubGVuZ3RoID09PSAwIHx8IHRoaXMuaW50ZXJ2YWxSZWYgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmludGVydmFsUmVmID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgdGhpcy5qb2JzLmZvckVhY2goam9iID0+IHtcbiAgICAgICAgam9iLnZhbHVlICs9IDE7XG4gICAgICAgIGlmIChqb2IudmFsdWUgPj0gam9iLmNvdW50ZXIpIHtcbiAgICAgICAgICBqb2IudmFsdWUgPSAwO1xuICAgICAgICAgIGpvYi5jYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LCBjb25maWcuY29yZS5zY2hlZHVsZXJJbnRlcnZhbCk7XG4gIH1cblxuICBwdWJsaWMgc3RvcChjYWxsYmFjazogRnVuY3Rpb24pOiB2b2lkIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuam9icy5maW5kSW5kZXgoam9iID0+IGpvYi5jYWxsYmFjayA9PT0gY2FsbGJhY2spO1xuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgIHRoaXMuam9icy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgaWYgKHRoaXMuam9icy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgaWYgKHRoaXMudGltZW91dFJlZiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dFJlZik7XG4gICAgICAgICAgdGhpcy50aW1lb3V0UmVmID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmludGVydmFsUmVmICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxSZWYpO1xuICAgICAgICAgIHRoaXMuaW50ZXJ2YWxSZWYgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxufVxuIl19
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qb2VteWVyc2NvdWdoL0RvY3VtZW50cy9HaXRIdWIvcHRjZy1lcHNkL3B0Y2ctc2VydmVyL3NyYy91dGlscy9zY2hlZHVsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Iit4VkFpQks7Nk5BakJMLEtBQUEsQ0FBQSxRQUFBLDBCQUFBLE9BQUEsQ0FBQSxXQUFBLENBQUEsQ0FBQSxDQUVBLEtBQWEsQ0FBQSxTQUFTLENBQXRCLFdBQUEsRUFBQSxpREFHVSxLQUFBLElBQUEsQ0FBaUUsRUFBakUsQ0FrRVQsQ0E5RDBCLE1BQVgsQ0FBQSxXQUFXLEVBQUEsaURBQ3ZCLE1BQU8sQ0FBQSxTQUFTLENBQUMsUUFBakIsQ0FDRCxDQUVNLEdBQUcsQ0FBQyxRQUFELENBQXFCLE9BQUEsNkJBQWtCLENBQWxCLENBQXJCLENBQXdDLGlEQUNoRDtBQUNBLEdBQUksT0FBTyxHQUFLLENBQWhCLENBQW1CLG9EQUNqQixPQUNELENBRkQsaUNBRmdELHdCQU1oRCxLQUFLLElBQUwsQ0FBVSxJQUFWLENBQWUsQ0FBRSxPQUFGLENBQVcsUUFBWCxDQUFxQixLQUFLLENBQUUsQ0FBNUIsQ0FBZixFQU5nRCx3QkFRaEQsR0FBSSxpQ0FBSyxXQUFMLEdBQXFCLFNBQXJCLCtCQUFrQyxLQUFLLFVBQUwsR0FBb0IsU0FBdEQsQ0FBSixDQUFxRSxvREFDbkUsT0FDRCxDQUZELGlDQVJnRCx5QkFZaEQsR0FBSSxDQUFDLFFBQUEsQ0FBQSxNQUFBLENBQU8sSUFBUCxDQUFZLHNCQUFqQixDQUF5QyxxREFDdkMsS0FBSyxhQUFMLEdBRHVDLHlCQUV2QyxPQUNELENBSEQsaUNBS0E7QUFDQSxLQUFNLENBQUEsUUFBUSwyQkFBRyxHQUFLLEVBQUwsQ0FBVSxJQUFiLENBQWQsQ0FDQSxLQUFNLENBQUEsWUFBWSwyQkFBRyxRQUFRLENBQUcsR0FBSSxDQUFBLElBQUosR0FBVyxPQUFYLEdBQXVCLFFBQXJDLENBQWxCLENBbkJnRCx5QkFvQmhELEtBQUssVUFBTCxDQUFrQixVQUFVLENBQUMsSUFBSyxrREFDaEMsS0FBSyxVQUFMLENBQWtCLFNBQWxCLENBRGdDLHlCQUVoQyxLQUFLLGFBQUwsR0FDRCxDQUgyQixDQUd6QixZQUh5QixDQUE1QixDQUlELENBRU8sYUFBYSxFQUFBLGtEQUNuQixHQUFJLGlDQUFLLElBQUwsQ0FBVSxNQUFWLEdBQXFCLENBQXJCLCtCQUEwQixLQUFLLFdBQUwsR0FBcUIsU0FBL0MsQ0FBSixDQUE4RCxxREFDNUQsT0FDRCxDQUZELGlDQURtQix5QkFJbkIsS0FBSyxXQUFMLENBQW1CLFdBQVcsQ0FBQyxJQUFLLGtEQUNsQyxLQUFLLElBQUwsQ0FBVSxPQUFWLENBQWtCLEdBQUcsRUFBRyxrREFDdEIsR0FBRyxDQUFDLEtBQUosRUFBYSxDQUFiLENBRHNCLHlCQUV0QixHQUFJLEdBQUcsQ0FBQyxLQUFKLEVBQWEsR0FBRyxDQUFDLE9BQXJCLENBQThCLHFEQUM1QixHQUFHLENBQUMsS0FBSixDQUFZLENBQVosQ0FENEIseUJBRTVCLEdBQUcsQ0FBQyxRQUFKLEdBQ0QsQ0FIRCxpQ0FJRCxDQU5ELEVBT0QsQ0FSNkIsQ0FRM0IsUUFBQSxDQUFBLE1BQUEsQ0FBTyxJQUFQLENBQVksaUJBUmUsQ0FBOUIsQ0FTRCxDQUVNLElBQUksQ0FBQyxRQUFELENBQW1CLHlCQUM1QixLQUFNLENBQUEsS0FBSywyQkFBRyxLQUFLLElBQUwsQ0FBVSxTQUFWLENBQW9CLEdBQUcsRUFBSSx3REFBQSxDQUFBLEdBQUcsQ0FBQyxRQUFKLEdBQWlCLFFBQWpCLENBQXlCLENBQXBELENBQUgsQ0FBWCxDQUQ0Qix5QkFFNUIsR0FBSSxLQUFLLEdBQUssQ0FBQyxDQUFmLENBQWtCLHFEQUNoQixLQUFLLElBQUwsQ0FBVSxNQUFWLENBQWlCLEtBQWpCLENBQXdCLENBQXhCLEVBRGdCLHlCQUVoQixHQUFJLEtBQUssSUFBTCxDQUFVLE1BQVYsR0FBcUIsQ0FBekIsQ0FBNEIscURBQzFCLEdBQUksS0FBSyxVQUFMLEdBQW9CLFNBQXhCLENBQW1DLHNEQUNqQyxZQUFZLENBQUMsS0FBSyxVQUFOLENBQVosQ0FEaUMseUJBRWpDLEtBQUssVUFBTCxDQUFrQixTQUFsQixDQUNELENBSEQsa0NBRDBCLHlCQUsxQixHQUFJLEtBQUssV0FBTCxHQUFxQixTQUF6QixDQUFvQyxzREFDbEMsYUFBYSxDQUFDLEtBQUssV0FBTixDQUFiLENBRGtDLHlCQUVsQyxLQUFLLFdBQUwsQ0FBbUIsU0FBbkIsQ0FDRCxDQUhELGtDQUlELENBVEQsaUNBVUQsQ0FaRCxpQ0FhRCxDQW5FbUIsQyx5QkFBdEIsT0FBQSxDQUFBLFNBQUEsQ0FBQSxTQUFBLEMseUJBRWlCLFNBQUEsQ0FBQSxRQUFBLENBQXNCLEdBQUksQ0FBQSxTQUFKLEVBQXRCLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb25maWcgfSBmcm9tICcuLi9jb25maWcnO1xuXG5leHBvcnQgY2xhc3MgU2NoZWR1bGVyIHtcblxuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogU2NoZWR1bGVyID0gbmV3IFNjaGVkdWxlcigpO1xuICBwcml2YXRlIGpvYnM6IHsgY2FsbGJhY2s6IEZ1bmN0aW9uLCBjb3VudGVyOiBudW1iZXIsIHZhbHVlOiBudW1iZXIgfVtdID0gW107XG4gIHByaXZhdGUgdGltZW91dFJlZjogTm9kZUpTLlRpbWVvdXQgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgaW50ZXJ2YWxSZWY6IE5vZGVKUy5UaW1lb3V0IHwgdW5kZWZpbmVkO1xuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogU2NoZWR1bGVyIHtcbiAgICByZXR1cm4gU2NoZWR1bGVyLmluc3RhbmNlO1xuICB9XG5cbiAgcHVibGljIHJ1bihjYWxsYmFjazogRnVuY3Rpb24sIGNvdW50ZXI6IG51bWJlciA9IDEpOiB2b2lkIHtcbiAgICAvLyBKb2IgZGlzYWJsZWQgaW4gdGhlIGNvbmZpZyBmaWxlLCBkbyBub3QgYWRkIGl0IHRvIHNjaGVkdWxlclxuICAgIGlmIChjb3VudGVyID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5qb2JzLnB1c2goeyBjb3VudGVyLCBjYWxsYmFjaywgdmFsdWU6IDAgfSk7XG5cbiAgICBpZiAodGhpcy5pbnRlcnZhbFJlZiAhPT0gdW5kZWZpbmVkIHx8IHRoaXMudGltZW91dFJlZiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFjb25maWcuY29yZS5zY2hlZHVsZXJTdGFydE5leHRIb3VyKSB7XG4gICAgICB0aGlzLnN0YXJ0SW50ZXJ2YWwoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyB3YWl0IHdpdGggdGhlIGluaXRpYWxpemF0aW9uIHRpbGwgbmV4dCBob3VyXG4gICAgY29uc3QgbXNJbkhvdXIgPSA2MCAqIDYwICogMTAwMDtcbiAgICBjb25zdCBtc1RvTmV4dEhvdXIgPSBtc0luSG91ciAtIG5ldyBEYXRlKCkuZ2V0VGltZSgpICUgbXNJbkhvdXI7XG4gICAgdGhpcy50aW1lb3V0UmVmID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLnRpbWVvdXRSZWYgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLnN0YXJ0SW50ZXJ2YWwoKTtcbiAgICB9LCBtc1RvTmV4dEhvdXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGFydEludGVydmFsKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmpvYnMubGVuZ3RoID09PSAwIHx8IHRoaXMuaW50ZXJ2YWxSZWYgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmludGVydmFsUmVmID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgdGhpcy5qb2JzLmZvckVhY2goam9iID0+IHtcbiAgICAgICAgam9iLnZhbHVlICs9IDE7XG4gICAgICAgIGlmIChqb2IudmFsdWUgPj0gam9iLmNvdW50ZXIpIHtcbiAgICAgICAgICBqb2IudmFsdWUgPSAwO1xuICAgICAgICAgIGpvYi5jYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LCBjb25maWcuY29yZS5zY2hlZHVsZXJJbnRlcnZhbCk7XG4gIH1cblxuICBwdWJsaWMgc3RvcChjYWxsYmFjazogRnVuY3Rpb24pOiB2b2lkIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuam9icy5maW5kSW5kZXgoam9iID0+IGpvYi5jYWxsYmFjayA9PT0gY2FsbGJhY2spO1xuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgIHRoaXMuam9icy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgaWYgKHRoaXMuam9icy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgaWYgKHRoaXMudGltZW91dFJlZiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dFJlZik7XG4gICAgICAgICAgdGhpcy50aW1lb3V0UmVmID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmludGVydmFsUmVmICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxSZWYpO1xuICAgICAgICAgIHRoaXMuaW50ZXJ2YWxSZWYgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxufVxuIl19