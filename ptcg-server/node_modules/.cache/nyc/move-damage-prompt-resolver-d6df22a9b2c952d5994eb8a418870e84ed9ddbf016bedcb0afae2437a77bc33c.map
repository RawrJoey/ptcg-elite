{"version":3,"file":"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/simple-bot/prompt-resolver/move-damage-prompt-resolver.ts","sources":["/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/simple-bot/prompt-resolver/move-damage-prompt-resolver.ts"],"names":[],"mappings":";;;AAAA,qCACqC;AACrC,6EAAuE;AAGvE,MAAa,wBAAyB,SAAQ,oDAAuB;IAE5D,aAAa,CAAC,KAAY,EAAE,MAAc,EAAE,MAAmB;QACpE,IAAI,MAAM,YAAY,uBAAgB,EAAE;YACtC,MAAM,MAAM,GAAG,IAAI,CAAC,yBAAyB,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;YAC7D,OAAO,IAAI,0BAAmB,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;SACnD;IACH,CAAC;IAEO,yBAAyB,CAAC,KAAY,EAAE,MAAwB;QACtE,IAAI,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,MAAM,EAAE,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QAC3E,MAAM,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,MAAM,EAAE,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;QAEzE,SAAS,CAAC,OAAO,EAAE,CAAC;QACpB,SAAS,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAErD,MAAM,MAAM,GAAqB,EAAE,CAAC;QACpC,IAAI,KAAK,GAAG,CAAC,CAAC;QACd,IAAI,UAAU,GAAG,KAAK,CAAC;QAEvB,MAAM,GAAG,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC;QAC/B,MAAM,GAAG,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC;QAC/B,IAAI,SAAS,GAAG,CAAC,CAAC;QAClB,IAAI,OAAO,GAAG,CAAC,CAAC;QAEhB,OAAO,SAAS,GAAG,SAAS,CAAC,MAAM,IAAI,OAAO,GAAG,OAAO,CAAC,MAAM,IAAI,CAAC,CAAC,UAAU,IAAI,MAAM,CAAC,MAAM,GAAG,GAAG,CAAC,EAAE;YACvG,MAAM,QAAQ,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC;YACtC,MAAM,MAAM,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC;YAChC,IAAI,QAAQ,KAAK,SAAS,IAAI,MAAM,KAAK,SAAS,EAAE;gBAClD,MAAM;aACP;YAED,IAAI,QAAQ,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,EAAE;gBAClC,UAAU,GAAG,IAAI,CAAC;aACnB;YAED,kEAAkE;YAClE,mDAAmD;YACnD,IAAI,UAAU,IAAI,MAAM,CAAC,OAAO,CAAC,WAAW,EAAE;gBAC5C,MAAM;aACP;YAED,2DAA2D;YAC3D,IAAI,UAAU,IAAI,MAAM,CAAC,MAAM,IAAI,GAAG,EAAE;gBACtC,MAAM;aACP;YAED,IAAI,MAAM,CAAC,QAAQ,KAAK,QAAQ,CAAC,QAAQ,EAAE;gBACzC,OAAO,IAAI,CAAC,CAAC;aACd;YAED,IAAI,MAAM,CAAC,QAAQ,KAAK,QAAQ,CAAC,QAAQ,EAAE;gBACzC,QAAQ,CAAC,MAAM,IAAI,EAAE,CAAC;gBACtB,MAAM,CAAC,MAAM,IAAI,EAAE,CAAC;gBACpB,KAAK,IAAI,MAAM,CAAC,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC;gBACvC,MAAM,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,QAAQ,CAAC,MAAM,EAAE,EAAE,EAAE,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC;gBAE1D,IAAI,QAAQ,CAAC,MAAM,IAAI,CAAC,EAAE;oBACxB,SAAS,IAAI,CAAC,CAAC;iBAChB;gBAED,IAAI,MAAM,CAAC,EAAE,GAAG,MAAM,CAAC,MAAM,IAAI,CAAC,EAAE;oBAClC,OAAO,IAAI,CAAC,CAAC;iBACd;gBAED,IAAI,GAAG,KAAK,SAAS,IAAI,MAAM,CAAC,MAAM,IAAI,GAAG,EAAE;oBAC7C,MAAM;iBACP;aACF;SACF;QAED,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,WAAW,EAAE;YACrD,OAAO,IAAI,CAAC;SACb;QAED,IAAI,KAAK,GAAG,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,WAAW,EAAE;YAC3C,OAAO,IAAI,CAAC;SACb;QAED,OAAO,MAAM,CAAC;IAChB,CAAC;CAEF;AAlFD,4DAkFC","sourcesContent":["import { Player, State, Action, ResolvePromptAction, Prompt, MoveDamagePrompt,\n  DamageTransfer } from '../../game';\nimport { PutDamagePromptResolver } from './put-damage-prompt-resolver';\n\n\nexport class MoveDamagePromptResolver extends PutDamagePromptResolver {\n\n  public resolvePrompt(state: State, player: Player, prompt: Prompt<any>): Action | undefined {\n    if (prompt instanceof MoveDamagePrompt) {\n      const result = this.getMoveDamagePromptResult(state, prompt);\n      return new ResolvePromptAction(prompt.id, result);\n    }\n  }\n\n  private getMoveDamagePromptResult(state: State, prompt: MoveDamagePrompt): DamageTransfer[] | null {\n    let fromItems = this.getTargets(state, prompt, prompt.options.blockedFrom);\n    const toItems = this.getTargets(state, prompt, prompt.options.blockedTo);\n\n    fromItems.reverse();\n    fromItems = fromItems.filter(i => i.cardList.damage);\n\n    const result: DamageTransfer[] = [];\n    let score = 0;\n    let isNegative = false;\n\n    const min = prompt.options.min;\n    const max = prompt.options.max;\n    let fromIndex = 0;\n    let toIndex = 0;\n\n    while (fromIndex < fromItems.length && toIndex < toItems.length && (!isNegative || result.length < min)) {\n      const fromItem = fromItems[fromIndex];\n      const toItem = toItems[toIndex];\n      if (fromItem === undefined || toItem === undefined) {\n        break;\n      }\n\n      if (fromItem.score >= toItem.score) {\n        isNegative = true;\n      }\n\n      // Moving any card gives negative score, and we are able to cancel\n      // Don't append any results, just cancel the prompt\n      if (isNegative && prompt.options.allowCancel) {\n        break;\n      }\n\n      // Score is negative, and we already have minimum transfers\n      if (isNegative && result.length >= min) {\n        break;\n      }\n\n      if (toItem.cardList === fromItem.cardList) {\n        toIndex += 1;\n      }\n\n      if (toItem.cardList !== fromItem.cardList) {\n        fromItem.damage -= 10;\n        toItem.damage += 10;\n        score += toItem.score - fromItem.score;\n        result.push({ from: fromItem.target, to: toItem.target });\n\n        if (fromItem.damage <= 0) {\n          fromIndex += 1;\n        }\n\n        if (toItem.hp - toItem.damage <= 0) {\n          toIndex += 1;\n        }\n\n        if (max !== undefined && result.length >= max) {\n          break;\n        }\n      }\n    }\n\n    if (result.length === 0 && prompt.options.allowCancel) {\n      return null;\n    }\n\n    if (score < 0 && prompt.options.allowCancel) {\n      return null;\n    }\n\n    return result;\n  }\n\n}\n"]}