{"version":3,"file":"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/effect-reducers/attack-effect.ts","sources":["/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/effect-reducers/attack-effect.ts"],"names":[],"mappings":"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","sourcesContent":["import { GameError } from '../../game-error';\nimport { GameMessage } from '../../game-message';\nimport { Effect } from '../effects/effect';\nimport { State } from '../state/state';\nimport { StoreLike } from '../store-like';\nimport { PutDamageEffect, DealDamageEffect, DiscardCardsEffect,\n  AddMarkerEffect, HealTargetEffect, AddSpecialConditionsEffect,\n  RemoveSpecialConditionsEffect, ApplyWeaknessEffect, AfterDamageEffect,\n  PutCountersEffect } from '../effects/attack-effects';\nimport { HealEffect } from '../effects/game-effects';\nimport { StateUtils } from '../state-utils';\n\nexport function attackReducer(store: StoreLike, state: State, effect: Effect): State {\n\n  if (effect instanceof PutDamageEffect) {\n    const target = effect.target;\n    const pokemonCard = target.getPokemonCard();\n    if (pokemonCard === undefined) {\n      throw new GameError(GameMessage.ILLEGAL_ACTION);\n    }\n\n    const damage = Math.max(0, effect.damage);\n    target.damage += damage;\n\n    if (damage > 0) {\n      const afterDamageEffect = new AfterDamageEffect(effect.attackEffect, damage);\n      afterDamageEffect.target = effect.target;\n      store.reduceEffect(state, afterDamageEffect);\n    }\n  }\n\n  if (effect instanceof DealDamageEffect) {\n    const base = effect.attackEffect;\n\n    const applyWeakness = new ApplyWeaknessEffect(base, effect.damage);\n    applyWeakness.target = effect.target;\n    applyWeakness.ignoreWeakness = base.ignoreWeakness;\n    applyWeakness.ignoreResistance = base.ignoreResistance;\n    state = store.reduceEffect(state, applyWeakness);\n\n    const dealDamage = new PutDamageEffect(base, applyWeakness.damage);\n    dealDamage.target = effect.target;\n    state = store.reduceEffect(state, dealDamage);\n\n    return state;\n  }\n\n  if (effect instanceof PutCountersEffect) {\n    const target = effect.target;\n    const pokemonCard = target.getPokemonCard();\n    if (pokemonCard === undefined) {\n      throw new GameError(GameMessage.ILLEGAL_ACTION);\n    }\n\n    const damage = Math.max(0, effect.damage);\n    target.damage += damage;\n  }\n\n  if (effect instanceof DiscardCardsEffect) {\n    const target = effect.target;\n    const cards = effect.cards;\n    const owner = StateUtils.findOwner(state, target);\n    target.moveCardsTo(cards, owner.discard);\n    return state;\n  }\n\n  if (effect instanceof AddMarkerEffect) {\n    const target = effect.target;\n    target.marker.addMarker(effect.markerName, effect.markerSource);\n    return state;\n  }\n\n  if (effect instanceof HealTargetEffect) {\n    const target = effect.target;\n    const owner = StateUtils.findOwner(state, target);\n    const healEffect = new HealEffect(owner, target, effect.damage);\n    state = store.reduceEffect(state, healEffect);\n    return state;\n  }\n\n  if (effect instanceof AddSpecialConditionsEffect) {\n    const target = effect.target;\n    effect.specialConditions.forEach(sp => {\n      target.addSpecialCondition(sp);\n    });\n    if (effect.poisonDamage !== undefined) {\n      target.poisonDamage = effect.poisonDamage;\n    }\n    return state;\n  }\n\n  if (effect instanceof RemoveSpecialConditionsEffect) {\n    const target = effect.target;\n    effect.specialConditions.forEach(sp => {\n      target.removeSpecialCondition(sp);\n    });\n    return state;\n  }\n\n  return state;\n}\n"]}