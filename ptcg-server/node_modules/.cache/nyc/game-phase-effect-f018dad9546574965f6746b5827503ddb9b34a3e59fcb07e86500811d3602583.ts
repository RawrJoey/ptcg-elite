"use strict";function cov_15shj7by19(){var path="/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/effect-reducers/game-phase-effect.ts";var hash="ad14483766ead8b4736ef073c0dff4c0bf420a71";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/effect-reducers/game-phase-effect.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:0},end:{line:3,column:80}},"2":{start:{line:4,column:29},end:{line:4,column:69}},"3":{start:{line:5,column:21},end:{line:5,column:48}},"4":{start:{line:6,column:23},end:{line:6,column:52}},"5":{start:{line:7,column:21},end:{line:7,column:50}},"6":{start:{line:8,column:16},end:{line:8,column:41}},"7":{start:{line:9,column:23},end:{line:9,column:48}},"8":{start:{line:10,column:27},end:{line:10,column:65}},"9":{start:{line:12,column:4},end:{line:12,column:45}},"10":{start:{line:15,column:4},end:{line:17,column:5}},"11":{start:{line:16,column:8},end:{line:16,column:54}},"12":{start:{line:18,column:4},end:{line:20,column:5}},"13":{start:{line:19,column:8},end:{line:19,column:87}},"14":{start:{line:21,column:4},end:{line:25,column:5}},"15":{start:{line:22,column:8},end:{line:24,column:11}},"16":{start:{line:23,column:12},end:{line:23,column:72}},"17":{start:{line:23,column:58},end:{line:23,column:70}},"18":{start:{line:26,column:4},end:{line:26,column:71}},"19":{start:{line:26,column:57},end:{line:26,column:69}},"20":{start:{line:28,column:0},end:{line:28,column:36}},"21":{start:{line:30,column:4},end:{line:32,column:5}},"22":{start:{line:31,column:8},end:{line:31,column:21}},"23":{start:{line:33,column:17},end:{line:33,column:39}},"24":{start:{line:34,column:4},end:{line:36,column:5}},"25":{start:{line:35,column:8},end:{line:35,column:52}},"26":{start:{line:37,column:4},end:{line:41,column:5}},"27":{start:{line:38,column:8},end:{line:38,column:56}},"28":{start:{line:39,column:8},end:{line:39,column:52}},"29":{start:{line:40,column:8},end:{line:40,column:40}},"30":{start:{line:42,column:4},end:{line:42,column:17}},"31":{start:{line:43,column:4},end:{line:43,column:76}},"32":{start:{line:45,column:4},end:{line:47,column:5}},"33":{start:{line:46,column:8},end:{line:46,column:21}},"34":{start:{line:49,column:4},end:{line:49,column:90}},"35":{start:{line:50,column:4},end:{line:55,column:5}},"36":{start:{line:51,column:8},end:{line:51,column:100}},"37":{start:{line:52,column:23},end:{line:52,column:101}},"38":{start:{line:53,column:8},end:{line:53,column:61}},"39":{start:{line:54,column:8},end:{line:54,column:21}},"40":{start:{line:56,column:4},end:{line:56,column:39}},"41":{start:{line:57,column:4},end:{line:57,column:17}},"42":{start:{line:59,column:0},end:{line:59,column:36}},"43":{start:{line:61,column:19},end:{line:61,column:52}},"44":{start:{line:62,column:4},end:{line:62,column:89}},"45":{start:{line:64,column:4},end:{line:64,column:82}},"46":{start:{line:66,column:4},end:{line:66,column:44}},"47":{start:{line:67,column:4},end:{line:71,column:7}},"48":{start:{line:68,column:8},end:{line:70,column:9}},"49":{start:{line:69,column:12},end:{line:69,column:46}},"50":{start:{line:74,column:19},end:{line:74,column:32}},"51":{start:{line:75,column:4},end:{line:110,column:5}},"52":{start:{line:76,column:8},end:{line:109,column:9}},"53":{start:{line:78,column:16},end:{line:78,column:60}},"54":{start:{line:79,column:16},end:{line:79,column:22}},"55":{start:{line:81,column:16},end:{line:83,column:17}},"56":{start:{line:82,column:20},end:{line:82,column:26}},"57":{start:{line:84,column:16},end:{line:87,column:17}},"58":{start:{line:85,column:20},end:{line:85,column:62}},"59":{start:{line:86,column:20},end:{line:86,column:26}},"60":{start:{line:88,column:16},end:{line:92,column:19}},"61":{start:{line:89,column:20},end:{line:91,column:21}},"62":{start:{line:90,column:24},end:{line:90,column:66}},"63":{start:{line:93,column:16},end:{line:93,column:22}},"64":{start:{line:95,column:16},end:{line:98,column:17}},"65":{start:{line:96,column:20},end:{line:96,column:95}},"66":{start:{line:97,column:20},end:{line:97,column:26}},"67":{start:{line:99,column:16},end:{line:101,column:17}},"68":{start:{line:100,column:20},end:{line:100,column:26}},"69":{start:{line:102,column:16},end:{line:102,column:96}},"70":{start:{line:103,column:16},end:{line:107,column:19}},"71":{start:{line:104,column:20},end:{line:106,column:21}},"72":{start:{line:105,column:24},end:{line:105,column:99}},"73":{start:{line:108,column:16},end:{line:108,column:22}},"74":{start:{line:113,column:4},end:{line:125,column:5}},"75":{start:{line:114,column:23},end:{line:114,column:56}},"76":{start:{line:115,column:8},end:{line:117,column:9}},"77":{start:{line:116,column:12},end:{line:116,column:87}},"78":{start:{line:118,column:8},end:{line:123,column:11}},"79":{start:{line:119,column:12},end:{line:121,column:13}},"80":{start:{line:120,column:16},end:{line:120,column:23}},"81":{start:{line:122,column:12},end:{line:122,column:47}},"82":{start:{line:124,column:8},end:{line:124,column:21}},"83":{start:{line:126,column:4},end:{line:128,column:5}},"84":{start:{line:127,column:8},end:{line:127,column:54}},"85":{start:{line:129,column:4},end:{line:129,column:17}},"86":{start:{line:131,column:0},end:{line:131,column:44}}},fnMap:{"0":{name:"getActivePlayer",decl:{start:{line:11,column:9},end:{line:11,column:24}},loc:{start:{line:11,column:32},end:{line:13,column:1}},line:11},"1":{name:"betweenTurns",decl:{start:{line:14,column:9},end:{line:14,column:21}},loc:{start:{line:14,column:48},end:{line:27,column:1}},line:14},"2":{name:"(anonymous_2)",decl:{start:{line:22,column:39},end:{line:22,column:40}},loc:{start:{line:22,column:45},end:{line:24,column:9}},line:22},"3":{name:"(anonymous_3)",decl:{start:{line:23,column:52},end:{line:23,column:53}},loc:{start:{line:23,column:58},end:{line:23,column:70}},line:23},"4":{name:"(anonymous_4)",decl:{start:{line:26,column:51},end:{line:26,column:52}},loc:{start:{line:26,column:57},end:{line:26,column:69}},line:26},"5":{name:"initNextTurn",decl:{start:{line:29,column:9},end:{line:29,column:21}},loc:{start:{line:29,column:36},end:{line:58,column:1}},line:29},"6":{name:"startNextTurn",decl:{start:{line:60,column:9},end:{line:60,column:22}},loc:{start:{line:60,column:37},end:{line:72,column:1}},line:60},"7":{name:"(anonymous_7)",decl:{start:{line:67,column:38},end:{line:67,column:39}},loc:{start:{line:67,column:44},end:{line:71,column:5}},line:67},"8":{name:"handleSpecialConditions",decl:{start:{line:73,column:9},end:{line:73,column:32}},loc:{start:{line:73,column:55},end:{line:111,column:1}},line:73},"9":{name:"(anonymous_9)",decl:{start:{line:88,column:126},end:{line:88,column:127}},loc:{start:{line:88,column:136},end:{line:92,column:17}},line:88},"10":{name:"(anonymous_10)",decl:{start:{line:103,column:126},end:{line:103,column:127}},loc:{start:{line:103,column:136},end:{line:107,column:17}},line:103},"11":{name:"gamePhaseReducer",decl:{start:{line:112,column:9},end:{line:112,column:25}},loc:{start:{line:112,column:48},end:{line:130,column:1}},line:112},"12":{name:"(anonymous_12)",decl:{start:{line:118,column:56},end:{line:118,column:57}},loc:{start:{line:118,column:62},end:{line:123,column:9}},line:118}},branchMap:{"0":{loc:{start:{line:15,column:4},end:{line:17,column:5}},type:"if",locations:[{start:{line:15,column:4},end:{line:17,column:5}},{start:{line:15,column:4},end:{line:17,column:5}}],line:15},"1":{loc:{start:{line:15,column:8},end:{line:15,column:97}},type:"binary-expr",locations:[{start:{line:15,column:8},end:{line:15,column:53}},{start:{line:15,column:57},end:{line:15,column:97}}],line:15},"2":{loc:{start:{line:21,column:4},end:{line:25,column:5}},type:"if",locations:[{start:{line:21,column:4},end:{line:25,column:5}},{start:{line:21,column:4},end:{line:25,column:5}}],line:21},"3":{loc:{start:{line:30,column:4},end:{line:32,column:5}},type:"if",locations:[{start:{line:30,column:4},end:{line:32,column:5}},{start:{line:30,column:4},end:{line:32,column:5}}],line:30},"4":{loc:{start:{line:34,column:4},end:{line:36,column:5}},type:"if",locations:[{start:{line:34,column:4},end:{line:36,column:5}},{start:{line:34,column:4},end:{line:36,column:5}}],line:34},"5":{loc:{start:{line:37,column:4},end:{line:41,column:5}},type:"if",locations:[{start:{line:37,column:4},end:{line:41,column:5}},{start:{line:37,column:4},end:{line:41,column:5}}],line:37},"6":{loc:{start:{line:38,column:29},end:{line:38,column:55}},type:"cond-expr",locations:[{start:{line:38,column:50},end:{line:38,column:51}},{start:{line:38,column:54},end:{line:38,column:55}}],line:38},"7":{loc:{start:{line:45,column:4},end:{line:47,column:5}},type:"if",locations:[{start:{line:45,column:4},end:{line:47,column:5}},{start:{line:45,column:4},end:{line:47,column:5}}],line:45},"8":{loc:{start:{line:45,column:8},end:{line:45,column:58}},type:"binary-expr",locations:[{start:{line:45,column:8},end:{line:45,column:24}},{start:{line:45,column:28},end:{line:45,column:58}}],line:45},"9":{loc:{start:{line:50,column:4},end:{line:55,column:5}},type:"if",locations:[{start:{line:50,column:4},end:{line:55,column:5}},{start:{line:50,column:4},end:{line:55,column:5}}],line:50},"10":{loc:{start:{line:52,column:23},end:{line:52,column:101}},type:"cond-expr",locations:[{start:{line:52,column:44},end:{line:52,column:71}},{start:{line:52,column:74},end:{line:52,column:101}}],line:52},"11":{loc:{start:{line:68,column:8},end:{line:70,column:9}},type:"if",locations:[{start:{line:68,column:8},end:{line:70,column:9}},{start:{line:68,column:8},end:{line:70,column:9}}],line:68},"12":{loc:{start:{line:76,column:8},end:{line:109,column:9}},type:"switch",locations:[{start:{line:77,column:12},end:{line:79,column:22}},{start:{line:80,column:12},end:{line:93,column:22}},{start:{line:94,column:12},end:{line:108,column:22}}],line:76},"13":{loc:{start:{line:81,column:16},end:{line:83,column:17}},type:"if",locations:[{start:{line:81,column:16},end:{line:83,column:17}},{start:{line:81,column:16},end:{line:83,column:17}}],line:81},"14":{loc:{start:{line:84,column:16},end:{line:87,column:17}},type:"if",locations:[{start:{line:84,column:16},end:{line:87,column:17}},{start:{line:84,column:16},end:{line:87,column:17}}],line:84},"15":{loc:{start:{line:89,column:20},end:{line:91,column:21}},type:"if",locations:[{start:{line:89,column:20},end:{line:91,column:21}},{start:{line:89,column:20},end:{line:91,column:21}}],line:89},"16":{loc:{start:{line:95,column:16},end:{line:98,column:17}},type:"if",locations:[{start:{line:95,column:16},end:{line:98,column:17}},{start:{line:95,column:16},end:{line:98,column:17}}],line:95},"17":{loc:{start:{line:99,column:16},end:{line:101,column:17}},type:"if",locations:[{start:{line:99,column:16},end:{line:101,column:17}},{start:{line:99,column:16},end:{line:101,column:17}}],line:99},"18":{loc:{start:{line:104,column:20},end:{line:106,column:21}},type:"if",locations:[{start:{line:104,column:20},end:{line:106,column:21}},{start:{line:104,column:20},end:{line:106,column:21}}],line:104},"19":{loc:{start:{line:113,column:4},end:{line:125,column:5}},type:"if",locations:[{start:{line:113,column:4},end:{line:125,column:5}},{start:{line:113,column:4},end:{line:125,column:5}}],line:113},"20":{loc:{start:{line:115,column:8},end:{line:117,column:9}},type:"if",locations:[{start:{line:115,column:8},end:{line:117,column:9}},{start:{line:115,column:8},end:{line:117,column:9}}],line:115},"21":{loc:{start:{line:119,column:12},end:{line:121,column:13}},type:"if",locations:[{start:{line:119,column:12},end:{line:121,column:13}},{start:{line:119,column:12},end:{line:121,column:13}}],line:119},"22":{loc:{start:{line:126,column:4},end:{line:128,column:5}},type:"if",locations:[{start:{line:126,column:4},end:{line:128,column:5}},{start:{line:126,column:4},end:{line:128,column:5}}],line:126}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0]},inputSourceMap:{version:3,file:"/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/effect-reducers/game-phase-effect.ts",sources:["/Users/joemyerscough/Documents/GitHub/ptcg-epsd/ptcg-server/src/game/store/effect-reducers/game-phase-effect.ts"],names:[],mappings:"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",sourcesContent:["import { Effect } from '../effects/effect';\nimport { EndTurnEffect, BetweenTurnsEffect } from '../effects/game-phase-effects';\nimport { GameError } from '../../game-error';\nimport { GameMessage, GameLog } from '../../game-message';\nimport { Player } from '../state/player';\nimport { SpecialCondition } from '../card/card-types';\nimport { State, GamePhase, GameWinner } from '../state/state';\nimport { StoreLike } from '../store-like';\nimport { checkState, endGame } from './check-effect';\nimport { CoinFlipPrompt } from '../prompts/coin-flip-prompt';\n\nfunction getActivePlayer(state: State): Player {\n  return state.players[state.activePlayer];\n}\n\nexport function betweenTurns(store: StoreLike, state: State, onComplete: () => void): State {\n  if (state.phase === GamePhase.PLAYER_TURN || state.phase === GamePhase.ATTACK) {\n    state.phase = GamePhase.BETWEEN_TURNS;\n  }\n\n  for (const player of state.players) {\n    store.reduceEffect(state, new BetweenTurnsEffect(player));\n  }\n\n  if (store.hasPrompts()) {\n    return store.waitPrompt(state, () => {\n      checkState(store, state, () => onComplete());\n    });\n  }\n  return checkState(store, state, () => onComplete());\n}\n\nexport function initNextTurn(store: StoreLike, state: State): State {\n  if ([GamePhase.SETUP, GamePhase.BETWEEN_TURNS].indexOf(state.phase) === -1) {\n    return state;\n  }\n\n  let player: Player = getActivePlayer(state);\n\n  if (state.phase === GamePhase.SETUP) {\n    state.phase = GamePhase.PLAYER_TURN;\n  }\n\n  if (state.phase === GamePhase.BETWEEN_TURNS) {\n    state.activePlayer = state.activePlayer ? 0 : 1;\n    state.phase = GamePhase.PLAYER_TURN;\n    player = getActivePlayer(state);\n  }\n\n  state.turn++;\n  store.log(state, GameLog.LOG_TURN, { turn: state.turn });\n\n  // Skip draw card on first turn\n  if (state.turn === 1 && !state.rules.firstTurnDrawCard) {\n    return state;\n  }\n\n  // Draw card at the beginning\n  store.log(state, GameLog.LOG_PLAYER_DRAWS_CARD, { name: player.name });\n  if (player.deck.cards.length === 0) {\n\n    store.log(state, GameLog.LOG_PLAYER_NO_CARDS_IN_DECK, { name: player.name });\n    const winner = state.activePlayer ? GameWinner.PLAYER_1 : GameWinner.PLAYER_2;\n    state = endGame(store, state, winner);\n    return state;\n  }\n\n  player.deck.moveTo(player.hand, 1);\n  return state;\n}\n\nfunction startNextTurn(store: StoreLike, state: State): State {\n  const player = state.players[state.activePlayer];\n  store.log(state, GameLog.LOG_PLAYER_ENDS_TURN, { name: player.name });\n\n  // Remove Paralyzed at the end of the turn\n  player.active.removeSpecialCondition(SpecialCondition.PARALYZED);\n\n  // Move supporter cards to discard\n  player.supporter.moveTo(player.discard);\n\n  return betweenTurns(store, state, () => {\n    if (state.phase !== GamePhase.FINISHED) {\n      return initNextTurn(store, state);\n    }\n  });\n}\n\nfunction handleSpecialConditions(store: StoreLike, state: State, effect: BetweenTurnsEffect) {\n  const player = effect.player;\n  for (const sp of player.active.specialConditions) {\n    switch (sp) {\n      case SpecialCondition.POISONED:\n        player.active.damage += effect.poisonDamage;\n        break;\n      case SpecialCondition.BURNED:\n        if (effect.burnFlipResult === true) {\n          break;\n        }\n        if (effect.burnFlipResult === false) {\n          player.active.damage += effect.burnDamage;\n          break;\n        }\n        store.prompt(state, new CoinFlipPrompt(\n          player.id,\n          GameMessage.FLIP_BURNED\n        ), result => {\n          if (result === false) {\n            player.active.damage += effect.burnDamage;\n          }\n        });\n        break;\n      case SpecialCondition.ASLEEP:\n        if (effect.asleepFlipResult === true) {\n          player.active.removeSpecialCondition(SpecialCondition.ASLEEP);\n          break;\n        }\n        if (effect.asleepFlipResult === false) {\n          break;\n        }\n        store.log(state, GameLog.LOG_FLIP_ASLEEP, { name: player.name });\n        store.prompt(state, new CoinFlipPrompt(\n          player.id,\n          GameMessage.FLIP_ASLEEP\n        ), result => {\n          if (result === true) {\n            player.active.removeSpecialCondition(SpecialCondition.ASLEEP);\n          }\n        });\n        break;\n    }\n  }\n}\n\nexport function gamePhaseReducer(store: StoreLike, state: State, effect: Effect): State {\n\n  if (effect instanceof EndTurnEffect) {\n    const player = state.players[state.activePlayer];\n\n    if (player === undefined) {\n      throw new GameError(GameMessage.NOT_YOUR_TURN);\n    }\n\n    state = checkState(store, state, () => {\n      if (state.phase === GamePhase.FINISHED) {\n        return;\n      }\n\n      return startNextTurn(store, state);\n    });\n\n    return state;\n  }\n\n  if (effect instanceof BetweenTurnsEffect) {\n    handleSpecialConditions(store, state, effect);\n  }\n\n  return state;\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"ad14483766ead8b4736ef073c0dff4c0bf420a71"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_15shj7by19=function(){return actualCoverage;};}return actualCoverage;}cov_15shj7by19();cov_15shj7by19().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_15shj7by19().s[1]++;exports.gamePhaseReducer=exports.initNextTurn=exports.betweenTurns=void 0;const game_phase_effects_1=(cov_15shj7by19().s[2]++,require("../effects/game-phase-effects"));const game_error_1=(cov_15shj7by19().s[3]++,require("../../game-error"));const game_message_1=(cov_15shj7by19().s[4]++,require("../../game-message"));const card_types_1=(cov_15shj7by19().s[5]++,require("../card/card-types"));const state_1=(cov_15shj7by19().s[6]++,require("../state/state"));const check_effect_1=(cov_15shj7by19().s[7]++,require("./check-effect"));const coin_flip_prompt_1=(cov_15shj7by19().s[8]++,require("../prompts/coin-flip-prompt"));function getActivePlayer(state){cov_15shj7by19().f[0]++;cov_15shj7by19().s[9]++;return state.players[state.activePlayer];}function betweenTurns(store,state,onComplete){cov_15shj7by19().f[1]++;cov_15shj7by19().s[10]++;if((cov_15shj7by19().b[1][0]++,state.phase===state_1.GamePhase.PLAYER_TURN)||(cov_15shj7by19().b[1][1]++,state.phase===state_1.GamePhase.ATTACK)){cov_15shj7by19().b[0][0]++;cov_15shj7by19().s[11]++;state.phase=state_1.GamePhase.BETWEEN_TURNS;}else{cov_15shj7by19().b[0][1]++;}cov_15shj7by19().s[12]++;for(const player of state.players){cov_15shj7by19().s[13]++;store.reduceEffect(state,new game_phase_effects_1.BetweenTurnsEffect(player));}cov_15shj7by19().s[14]++;if(store.hasPrompts()){cov_15shj7by19().b[2][0]++;cov_15shj7by19().s[15]++;return store.waitPrompt(state,()=>{cov_15shj7by19().f[2]++;cov_15shj7by19().s[16]++;check_effect_1.checkState(store,state,()=>{cov_15shj7by19().f[3]++;cov_15shj7by19().s[17]++;return onComplete();});});}else{cov_15shj7by19().b[2][1]++;}cov_15shj7by19().s[18]++;return check_effect_1.checkState(store,state,()=>{cov_15shj7by19().f[4]++;cov_15shj7by19().s[19]++;return onComplete();});}cov_15shj7by19().s[20]++;exports.betweenTurns=betweenTurns;function initNextTurn(store,state){cov_15shj7by19().f[5]++;cov_15shj7by19().s[21]++;if([state_1.GamePhase.SETUP,state_1.GamePhase.BETWEEN_TURNS].indexOf(state.phase)===-1){cov_15shj7by19().b[3][0]++;cov_15shj7by19().s[22]++;return state;}else{cov_15shj7by19().b[3][1]++;}let player=(cov_15shj7by19().s[23]++,getActivePlayer(state));cov_15shj7by19().s[24]++;if(state.phase===state_1.GamePhase.SETUP){cov_15shj7by19().b[4][0]++;cov_15shj7by19().s[25]++;state.phase=state_1.GamePhase.PLAYER_TURN;}else{cov_15shj7by19().b[4][1]++;}cov_15shj7by19().s[26]++;if(state.phase===state_1.GamePhase.BETWEEN_TURNS){cov_15shj7by19().b[5][0]++;cov_15shj7by19().s[27]++;state.activePlayer=state.activePlayer?(cov_15shj7by19().b[6][0]++,0):(cov_15shj7by19().b[6][1]++,1);cov_15shj7by19().s[28]++;state.phase=state_1.GamePhase.PLAYER_TURN;cov_15shj7by19().s[29]++;player=getActivePlayer(state);}else{cov_15shj7by19().b[5][1]++;}cov_15shj7by19().s[30]++;state.turn++;cov_15shj7by19().s[31]++;store.log(state,game_message_1.GameLog.LOG_TURN,{turn:state.turn});// Skip draw card on first turn
cov_15shj7by19().s[32]++;if((cov_15shj7by19().b[8][0]++,state.turn===1)&&(cov_15shj7by19().b[8][1]++,!state.rules.firstTurnDrawCard)){cov_15shj7by19().b[7][0]++;cov_15shj7by19().s[33]++;return state;}else{cov_15shj7by19().b[7][1]++;}// Draw card at the beginning
cov_15shj7by19().s[34]++;store.log(state,game_message_1.GameLog.LOG_PLAYER_DRAWS_CARD,{name:player.name});cov_15shj7by19().s[35]++;if(player.deck.cards.length===0){cov_15shj7by19().b[9][0]++;cov_15shj7by19().s[36]++;store.log(state,game_message_1.GameLog.LOG_PLAYER_NO_CARDS_IN_DECK,{name:player.name});const winner=(cov_15shj7by19().s[37]++,state.activePlayer?(cov_15shj7by19().b[10][0]++,state_1.GameWinner.PLAYER_1):(cov_15shj7by19().b[10][1]++,state_1.GameWinner.PLAYER_2));cov_15shj7by19().s[38]++;state=check_effect_1.endGame(store,state,winner);cov_15shj7by19().s[39]++;return state;}else{cov_15shj7by19().b[9][1]++;}cov_15shj7by19().s[40]++;player.deck.moveTo(player.hand,1);cov_15shj7by19().s[41]++;return state;}cov_15shj7by19().s[42]++;exports.initNextTurn=initNextTurn;function startNextTurn(store,state){cov_15shj7by19().f[6]++;const player=(cov_15shj7by19().s[43]++,state.players[state.activePlayer]);cov_15shj7by19().s[44]++;store.log(state,game_message_1.GameLog.LOG_PLAYER_ENDS_TURN,{name:player.name});// Remove Paralyzed at the end of the turn
cov_15shj7by19().s[45]++;player.active.removeSpecialCondition(card_types_1.SpecialCondition.PARALYZED);// Move supporter cards to discard
cov_15shj7by19().s[46]++;player.supporter.moveTo(player.discard);cov_15shj7by19().s[47]++;return betweenTurns(store,state,()=>{cov_15shj7by19().f[7]++;cov_15shj7by19().s[48]++;if(state.phase!==state_1.GamePhase.FINISHED){cov_15shj7by19().b[11][0]++;cov_15shj7by19().s[49]++;return initNextTurn(store,state);}else{cov_15shj7by19().b[11][1]++;}});}function handleSpecialConditions(store,state,effect){cov_15shj7by19().f[8]++;const player=(cov_15shj7by19().s[50]++,effect.player);cov_15shj7by19().s[51]++;for(const sp of player.active.specialConditions){cov_15shj7by19().s[52]++;switch(sp){case card_types_1.SpecialCondition.POISONED:cov_15shj7by19().b[12][0]++;cov_15shj7by19().s[53]++;player.active.damage+=effect.poisonDamage;cov_15shj7by19().s[54]++;break;case card_types_1.SpecialCondition.BURNED:cov_15shj7by19().b[12][1]++;cov_15shj7by19().s[55]++;if(effect.burnFlipResult===true){cov_15shj7by19().b[13][0]++;cov_15shj7by19().s[56]++;break;}else{cov_15shj7by19().b[13][1]++;}cov_15shj7by19().s[57]++;if(effect.burnFlipResult===false){cov_15shj7by19().b[14][0]++;cov_15shj7by19().s[58]++;player.active.damage+=effect.burnDamage;cov_15shj7by19().s[59]++;break;}else{cov_15shj7by19().b[14][1]++;}cov_15shj7by19().s[60]++;store.prompt(state,new coin_flip_prompt_1.CoinFlipPrompt(player.id,game_message_1.GameMessage.FLIP_BURNED),result=>{cov_15shj7by19().f[9]++;cov_15shj7by19().s[61]++;if(result===false){cov_15shj7by19().b[15][0]++;cov_15shj7by19().s[62]++;player.active.damage+=effect.burnDamage;}else{cov_15shj7by19().b[15][1]++;}});cov_15shj7by19().s[63]++;break;case card_types_1.SpecialCondition.ASLEEP:cov_15shj7by19().b[12][2]++;cov_15shj7by19().s[64]++;if(effect.asleepFlipResult===true){cov_15shj7by19().b[16][0]++;cov_15shj7by19().s[65]++;player.active.removeSpecialCondition(card_types_1.SpecialCondition.ASLEEP);cov_15shj7by19().s[66]++;break;}else{cov_15shj7by19().b[16][1]++;}cov_15shj7by19().s[67]++;if(effect.asleepFlipResult===false){cov_15shj7by19().b[17][0]++;cov_15shj7by19().s[68]++;break;}else{cov_15shj7by19().b[17][1]++;}cov_15shj7by19().s[69]++;store.log(state,game_message_1.GameLog.LOG_FLIP_ASLEEP,{name:player.name});cov_15shj7by19().s[70]++;store.prompt(state,new coin_flip_prompt_1.CoinFlipPrompt(player.id,game_message_1.GameMessage.FLIP_ASLEEP),result=>{cov_15shj7by19().f[10]++;cov_15shj7by19().s[71]++;if(result===true){cov_15shj7by19().b[18][0]++;cov_15shj7by19().s[72]++;player.active.removeSpecialCondition(card_types_1.SpecialCondition.ASLEEP);}else{cov_15shj7by19().b[18][1]++;}});cov_15shj7by19().s[73]++;break;}}}function gamePhaseReducer(store,state,effect){cov_15shj7by19().f[11]++;cov_15shj7by19().s[74]++;if(effect instanceof game_phase_effects_1.EndTurnEffect){cov_15shj7by19().b[19][0]++;const player=(cov_15shj7by19().s[75]++,state.players[state.activePlayer]);cov_15shj7by19().s[76]++;if(player===undefined){cov_15shj7by19().b[20][0]++;cov_15shj7by19().s[77]++;throw new game_error_1.GameError(game_message_1.GameMessage.NOT_YOUR_TURN);}else{cov_15shj7by19().b[20][1]++;}cov_15shj7by19().s[78]++;state=check_effect_1.checkState(store,state,()=>{cov_15shj7by19().f[12]++;cov_15shj7by19().s[79]++;if(state.phase===state_1.GamePhase.FINISHED){cov_15shj7by19().b[21][0]++;cov_15shj7by19().s[80]++;return;}else{cov_15shj7by19().b[21][1]++;}cov_15shj7by19().s[81]++;return startNextTurn(store,state);});cov_15shj7by19().s[82]++;return state;}else{cov_15shj7by19().b[19][1]++;}cov_15shj7by19().s[83]++;if(effect instanceof game_phase_effects_1.BetweenTurnsEffect){cov_15shj7by19().b[22][0]++;cov_15shj7by19().s[84]++;handleSpecialConditions(store,state,effect);}else{cov_15shj7by19().b[22][1]++;}cov_15shj7by19().s[85]++;return state;}cov_15shj7by19().s[86]++;exports.gamePhaseReducer=gamePhaseReducer;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2pvZW15ZXJzY291Z2gvRG9jdW1lbnRzL0dpdEh1Yi9wdGNnLWVwc2QvcHRjZy1zZXJ2ZXIvc3JjL2dhbWUvc3RvcmUvZWZmZWN0LXJlZHVjZXJzL2dhbWUtcGhhc2UtZWZmZWN0LnRzIiwic291cmNlcyI6WyIvVXNlcnMvam9lbXllcnNjb3VnaC9Eb2N1bWVudHMvR2l0SHViL3B0Y2ctZXBzZC9wdGNnLXNlcnZlci9zcmMvZ2FtZS9zdG9yZS9lZmZlY3QtcmVkdWNlcnMvZ2FtZS1waGFzZS1lZmZlY3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0Esc0VBQWtGO0FBQ2xGLGlEQUE2QztBQUM3QyxxREFBMEQ7QUFFMUQsbURBQXNEO0FBQ3RELDBDQUE4RDtBQUU5RCxpREFBcUQ7QUFDckQsa0VBQTZEO0FBRTdELFNBQVMsZUFBZSxDQUFDLEtBQVk7SUFDbkMsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUMzQyxDQUFDO0FBRUQsU0FBZ0IsWUFBWSxDQUFDLEtBQWdCLEVBQUUsS0FBWSxFQUFFLFVBQXNCO0lBQ2pGLElBQUksS0FBSyxDQUFDLEtBQUssS0FBSyxpQkFBUyxDQUFDLFdBQVcsSUFBSSxLQUFLLENBQUMsS0FBSyxLQUFLLGlCQUFTLENBQUMsTUFBTSxFQUFFO1FBQzdFLEtBQUssQ0FBQyxLQUFLLEdBQUcsaUJBQVMsQ0FBQyxhQUFhLENBQUM7S0FDdkM7SUFFRCxLQUFLLE1BQU0sTUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUU7UUFDbEMsS0FBSyxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsSUFBSSx1Q0FBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0tBQzNEO0lBRUQsSUFBSSxLQUFLLENBQUMsVUFBVSxFQUFFLEVBQUU7UUFDdEIsT0FBTyxLQUFLLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUU7WUFDbEMseUJBQVUsQ0FBQyxLQUFLLEVBQUUs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QVMsQ0FBQywwQkFBVyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQ2hEO1FBRUQsS0FBSyxHQUFHLHlCQUFVLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUU7WUFDcEMsSUFBSSxLQUFLLENBQUMsS0FBSyxLQUFLLGlCQUFTLENBQUMsUUFBUSxFQUFFO2dCQUN0QyxPQUFPO2FBQ1I7WUFFRCxPQUFPLGFBQWEsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLEtBQUssQ0FBQztLQUNkO0lBRUQsSUFBSSxNQUFNLFlBQVksdUNBQWtCLEVBQUU7UUFDeEMsdUJBQXVCLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztLQUMvQztJQUVELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQXpCRCw0Q0F5QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFZmZlY3QgfSBmcm9tICcuLi9lZmZlY3RzL2VmZmVjdCc7XG5pbXBvcnQgeyBFbmRUdXJuRWZmZWN0LCBCZXR3ZWVuVHVybnNFZmZlY3QgfSBmcm9tICcuLi9lZmZlY3RzL2dhbWUtcGhhc2UtZWZmZWN0cyc7XG5pbXBvcnQgeyBHYW1lRXJyb3IgfSBmcm9tICcuLi8uLi9nYW1lLWVycm9yJztcbmltcG9ydCB7IEdhbWVNZXNzYWdlLCBHYW1lTG9nIH0gZnJvbSAnLi4vLi4vZ2FtZS1tZXNzYWdlJztcbmltcG9ydCB7IFBsYXllciB9IGZyb20gJy4uL3N0YXRlL3BsYXllcic7XG5pbXBvcnQgeyBTcGVjaWFsQ29uZGl0aW9uIH0gZnJvbSAnLi4vY2FyZC9jYXJkLXR5cGVzJztcbmltcG9ydCB7IFN0YXRlLCBHYW1lUGhhc2UsIEdhbWVXaW5uZXIgfSBmcm9tICcuLi9zdGF0ZS9zdGF0ZSc7XG5pbXBvcnQgeyBTdG9yZUxpa2UgfSBmcm9tICcuLi9zdG9yZS1saWtlJztcbmltcG9ydCB7IGNoZWNrU3RhdGUsIGVuZEdhbWUgfSBmcm9tICcuL2NoZWNrLWVmZmVjdCc7XG5pbXBvcnQgeyBDb2luRmxpcFByb21wdCB9IGZyb20gJy4uL3Byb21wdHMvY29pbi1mbGlwLXByb21wdCc7XG5cbmZ1bmN0aW9uIGdldEFjdGl2ZVBsYXllcihzdGF0ZTogU3RhdGUpOiBQbGF5ZXIge1xuICByZXR1cm4gc3RhdGUucGxheWVyc1tzdGF0ZS5hY3RpdmVQbGF5ZXJdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYmV0d2VlblR1cm5zKHN0b3JlOiBTdG9yZUxpa2UsIHN0YXRlOiBTdGF0ZSwgb25Db21wbGV0ZTogKCkgPT4gdm9pZCk6IFN0YXRlIHtcbiAgaWYgKHN0YXRlLnBoYXNlID09PSBHYW1lUGhhc2UuUExBWUVSX1RVUk4gfHwgc3RhdGUucGhhc2UgPT09IEdhbWVQaGFzZS5BVFRBQ0spIHtcbiAgICBzdGF0ZS5waGFzZSA9IEdhbWVQaGFzZS5CRVRXRUVOX1RVUk5TO1xuICB9XG5cbiAgZm9yIChjb25zdCBwbGF5ZXIgb2Ygc3RhdGUucGxheWVycykge1xuICAgIHN0b3JlLnJlZHVjZUVmZmVjdChzdGF0ZSwgbmV3IEJldHdlZW5UdXJuc0VmZmVjdChwbGF5ZXIpKTtcbiAgfVxuXG4gIGlmIChzdG9yZS5oYXNQcm9tcHRzKCkpIHtcbiAgICByZXR1cm4gc3RvcmUud2FpdFByb21wdChzdGF0ZSwgKCkgPT4ge1xuICAgICAgY2hlY2tTdGF0ZShzdG9yZSwgc3RhdGUsICgpID0+IG9uQ29tcGxldGUoKSk7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGNoZWNrU3RhdGUoc3RvcmUsIHN0YXRlLCAoKSA9PiBvbkNvbXBsZXRlKCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5pdE5leHRUdXJuKHN0b3JlOiBTdG9yZUxpa2UsIHN0YXRlOiBTdGF0ZSk6IFN0YXRlIHtcbiAgaWYgKFtHYW1lUGhhc2UuU0VUVVAsIEdhbWVQaGFzZS5CRVRXRUVOX1RVUk5TXS5pbmRleE9mKHN0YXRlLnBoYXNlKSA9PT0gLTEpIHtcbiAgICByZXR1cm4gc3RhdGU7XG4gIH1cblxuICBsZXQgcGxheWVyOiBQbGF5ZXIgPSBnZXRBY3RpdmVQbGF5ZXIoc3RhdGUpO1xuXG4gIGlmIChzdGF0ZS5waGFzZSA9PT0gR2FtZVBoYXNlLlNFVFVQKSB7XG4gICAgc3RhdGUucGhhc2UgPSBHYW1lUGhhc2UuUExBWUVSX1RVUk47XG4gIH1cblxuICBpZiAoc3RhdGUucGhhc2UgPT09IEdhbWVQaGFzZS5CRVRXRUVOX1RVUk5TKSB7XG4gICAgc3RhdGUuYWN0aXZlUGxheWVyID0gc3RhdGUuYWN0aXZlUGxheWVyID8gMCA6IDE7XG4gICAgc3RhdGUucGhhc2UgPSBHYW1lUGhhc2UuUExBWUVSX1RVUk47XG4gICAgcGxheWVyID0gZ2V0QWN0aXZlUGxheWVyKHN0YXRlKTtcbiAgfVxuXG4gIHN0YXRlLnR1cm4rKztcbiAgc3RvcmUubG9nKHN0YXRlLCBHYW1lTG9nLkxPR19UVVJOLCB7IHR1cm46IHN0YXRlLnR1cm4gfSk7XG5cbiAgLy8gU2tpcCBkcmF3IGNhcmQgb24gZmlyc3QgdHVyblxuICBpZiAoc3RhdGUudHVybiA9PT0gMSAmJiAhc3RhdGUucnVsZXMuZmlyc3RUdXJuRHJhd0NhcmQpIHtcbiAgICByZXR1cm4gc3RhdGU7XG4gIH1cblxuICAvLyBEcmF3IGNhcmQgYXQgdGhlIGJlZ2lubmluZ1xuICBzdG9yZS5sb2coc3RhdGUsIEdhbWVMb2cuTE9HX1BMQVlFUl9EUkFXU19DQVJELCB7IG5hbWU6IHBsYXllci5uYW1lIH0pO1xuICBpZiAocGxheWVyLmRlY2suY2FyZHMubGVuZ3RoID09PSAwKSB7XG5cbiAgICBzdG9yZS5sb2coc3RhdGUsIEdhbWVMb2cuTE9HX1BMQVlFUl9OT19DQVJEU19JTl9ERUNLLCB7IG5hbWU6IHBsYXllci5uYW1lIH0pO1xuICAgIGNvbnN0IHdpbm5lciA9IHN0YXRlLmFjdGl2ZVBsYXllciA/IEdhbWVXaW5uZXIuUExBWUVSXzEgOiBHYW1lV2lubmVyLlBMQVlFUl8yO1xuICAgIHN0YXRlID0gZW5kR2FtZShzdG9yZSwgc3RhdGUsIHdpbm5lcik7XG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG5cbiAgcGxheWVyLmRlY2subW92ZVRvKHBsYXllci5oYW5kLCAxKTtcbiAgcmV0dXJuIHN0YXRlO1xufVxuXG5mdW5jdGlvbiBzdGFydE5leHRUdXJuKHN0b3JlOiBTdG9yZUxpa2UsIHN0YXRlOiBTdGF0ZSk6IFN0YXRlIHtcbiAgY29uc3QgcGxheWVyID0gc3RhdGUucGxheWVyc1tzdGF0ZS5hY3RpdmVQbGF5ZXJdO1xuICBzdG9yZS5sb2coc3RhdGUsIEdhbWVMb2cuTE9HX1BMQVlFUl9FTkRTX1RVUk4sIHsgbmFtZTogcGxheWVyLm5hbWUgfSk7XG5cbiAgLy8gUmVtb3ZlIFBhcmFseXplZCBhdCB0aGUgZW5kIG9mIHRoZSB0dXJuXG4gIHBsYXllci5hY3RpdmUucmVtb3ZlU3BlY2lhbENvbmRpdGlvbihTcGVjaWFsQ29uZGl0aW9uLlBBUkFMWVpFRCk7XG5cbiAgLy8gTW92ZSBzdXBwb3J0ZXIgY2FyZHMgdG8gZGlzY2FyZFxuICBwbGF5ZXIuc3VwcG9ydGVyLm1vdmVUbyhwbGF5ZXIuZGlzY2FyZCk7XG5cbiAgcmV0dXJuIGJldHdlZW5UdXJucyhzdG9yZSwgc3RhdGUsICgpID0+IHtcbiAgICBpZiAoc3RhdGUucGhhc2UgIT09IEdhbWVQaGFzZS5GSU5JU0hFRCkge1xuICAgICAgcmV0dXJuIGluaXROZXh0VHVybihzdG9yZSwgc3RhdGUpO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVNwZWNpYWxDb25kaXRpb25zKHN0b3JlOiBTdG9yZUxpa2UsIHN0YXRlOiBTdGF0ZSwgZWZmZWN0OiBCZXR3ZWVuVHVybnNFZmZlY3QpIHtcbiAgY29uc3QgcGxheWVyID0gZWZmZWN0LnBsYXllcjtcbiAgZm9yIChjb25zdCBzcCBvZiBwbGF5ZXIuYWN0aXZlLnNwZWNpYWxDb25kaXRpb25zKSB7XG4gICAgc3dpdGNoIChzcCkge1xuICAgICAgY2FzZSBTcGVjaWFsQ29uZGl0aW9uLlBPSVNPTkVEOlxuICAgICAgICBwbGF5ZXIuYWN0aXZlLmRhbWFnZSArPSBlZmZlY3QucG9pc29uRGFtYWdlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgU3BlY2lhbENvbmRpdGlvbi5CVVJORUQ6XG4gICAgICAgIGlmIChlZmZlY3QuYnVybkZsaXBSZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWZmZWN0LmJ1cm5GbGlwUmVzdWx0ID09PSBmYWxzZSkge1xuICAgICAgICAgIHBsYXllci5hY3RpdmUuZGFtYWdlICs9IGVmZmVjdC5idXJuRGFtYWdlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHN0b3JlLnByb21wdChzdGF0ZSwgbmV3IENvaW5GbGlwUHJvbXB0KFxuICAgICAgICAgIHBsYXllci5pZCxcbiAgICAgICAgICBHYW1lTWVzc2FnZS5GTElQX0JVUk5FRFxuICAgICAgICApLCByZXN1bHQgPT4ge1xuICAgICAgICAgIGlmIChyZXN1bHQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBwbGF5ZXIuYWN0aXZlLmRhbWFnZSArPSBlZmZlY3QuYnVybkRhbWFnZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgU3BlY2lhbENvbmRpdGlvbi5BU0xFRVA6XG4gICAgICAgIGlmIChlZmZlY3QuYXNsZWVwRmxpcFJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHBsYXllci5hY3RpdmUucmVtb3ZlU3BlY2lhbENvbmRpdGlvbihTcGVjaWFsQ29uZGl0aW9uLkFTTEVFUCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVmZmVjdC5hc2xlZXBGbGlwUmVzdWx0ID09PSBmYWxzZSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfRkxJUF9BU0xFRVAsIHsgbmFtZTogcGxheWVyLm5hbWUgfSk7XG4gICAgICAgIHN0b3JlLnByb21wdChzdGF0ZSwgbmV3IENvaW5GbGlwUHJvbXB0KFxuICAgICAgICAgIHBsYXllci5pZCxcbiAgICAgICAgICBHYW1lTWVzc2FnZS5GTElQX0FTTEVFUFxuICAgICAgICApLCByZXN1bHQgPT4ge1xuICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHBsYXllci5hY3RpdmUucmVtb3ZlU3BlY2lhbENvbmRpdGlvbihTcGVjaWFsQ29uZGl0aW9uLkFTTEVFUCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnYW1lUGhhc2VSZWR1Y2VyKHN0b3JlOiBTdG9yZUxpa2UsIHN0YXRlOiBTdGF0ZSwgZWZmZWN0OiBFZmZlY3QpOiBTdGF0ZSB7XG5cbiAgaWYgKGVmZmVjdCBpbnN0YW5jZW9mIEVuZFR1cm5FZmZlY3QpIHtcbiAgICBjb25zdCBwbGF5ZXIgPSBzdGF0ZS5wbGF5ZXJzW3N0YXRlLmFjdGl2ZVBsYXllcl07XG5cbiAgICBpZiAocGxheWVyID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBHYW1lRXJyb3IoR2FtZU1lc3NhZ2UuTk9UX1lPVVJfVFVSTik7XG4gICAgfVxuXG4gICAgc3RhdGUgPSBjaGVja1N0YXRlKHN0b3JlLCBzdGF0ZSwgKCkgPT4ge1xuICAgICAgaWYgKHN0YXRlLnBoYXNlID09PSBHYW1lUGhhc2UuRklOSVNIRUQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc3RhcnROZXh0VHVybihzdG9yZSwgc3RhdGUpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG5cbiAgaWYgKGVmZmVjdCBpbnN0YW5jZW9mIEJldHdlZW5UdXJuc0VmZmVjdCkge1xuICAgIGhhbmRsZVNwZWNpYWxDb25kaXRpb25zKHN0b3JlLCBzdGF0ZSwgZWZmZWN0KTtcbiAgfVxuXG4gIHJldHVybiBzdGF0ZTtcbn1cbiJdfQ==
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qb2VteWVyc2NvdWdoL0RvY3VtZW50cy9HaXRIdWIvcHRjZy1lcHNkL3B0Y2ctc2VydmVyL3NyYy9nYW1lL3N0b3JlL2VmZmVjdC1yZWR1Y2Vycy9nYW1lLXBoYXNlLWVmZmVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiNDlzQkFpQkk7OFFBaEJKLEtBQUEsQ0FBQSxvQkFBQSwwQkFBQSxPQUFBLENBQUEsK0JBQUEsQ0FBQSxDQUFBLENBQ0EsS0FBQSxDQUFBLFlBQUEsMEJBQUEsT0FBQSxDQUFBLGtCQUFBLENBQUEsQ0FBQSxDQUNBLEtBQUEsQ0FBQSxjQUFBLDBCQUFBLE9BQUEsQ0FBQSxvQkFBQSxDQUFBLENBQUEsQ0FFQSxLQUFBLENBQUEsWUFBQSwwQkFBQSxPQUFBLENBQUEsb0JBQUEsQ0FBQSxDQUFBLENBQ0EsS0FBQSxDQUFBLE9BQUEsMEJBQUEsT0FBQSxDQUFBLGdCQUFBLENBQUEsQ0FBQSxDQUVBLEtBQUEsQ0FBQSxjQUFBLDBCQUFBLE9BQUEsQ0FBQSxnQkFBQSxDQUFBLENBQUEsQ0FDQSxLQUFBLENBQUEsa0JBQUEsMEJBQUEsT0FBQSxDQUFBLDZCQUFBLENBQUEsQ0FBQSxDQUVBLFFBQVMsQ0FBQSxlQUFULENBQXlCLEtBQXpCLENBQXFDLGlEQUNuQyxNQUFPLENBQUEsS0FBSyxDQUFDLE9BQU4sQ0FBYyxLQUFLLENBQUMsWUFBcEIsQ0FBUCxDQUNELENBRUQsUUFBZ0IsQ0FBQSxZQUFoQixDQUE2QixLQUE3QixDQUErQyxLQUEvQyxDQUE2RCxVQUE3RCxDQUFtRixrREFDakYsR0FBSSw0QkFBQSxLQUFLLENBQUMsS0FBTixHQUFnQixPQUFBLENBQUEsU0FBQSxDQUFVLFdBQTFCLCtCQUF5QyxLQUFLLENBQUMsS0FBTixHQUFnQixPQUFBLENBQUEsU0FBQSxDQUFVLE1BQW5FLENBQUosQ0FBK0UscURBQzdFLEtBQUssQ0FBQyxLQUFOLENBQWMsT0FBQSxDQUFBLFNBQUEsQ0FBVSxhQUF4QixDQUNELENBRkQsaUNB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QSxDQUFBLFVBQUEsQ0FBVyxLQUFYLENBQWtCLEtBQWxCLENBQXlCLElBQUssbURBQ3BDLEdBQUksS0FBSyxDQUFDLEtBQU4sR0FBZ0IsT0FBQSxDQUFBLFNBQUEsQ0FBVSxRQUE5QixDQUF3QyxzREFDdEMsT0FDRCxDQUZELGtDQURvQyx5QkFLcEMsTUFBTyxDQUFBLGFBQWEsQ0FBQyxLQUFELENBQVEsS0FBUixDQUFwQixDQUNELENBTk8sQ0FBUixDQVBtQyx5QkFlbkMsTUFBTyxDQUFBLEtBQVAsQ0FDRCxDQWhCRCxrQ0FGNkUseUJBb0I3RSxHQUFJLE1BQU0sV0FBWSxDQUFBLG9CQUFBLENBQUEsa0JBQXRCLENBQTBDLHNEQUN4Qyx1QkFBdUIsQ0FBQyxLQUFELENBQVEsS0FBUixDQUFlLE1BQWYsQ0FBdkIsQ0FDRCxDQUZELGtDQXBCNkUseUJBd0I3RSxNQUFPLENBQUEsS0FBUCxDQUNELEMseUJBekJELE9BQUEsQ0FBQSxnQkFBQSxDQUFBLGdCQUFBLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFZmZlY3QgfSBmcm9tICcuLi9lZmZlY3RzL2VmZmVjdCc7XG5pbXBvcnQgeyBFbmRUdXJuRWZmZWN0LCBCZXR3ZWVuVHVybnNFZmZlY3QgfSBmcm9tICcuLi9lZmZlY3RzL2dhbWUtcGhhc2UtZWZmZWN0cyc7XG5pbXBvcnQgeyBHYW1lRXJyb3IgfSBmcm9tICcuLi8uLi9nYW1lLWVycm9yJztcbmltcG9ydCB7IEdhbWVNZXNzYWdlLCBHYW1lTG9nIH0gZnJvbSAnLi4vLi4vZ2FtZS1tZXNzYWdlJztcbmltcG9ydCB7IFBsYXllciB9IGZyb20gJy4uL3N0YXRlL3BsYXllcic7XG5pbXBvcnQgeyBTcGVjaWFsQ29uZGl0aW9uIH0gZnJvbSAnLi4vY2FyZC9jYXJkLXR5cGVzJztcbmltcG9ydCB7IFN0YXRlLCBHYW1lUGhhc2UsIEdhbWVXaW5uZXIgfSBmcm9tICcuLi9zdGF0ZS9zdGF0ZSc7XG5pbXBvcnQgeyBTdG9yZUxpa2UgfSBmcm9tICcuLi9zdG9yZS1saWtlJztcbmltcG9ydCB7IGNoZWNrU3RhdGUsIGVuZEdhbWUgfSBmcm9tICcuL2NoZWNrLWVmZmVjdCc7XG5pbXBvcnQgeyBDb2luRmxpcFByb21wdCB9IGZyb20gJy4uL3Byb21wdHMvY29pbi1mbGlwLXByb21wdCc7XG5cbmZ1bmN0aW9uIGdldEFjdGl2ZVBsYXllcihzdGF0ZTogU3RhdGUpOiBQbGF5ZXIge1xuICByZXR1cm4gc3RhdGUucGxheWVyc1tzdGF0ZS5hY3RpdmVQbGF5ZXJdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYmV0d2VlblR1cm5zKHN0b3JlOiBTdG9yZUxpa2UsIHN0YXRlOiBTdGF0ZSwgb25Db21wbGV0ZTogKCkgPT4gdm9pZCk6IFN0YXRlIHtcbiAgaWYgKHN0YXRlLnBoYXNlID09PSBHYW1lUGhhc2UuUExBWUVSX1RVUk4gfHwgc3RhdGUucGhhc2UgPT09IEdhbWVQaGFzZS5BVFRBQ0spIHtcbiAgICBzdGF0ZS5waGFzZSA9IEdhbWVQaGFzZS5CRVRXRUVOX1RVUk5TO1xuICB9XG5cbiAgZm9yIChjb25zdCBwbGF5ZXIgb2Ygc3RhdGUucGxheWVycykge1xuICAgIHN0b3JlLnJlZHVjZUVmZmVjdChzdGF0ZSwgbmV3IEJldHdlZW5UdXJuc0VmZmVjdChwbGF5ZXIpKTtcbiAgfVxuXG4gIGlmIChzdG9yZS5oYXNQcm9tcHRzKCkpIHtcbiAgICByZXR1cm4gc3RvcmUud2FpdFByb21wdChzdGF0ZSwgKCkgPT4ge1xuICAgICAgY2hlY2tTdGF0ZShzdG9yZSwgc3RhdGUsICgpID0+IG9uQ29tcGxldGUoKSk7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGNoZWNrU3RhdGUoc3RvcmUsIHN0YXRlLCAoKSA9PiBvbkNvbXBsZXRlKCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5pdE5leHRUdXJuKHN0b3JlOiBTdG9yZUxpa2UsIHN0YXRlOiBTdGF0ZSk6IFN0YXRlIHtcbiAgaWYgKFtHYW1lUGhhc2UuU0VUVVAsIEdhbWVQaGFzZS5CRVRXRUVOX1RVUk5TXS5pbmRleE9mKHN0YXRlLnBoYXNlKSA9PT0gLTEpIHtcbiAgICByZXR1cm4gc3RhdGU7XG4gIH1cblxuICBsZXQgcGxheWVyOiBQbGF5ZXIgPSBnZXRBY3RpdmVQbGF5ZXIoc3RhdGUpO1xuXG4gIGlmIChzdGF0ZS5waGFzZSA9PT0gR2FtZVBoYXNlLlNFVFVQKSB7XG4gICAgc3RhdGUucGhhc2UgPSBHYW1lUGhhc2UuUExBWUVSX1RVUk47XG4gIH1cblxuICBpZiAoc3RhdGUucGhhc2UgPT09IEdhbWVQaGFzZS5CRVRXRUVOX1RVUk5TKSB7XG4gICAgc3RhdGUuYWN0aXZlUGxheWVyID0gc3RhdGUuYWN0aXZlUGxheWVyID8gMCA6IDE7XG4gICAgc3RhdGUucGhhc2UgPSBHYW1lUGhhc2UuUExBWUVSX1RVUk47XG4gICAgcGxheWVyID0gZ2V0QWN0aXZlUGxheWVyKHN0YXRlKTtcbiAgfVxuXG4gIHN0YXRlLnR1cm4rKztcbiAgc3RvcmUubG9nKHN0YXRlLCBHYW1lTG9nLkxPR19UVVJOLCB7IHR1cm46IHN0YXRlLnR1cm4gfSk7XG5cbiAgLy8gU2tpcCBkcmF3IGNhcmQgb24gZmlyc3QgdHVyblxuICBpZiAoc3RhdGUudHVybiA9PT0gMSAmJiAhc3RhdGUucnVsZXMuZmlyc3RUdXJuRHJhd0NhcmQpIHtcbiAgICByZXR1cm4gc3RhdGU7XG4gIH1cblxuICAvLyBEcmF3IGNhcmQgYXQgdGhlIGJlZ2lubmluZ1xuICBzdG9yZS5sb2coc3RhdGUsIEdhbWVMb2cuTE9HX1BMQVlFUl9EUkFXU19DQVJELCB7IG5hbWU6IHBsYXllci5uYW1lIH0pO1xuICBpZiAocGxheWVyLmRlY2suY2FyZHMubGVuZ3RoID09PSAwKSB7XG5cbiAgICBzdG9yZS5sb2coc3RhdGUsIEdhbWVMb2cuTE9HX1BMQVlFUl9OT19DQVJEU19JTl9ERUNLLCB7IG5hbWU6IHBsYXllci5uYW1lIH0pO1xuICAgIGNvbnN0IHdpbm5lciA9IHN0YXRlLmFjdGl2ZVBsYXllciA/IEdhbWVXaW5uZXIuUExBWUVSXzEgOiBHYW1lV2lubmVyLlBMQVlFUl8yO1xuICAgIHN0YXRlID0gZW5kR2FtZShzdG9yZSwgc3RhdGUsIHdpbm5lcik7XG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG5cbiAgcGxheWVyLmRlY2subW92ZVRvKHBsYXllci5oYW5kLCAxKTtcbiAgcmV0dXJuIHN0YXRlO1xufVxuXG5mdW5jdGlvbiBzdGFydE5leHRUdXJuKHN0b3JlOiBTdG9yZUxpa2UsIHN0YXRlOiBTdGF0ZSk6IFN0YXRlIHtcbiAgY29uc3QgcGxheWVyID0gc3RhdGUucGxheWVyc1tzdGF0ZS5hY3RpdmVQbGF5ZXJdO1xuICBzdG9yZS5sb2coc3RhdGUsIEdhbWVMb2cuTE9HX1BMQVlFUl9FTkRTX1RVUk4sIHsgbmFtZTogcGxheWVyLm5hbWUgfSk7XG5cbiAgLy8gUmVtb3ZlIFBhcmFseXplZCBhdCB0aGUgZW5kIG9mIHRoZSB0dXJuXG4gIHBsYXllci5hY3RpdmUucmVtb3ZlU3BlY2lhbENvbmRpdGlvbihTcGVjaWFsQ29uZGl0aW9uLlBBUkFMWVpFRCk7XG5cbiAgLy8gTW92ZSBzdXBwb3J0ZXIgY2FyZHMgdG8gZGlzY2FyZFxuICBwbGF5ZXIuc3VwcG9ydGVyLm1vdmVUbyhwbGF5ZXIuZGlzY2FyZCk7XG5cbiAgcmV0dXJuIGJldHdlZW5UdXJucyhzdG9yZSwgc3RhdGUsICgpID0+IHtcbiAgICBpZiAoc3RhdGUucGhhc2UgIT09IEdhbWVQaGFzZS5GSU5JU0hFRCkge1xuICAgICAgcmV0dXJuIGluaXROZXh0VHVybihzdG9yZSwgc3RhdGUpO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVNwZWNpYWxDb25kaXRpb25zKHN0b3JlOiBTdG9yZUxpa2UsIHN0YXRlOiBTdGF0ZSwgZWZmZWN0OiBCZXR3ZWVuVHVybnNFZmZlY3QpIHtcbiAgY29uc3QgcGxheWVyID0gZWZmZWN0LnBsYXllcjtcbiAgZm9yIChjb25zdCBzcCBvZiBwbGF5ZXIuYWN0aXZlLnNwZWNpYWxDb25kaXRpb25zKSB7XG4gICAgc3dpdGNoIChzcCkge1xuICAgICAgY2FzZSBTcGVjaWFsQ29uZGl0aW9uLlBPSVNPTkVEOlxuICAgICAgICBwbGF5ZXIuYWN0aXZlLmRhbWFnZSArPSBlZmZlY3QucG9pc29uRGFtYWdlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgU3BlY2lhbENvbmRpdGlvbi5CVVJORUQ6XG4gICAgICAgIGlmIChlZmZlY3QuYnVybkZsaXBSZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWZmZWN0LmJ1cm5GbGlwUmVzdWx0ID09PSBmYWxzZSkge1xuICAgICAgICAgIHBsYXllci5hY3RpdmUuZGFtYWdlICs9IGVmZmVjdC5idXJuRGFtYWdlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHN0b3JlLnByb21wdChzdGF0ZSwgbmV3IENvaW5GbGlwUHJvbXB0KFxuICAgICAgICAgIHBsYXllci5pZCxcbiAgICAgICAgICBHYW1lTWVzc2FnZS5GTElQX0JVUk5FRFxuICAgICAgICApLCByZXN1bHQgPT4ge1xuICAgICAgICAgIGlmIChyZXN1bHQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBwbGF5ZXIuYWN0aXZlLmRhbWFnZSArPSBlZmZlY3QuYnVybkRhbWFnZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgU3BlY2lhbENvbmRpdGlvbi5BU0xFRVA6XG4gICAgICAgIGlmIChlZmZlY3QuYXNsZWVwRmxpcFJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHBsYXllci5hY3RpdmUucmVtb3ZlU3BlY2lhbENvbmRpdGlvbihTcGVjaWFsQ29uZGl0aW9uLkFTTEVFUCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVmZmVjdC5hc2xlZXBGbGlwUmVzdWx0ID09PSBmYWxzZSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHN0b3JlLmxvZyhzdGF0ZSwgR2FtZUxvZy5MT0dfRkxJUF9BU0xFRVAsIHsgbmFtZTogcGxheWVyLm5hbWUgfSk7XG4gICAgICAgIHN0b3JlLnByb21wdChzdGF0ZSwgbmV3IENvaW5GbGlwUHJvbXB0KFxuICAgICAgICAgIHBsYXllci5pZCxcbiAgICAgICAgICBHYW1lTWVzc2FnZS5GTElQX0FTTEVFUFxuICAgICAgICApLCByZXN1bHQgPT4ge1xuICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHBsYXllci5hY3RpdmUucmVtb3ZlU3BlY2lhbENvbmRpdGlvbihTcGVjaWFsQ29uZGl0aW9uLkFTTEVFUCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnYW1lUGhhc2VSZWR1Y2VyKHN0b3JlOiBTdG9yZUxpa2UsIHN0YXRlOiBTdGF0ZSwgZWZmZWN0OiBFZmZlY3QpOiBTdGF0ZSB7XG5cbiAgaWYgKGVmZmVjdCBpbnN0YW5jZW9mIEVuZFR1cm5FZmZlY3QpIHtcbiAgICBjb25zdCBwbGF5ZXIgPSBzdGF0ZS5wbGF5ZXJzW3N0YXRlLmFjdGl2ZVBsYXllcl07XG5cbiAgICBpZiAocGxheWVyID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBHYW1lRXJyb3IoR2FtZU1lc3NhZ2UuTk9UX1lPVVJfVFVSTik7XG4gICAgfVxuXG4gICAgc3RhdGUgPSBjaGVja1N0YXRlKHN0b3JlLCBzdGF0ZSwgKCkgPT4ge1xuICAgICAgaWYgKHN0YXRlLnBoYXNlID09PSBHYW1lUGhhc2UuRklOSVNIRUQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc3RhcnROZXh0VHVybihzdG9yZSwgc3RhdGUpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG5cbiAgaWYgKGVmZmVjdCBpbnN0YW5jZW9mIEJldHdlZW5UdXJuc0VmZmVjdCkge1xuICAgIGhhbmRsZVNwZWNpYWxDb25kaXRpb25zKHN0b3JlLCBzdGF0ZSwgZWZmZWN0KTtcbiAgfVxuXG4gIHJldHVybiBzdGF0ZTtcbn1cbiJdfQ==